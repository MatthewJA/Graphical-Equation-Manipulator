/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,n){"function"==typeof define&&define.amd?define(n):t.libGlobalName=n()}(this,function(){var t,n,e;return function(i){function r(t,n){return b.call(t,n)}function l(t,n){var e,i,r,l,o,s,a,u,h,c,p=n&&n.split("/"),f=w.map,d=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(n){for(p=p.slice(0,p.length-1),t=p.concat(t.split("/")),u=0;u<t.length;u+=1)if(c=t[u],"."===c)t.splice(u,1),u-=1;else if(".."===c){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||d)&&f){for(e=t.split("/"),u=e.length;u>0;u-=1){if(i=e.slice(0,u).join("/"),p)for(h=p.length;h>0;h-=1)if(r=f[p.slice(0,h).join("/")],r&&(r=r[i])){l=r,o=u;break}if(l)break;!s&&d&&d[i]&&(s=d[i],a=u)}!l&&s&&(l=s,o=a),l&&(e.splice(0,o,l),t=e.join("/"))}return t}function o(t,n){return function(){return f.apply(i,M.call(arguments,0).concat([t,n]))}}function s(t){return function(n){return l(n,t)}}function a(t){return function(n){g[t]=n}}function u(t){if(r(m,t)){var n=m[t];delete m[t],v[t]=!0,p.apply(i,n)}if(!r(g,t)&&!r(v,t))throw new Error("No "+t);return g[t]}function h(t){var n,e=t?t.indexOf("!"):-1;return e>-1&&(n=t.substring(0,e),t=t.substring(e+1,t.length)),[n,t]}function c(t){return function(){return w&&w.config&&w.config[t]||{}}}var p,f,d,y,g={},m={},w={},v={},b=Object.prototype.hasOwnProperty,M=[].slice;d=function(t,n){var e,i=h(t),r=i[0];return t=i[1],r&&(r=l(r,n),e=u(r)),r?t=e&&e.normalize?e.normalize(t,s(n)):l(t,n):(t=l(t,n),i=h(t),r=i[0],t=i[1],r&&(e=u(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:e}},y={require:function(t){return o(t)},exports:function(t){var n=g[t];return"undefined"!=typeof n?n:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:c(t)}}},p=function(t,n,e,l){var s,h,c,p,f,w,b=[];if(l=l||t,"function"==typeof e){for(n=!n.length&&e.length?["require","exports","module"]:n,f=0;f<n.length;f+=1)if(p=d(n[f],l),h=p.f,"require"===h)b[f]=y.require(t);else if("exports"===h)b[f]=y.exports(t),w=!0;else if("module"===h)s=b[f]=y.module(t);else if(r(g,h)||r(m,h)||r(v,h))b[f]=u(h);else{if(!p.p)throw new Error(t+" missing "+h);p.p.load(p.n,o(l,!0),a(h),{}),b[f]=g[h]}c=e.apply(g[t],b),t&&(s&&s.exports!==i&&s.exports!==g[t]?g[t]=s.exports:c===i&&w||(g[t]=c))}else t&&(g[t]=e)},t=n=f=function(t,n,e,r,l){return"string"==typeof t?y[t]?y[t](n):u(d(t,n).f):(t.splice||(w=t,n.splice?(t=n,n=e,e=null):t=i),n=n||function(){},"function"==typeof e&&(e=r,r=l),r?p(i,t,n,e):setTimeout(function(){p(i,t,n,e)},4),f)},f.config=function(t){return w=t,w.deps&&f(w.deps,w.callback),f},t._defined=g,e=function(t,n,e){n.splice||(e=n,n=[]),r(g,t)||r(m,t)||(m[t]=[t,n,e])},e.amd={jQuery:!0}}(),e("lib/almond",function(){}),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};e("parse",["require"],function(t){var e,i,r;return e=function(t){function e(t,n){this.input=t,this.type=n}return n(e,t),e.prototype.toString=function(){return"Could not parse '"+this.input+"' as "+this.type},e}(Error),r=function(n){var i;if(i=t("terminals"),/^-?\d+(\.\d+)?$/.test(n)||/^-?\d+(\.\d+)?\/\d+(\.\d+)?$/.test(n))return new i.Constant(n);if(/^[a-zA-Z][a-zA-Z_\-\d]*$/.test(n))return new i.Variable(n);if(/^\\[a-zA-Z][a-zA-Z_\-\d]*$/.test(n))return new i.SymbolicConstant(n.slice(1));throw new e(n,"terminal")},i=function(){function n(e){return this.tokens=n.tokenise(e).reverse(),this.upto=0,this.operators=t("operators"),this.parseAddition()}return n.tokenise=function(t){return t.split(/(\*\*|[+*()\-]|\s)/).filter(function(t){return!/^\s*$/.test(t)})},n.prototype.getToken=function(){return this.tokens[this.upto]},n.prototype.parseAddition=function(){var t,n;return n=this.parseMultiplication(),"+"!==this.getToken()?n:(this.upto+=1,t=this.parseAddition(),new this.operators.Add(t,n))},n.prototype.parseMultiplication=function(){var t,n;return n=this.parsePower(),"*"!==this.getToken()?n:(this.upto+=1,t=this.parseMultiplication(),new this.operators.Mul(t,n))},n.prototype.parsePower=function(){var t,n;return t=this.parseBracket(),"**"!==this.getToken()?t:(this.upto+=1,n=this.parsePower(),new this.operators.Pow(n,t))},n.prototype.parseBracket=function(){var t,n;if(")"===this.getToken()){if(this.upto+=1,t=this.parseAddition(),"("!==this.getToken())throw new Error("ParseError: Expected '(' but found '"+this.getToken()+"' at position "+(""+(this.tokens.length-this.upto)+"/"+this.tokens.length+" in token stream '"+this.tokens.reverse().join(" ")+"'"));return this.upto+=1,"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,t)):t}return n=this.parseTerm(),"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,n)):n},n.prototype.parseTerm=function(){var t;return t=r(this.getToken()),this.upto+=1,t},n}(),{ParseError:e,stringToExpression:function(t){return new i(t)},constant:function(t){if("string"==typeof t||t instanceof String){if(""===t)throw new e("","constant");if(t=t.split("/"),1===t.length)return[parseFloat(t[0]),1];if(2===t.length)return[parseFloat(t[0]),parseFloat(t[1])];throw new e(t.join("/"),"constant")}if("number"==typeof t||t instanceof Number)return[t,1];throw new e(t,"constant")},stringToTerminal:r}})}.call(this),function(){e("generateInfo",[],function(){return{getMathMLInfo:function(t,n,e){var i,r,l;return null==e&&(e="0"),r=n?"expression":"equation",l=""+r+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),i='<div id="'+l+'" class="'+r+'"><math xmlns="http://www.w3.org/1998/Math/MathML">'+(null!=e?(isFinite(e)?"<mn>"+e+"</mn>":null!=e.toMathML?""+e.toMathML(t,n):"<mi>"+e+"</mi>")+"<mo>=</mo>":""),[r,l,i]},getHTMLInfo:function(t,n,e){var i,r,l;return null==e&&(e="0"),r=n?"expression":"equation",l=""+r+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),i='<div id="'+l+'" class="'+r+'">'+(null!=e?(null!=e.toHTML?""+e.toHTML(t,n):""+e)+"=":""),[r,l,i]}}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n},i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("terminals",["parse","generateInfo"],function(t,e){var r,l,o,s;return o=function(){function t(t){this.label=t}return t.prototype.evaluate=function(){},t.prototype.copy=function(){return new t(this.label)},t.prototype.toString=function(){return this.label},t}(),r=function(i){function r(n,e){var i,r;this.denominator=null!=e?e:null,this.cmp=-6,null!=this.denominator?(i=t.constant(n),this.numerator=i[0],e=i[1],this.denominator*=e):(r=t.constant(n),this.numerator=r[0],this.denominator=r[1])}return n(r,i),r.prototype.evaluate=function(){return this.numerator/this.denominator},r.prototype.copy=function(){return new r(this.numerator,this.denominator)},r.prototype.compareSameType=function(t){return this.evaluate()<t.evaluate()?-1:this.evaluate()===t.evaluate()?0:1},r.prototype.multiply=function(t){return new r(this.numerator*t.numerator,this.denominator*t.denominator)},r.prototype.add=function(t){return new r(t.denominator*this.numerator+this.denominator*t.numerator,this.denominator*t.denominator)},r.prototype.equals=function(t){return t instanceof r?this.evaluate()===t.evaluate():!1},r.prototype.replaceVariables=function(){return this.copy()},r.prototype.getAllVariables=function(){return[]},r.prototype.sub=function(){return this.copy()},r.prototype.simplify=function(){return this.copy()},r.prototype.expand=function(){return this.copy()},r.prototype.expandAndSimplify=function(){return this.copy()},r.prototype.substituteExpression=function(){return this.copy()},r.prototype.toMathML=function(t,n,i,r){var l,o,s,a,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(u=e.getMathMLInfo(t,n,i),s=u[0],a=u[1],o=u[2],l="</math></div>"):(o="",l=""),1===this.denominator?o+("<mn>"+this.numerator+"</mn>")+l:o+("<mfrac><mrow><mn>"+this.numerator+"</mn></mrow><mrow><mn>"+this.denominator+"</mn></mrow></mfrac>")+l},r.prototype.toHTML=function(t,n,i,r){var l,o,s,a,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),u=e.getHTMLInfo(t,n,i),s=u[0],a=u[1],o=u[2],r?l="</div>":(o="",l=""),1===this.denominator?o+(""+this.numerator)+l:o+("("+this.numerator+"/"+this.denominator+")")+l},r.prototype.toLaTeX=function(){return 1===this.denominator?""+this.numerator:"\\frac{"+this.numerator+"}{"+this.denominator+"}"},r.prototype.toString=function(){return 1!==this.denominator?""+this.numerator+"/"+this.denominator:""+this.numerator},r}(o),l=function(t){function i(t,n){this.label=t,this.value=null!=n?n:null,this.cmp=-5}return n(i,t),i.prototype.copy=function(){return new i(this.label,this.value)},i.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},i.prototype.evaluate=function(){return this.value},i.prototype.equals=function(t){return t instanceof i?this.label===t.label&&this.value===t.value:!1},i.prototype.replaceVariables=function(){return this.copy()},i.prototype.getAllVariables=function(){return[]},i.prototype.sub=function(){return this.copy()},i.prototype.simplify=function(){return this.copy()},i.prototype.expand=function(){return this.copy()},i.prototype.expandAndSimplify=function(){return this.copy()},i.prototype.substituteExpression=function(){return this.copy()},i.prototype.toHTML=function(t,n,i,r){var l,o,s,a,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(u=e.getHTMLInfo(t,n,i),s=u[0],a=u[1],o=u[2],l="</div>"):(o="",l=""),o+this.toString()+l},i.prototype.toMathML=function(t,n,i,r){var l,o,s,a,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(u=e.getMathMLInfo(t,n,i),s=u[0],a=u[1],o=u[2],l="</math></div>"):(o="",l=""),""+o+"<mn>"+this.label+"</mn>"+l},i.prototype.toLaTeX=function(){return this.toString()},i}(o),s=function(t){function l(t){this.label=t,this.cmp=-4}return n(l,t),l.prototype.copy=function(){return new l(this.label)},l.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},l.prototype.equals=function(t){return t instanceof l?t.label===this.label:!1},l.prototype.replaceVariables=function(t){return this.label in t?this.label=t[this.label]:void 0},l.prototype.getAllVariables=function(){return[this.label]},l.prototype.sub=function(t){var n;return this.label in t?(n=t[this.label],null!=n.copy?n.copy():new r(n)):this.copy()},l.prototype.substituteExpression=function(t,n,e,r){var l,o;return null==e&&(e=null),null==r&&(r=!1),null==e&&(e={get:function(t){return[t]}}),l=e.get(n),r&&(t=t.solve(n)[0]),this.label===n||(o=this.label,i.call(l,o)>=0)?t.copy():this.copy()},l.prototype.simplify=function(){return this.copy()},l.prototype.expand=function(){return this.copy()},l.prototype.expandAndSimplify=function(){return this.copy()},l.prototype.toMathML=function(t,n,i,r){var l,o,s,a,u,h,c,p;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(p=e.getMathMLInfo(t,n,i),h=p[0],c=p[1],o=p[2],l="</div>"):(o="",l=""),a=this.label.split("-"),s=a[0],u=null!=a[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",s.length>1?o+'<msub class="variable"'+u+"><mi>"+s[0]+"</mi><mi>"+s.slice(1)+"</mi></msub>"+l:o+'<mi class="variable"'+u+">"+s+"</mi>"+l},l.prototype.toHTML=function(t,n,i,r){var l,o,s,a,u,h,c,p;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(p=e.getHTMLInfo(t,n,i),h=p[0],c=p[1],o=p[2],l="</div>"):(o="",l=""),a=this.label.split("-"),s=a[0],u=null!=a[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",o+'<span class="variable"'+u+">"+s+"</span>"+l},l.prototype.toLaTeX=function(){return this.toString()},l}(o),{Terminal:o,Variable:s,Constant:r,SymbolicConstant:l}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};e("nodes",[],function(){var t;return t=function(){function t(t){this.label=t}return t.prototype.getChildren=function(){return[]},t}(),{BasicNode:t,RoseNode:function(t){function e(t,n){this.children=null!=n?n:null,null==this.children&&(this.children=[]),e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.getChildren=function(){return this.children},e.prototype.toLisp=function(){return"("+this.label+(this.children?" ":"")+this.children.join(" ")+")"},e.prototype.toString=function(){return"("+this.children.join(" "+this.label+" ")+")"},e}(t),BinaryNode:function(t){function e(t,n,e){this.label=t,this.children={left:n,right:e}}return n(e,t),e.prototype.getChildren=function(){return[this.children.left,this.children.right]},e.prototype.toLisp=function(){return"("+this.label+" "+this.children.left+" "+this.children.right+")"},e.prototype.toString=function(){return"("+this.children.left+" "+this.label+" "+this.children.right+")"},e}(t)}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n},i=[].slice,r=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators",["nodes","parse","terminals","generateInfo"],function(t,e,l,o){var s,a,u,h,c,p,f;return a=function(t){function e(t,n,i){null==i&&(i=null),e.__super__.constructor.call(this,"Unsolvable: "+t+" for "+n+(i?";"+i:""))}return n(e,t),e}(Error),f=function(t){var n,e,i,r;for(e=[],i=0,r=t.length;r>i;i++)n=t[i],n instanceof Array?e.push(f(n)):e.push("function"==typeof n.toString?n.toString():void 0);return"["+e.join(", ")+"]"},p=function(){var n,r,o,s,a;for(r=1<=arguments.length?i.call(arguments,0):[],o=[],s=0,a=r.length;a>s;s++)if(n=r[s],"string"==typeof n||n instanceof String)o.push(e.stringToTerminal(n));else if("number"==typeof n||n instanceof Number)o.push(new l.Constant(n));else{if(!(n instanceof l.Terminal||n instanceof t.BasicNode||null!=n.isTerminal))throw new Error("Invalid argument "+n+", ("+typeof n+"), ("+n.toString()+")");o.push(n)}return o},s=function(e){function s(){var t;if(t=1<=arguments.length?i.call(arguments,0):[],t.length<1)throw new Error("Add nodes must have at least one child.");this.cmp=-1,t=p.apply(null,t),s.__super__.constructor.call(this,"+",t)}return n(s,e),s.prototype.copy=function(){var t,n;return t=function(){var t,e,i,r;for(i=this.children,r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(null!=n.copy?n.copy():n);return r}.call(this),function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,t,function(){})},s.prototype.compareSameType=function(t){var n,e,i,r,l,o,s;for(r=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,s=this.children,i=l=0,o=s.length;o>l;i=++l){if(e=s[i],null==t.children[i])return 1;if(n=c(this.children[i],t.children[i]),0!==n)return n}return r},s.prototype.expand=function(){var t,n,e,i,r,l,o,a,u,h;for(i=[],u=this.children,r=0,o=u.length;o>r;r++)if(e=u[r],null!=e.expand?e=e.expand():null!=e.copy&&(e=e.copy()),e instanceof s)for(h=e.children,l=0,a=h.length;a>l;l++)n=h[l],i.push(n);else i.push(e);return t=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,i,function(){}),t.sort(),t},s.prototype.sort=function(){var t,n,e,i;for(i=this.children,n=0,e=i.length;e>n;n++)t=i[n],"function"==typeof t.sort&&t.sort();return this.children.sort(c)},s.prototype.equals=function(t){var n,e,i,r,l;if(!(t instanceof s))return!1;if(t.children.length!==this.children.length)return!1;for(l=this.children,e=i=0,r=l.length;r>i;e=++i)if(n=l[e],null!=n.equals){if(!n.equals(t.children[e]))return!1}else if(n!==t.children[e])return!1;return!0},s.prototype.simplify=function(){var t,n,e,i,r,o,a,h,c,p,f,d,y,g,m,w,v,b,M,T,x,S,L,V,A,C,q,E,_,j;for(y=[],E=this.children,w=0,T=E.length;T>w;w++)n=E[w],null!=n.simplify?n=n.simplify():null!=n.copy&&(n=n.copy()),y.push(n);for(c=[],e=null,o=0;o<y.length;){if(d=y[o],d instanceof s){for(y.splice(o,1)[0],_=d.children,v=0,x=_.length;x>v;v++)t=_[v],y.push(t);o-=1}else if(d instanceof l.Constant)e=null!=e?e.add(d):d.copy();else if(d instanceof u){for(i=null,g=null,j=d.children,b=0,S=j.length;S>b;b++)n=j[b],n instanceof l.Constant?i=null!=i?i.multiply(n):n.copy():null!=g?g.children.push(n):g=new u(n);if(1===g.children.length&&(g=g.children[0]),null!=i&&null==g)e=null!=e?e.add(i):i.copy();else{for(null==i&&(i=new l.Constant("1")),r=!1,a=M=0,L=c.length;L>M;a=++M)h=c[a],null!=h[0].equals?h[0].equals(g)&&(c[a][1]=new s(h[1],i),c[a][1]=c[a][1].simplify(),r=!0):h[0]===g&&(c[a][1]=new s(h[1],i),c[a][1]=c[a][1].simplify(),r=!0);r||c.push([g,i])}}else{for(r=!1,a=C=0,V=c.length;V>C;a=++C)h=c[a],null!=h[0].equals?h[0].equals(d)&&(c[a][1]=new s(h[1],new l.Constant("1")),c[a][1]=c[a][1].simplify(),r=!0):h[0]===d&&(c[a][1]=new s(h[1],new l.Constant("1")),c[a][1]=c[a][1].simplify(),r=!0);r||c.push([d,new l.Constant("1")])}o+=1}for(p=null,q=0,A=c.length;A>q;q++)h=c[q],null!=h[0].children&&1===h[0].children.length&&(h[0]=h[0].children[0]),1!==("function"==typeof(m=h[1]).evaluate?m.evaluate():void 0)?(f=new u(h[0],h[1]),f=f.simplify()):f=h[0],null!=p?p.children.push(f):p=new s(f);return null==p?e:(null!=e&&0!==e.evaluate()&&p.children.push(e),p.sort(),1!==p.children.length?p:p.children[0])},s.prototype.expandAndSimplify=function(){var t;return t=this.expand(),null!=t.simplify?t.simplify():t},s.prototype.solve=function(t){var n,e,i,r,o,c,p,f,d,y,g,m,w,v,b,M,T,x,S,L,V,A,C,q,E,_,j,k,O,H,N,I,X,P,B,z,$,F,Z,R,U,G,Q,D,J,K,W,Y,tn;if(d=this.expandAndSimplify(),X=[],P=[],d instanceof l.Terminal){if(d instanceof l.Variable&&d.label===t)return[new l.Constant("0")];throw new a(d.toString(),t)}if(!(d instanceof s))return d.solve(t);for(W=d.children,$=0,U=W.length;U>$;$++)if(I=W[$],null!=I.copy&&(I=I.copy()),I instanceof h)I.children.left instanceof l.Variable&&I.children.left.label===t?X.push(I):P.push(I);else if(I instanceof u){for(r=!1,Y=I.children,F=0,G=Y.length;G>F;F++){if(H=Y[F],H instanceof l.Variable&&H.label===t){X.push(I),r=!0;break}if(H instanceof h&&H.children.left instanceof l.Variable&&H.children.left.label===t){X.push(I),r=!0;break}}r||P.push(I)}else I instanceof l.Variable&&I.label===t?X.push(I):P.push(I);if(0===X.length)throw new a(d.toString(),t);for(y=[],m=[],T=[],S=[],Z=0,Q=X.length;Q>Z;Z++)if(I=X[Z],I instanceof l.Variable)y.push(new l.Constant("1"));else if(I instanceof h){if(!(I.children.right instanceof l.Constant))throw new a(d.toString(),t);if(j=I.children.right.evaluate(),!(I.children.left instanceof l.Variable&&I.children.left.label===t))throw new a(d.toString(),t," (this shouldn't happen)");if(1===j)y.push(new l.Constant("1"));else if(2===j)m.push(new l.Constant("1"));else if(-1===j)T.push(new l.Constant("1"));else{if(-2!==j)throw new a(d.toString(),t," (not supported)");S.push(new l.Constant("1"))}}else if(I instanceof u){for(N=[],k=!1,b=!1,M=!1,tn=I.children,R=0,D=tn.length;D>R;R++)if(H=tn[R],H instanceof l.Variable&&H.label===t);else if(H instanceof h){if(!(H.children.right instanceof l.Constant))throw new a(d.toString(),t);if(j=H.children.right.evaluate(),H.children.left instanceof l.Variable&&H.children.left.label===t)if(1===j);else if(2===j)k=!0;else if(-1===j)b=!0;else{if(-2!==j)throw new a(d.toString(),t," (not supported)");M=!0}else N.push(H)}else N.push(H);v=N.length>0?function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,N,function(){}):new l.Constant("1"),k?m.push(v):b?T.push(v):M?S.push(v):y.push(v)}for(V=[],K=0,J=P.length;J>K;K++)I=P[K],q=new u("-1",null!=I.copy?I.copy():I),q=q.simplify(),V.push(q);if(0!==V.length&&(A=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,V,function(){})),0!==P.length&&(_=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,P,function(){})),0!==y.length&&(g=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,y,function(){})),0!==m.length&&(w=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,m,function(){})),0!==T.length&&(x=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,T,function(){})),0!==S.length&&(L=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,S,function(){})),0===V.length&&(A=new l.Constant("0")),0===m.length){if(0===y.length){if(0===T.length){if(0===S.length)throw new a(d.toString(),t);return o=new u(new h(L,"1/2"),new h(A,"-1/2")),e=new u(-1,o.copy()),e=e.expandAndSimplify(),i=o.expandAndSimplify(),("function"==typeof e.equals?e.equals(i):void 0)?[e]:[e,i]}return 0===S.length?(o=new u(x,new h(A,"-1")),[o.expandAndSimplify()]):(C=new s(new u(_,new h(new l.Variable(t),2)),new u(x,new l.Variable(t)),L),C.solve(t))}if(0===T.length){if(0===S.length)return o=new u(A,new h(g,"-1")),[o.expandAndSimplify()];throw new a(d.toString(),t," (not supported)")}throw new a(d.toString(),t," (not supported)")}if(0===y.length){if(0===T.length){if(0===S.length)return o=new h(new u(A,new h(w,"-1")),"1/2"),e=new u("-1",o.copy()),e=e.expandAndSimplify(),i=o.expandAndSimplify(),("function"==typeof e.equals?e.equals(i):void 0)?[e]:[e,i];throw new a(d.toString(),t," (not supported)")}throw new a(d.toString(),t," (not supported)")}if(T.length>0||S.length>0)throw new a(d.toString(),t," (not supported)");return null!=_?(n=w,c=g,p=_,f=new s(new h(c,"2"),new u("-4",n,p)),O=new h(f,"1/2"),B=new u(new s(new u("-1",c),O),new h(new u("2",n),"-1")),z=new u("-1",new s(c,O),new h(new u("2",n),"-1")),B=B.expandAndSimplify(),z=z.expandAndSimplify(),null!=B.equals&&B.equals(z)?[B]:[B,z]):(E=new h(w,"-1"),q=new u("-1",g,E),q=q.simplify(),[0,q])},s.prototype.getAllVariables=function(){var t,n,e,i,r,o,s,a,u,h;for(r={},h=this.children,o=0,a=h.length;a>o;o++)if(t=h[o],t instanceof l.Variable)r[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),s=0,u=n.length;u>s;s++)i=n[s],r[i]=!0;e=[];for(i in r)e.push(i);return e},s.prototype.replaceVariables=function(t){var n,e,i,r,o,s;for(o=this.children,s=[],e=i=0,r=o.length;r>i;e=++i)n=o[e],n instanceof l.Variable&&n.label in t?s.push(this.children[e].label=t[n.label]):null!=n.replaceVariables?s.push(n.replaceVariables(t)):s.push(void 0);return s},s.prototype.sub=function(n){var e,i,r,o,a,u,h;for(o in n)n[o]instanceof l.Terminal||n[o]instanceof t.BasicNode||(n[o]=new l.Constant(n[o]));for(i=[],h=this.children,a=0,u=h.length;u>a;a++)e=h[a],e instanceof l.Variable&&e.label in n?i.push(n[e.label].copy()):null!=e.sub?i.push(e.sub(n)):i.push(e.copy());return r=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,i,function(){}),r=r.expandAndSimplify()},s.prototype.substituteExpression=function(t,n,e,i){var o,a,u,h,c,p,f,d;for(null==e&&(e=null),null==i&&(i=!1),i&&(t=t.solve(n)[0]),null==e&&(e={get:function(t){return[t]}}),h=e.get(n),a=[],f=this.children,c=0,p=f.length;p>c;c++)o=f[c],o instanceof l.Variable&&(o.label===n||(d=o.label,r.call(h,d)>=0))?a.push(t.copy()):null!=o.substituteExpression?a.push(o.substituteExpression(t,n,e)):a.push(o.copy());return u=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,a,function(){}),console.log(u.toString()),u.expandAndSimplify()},s.prototype.toMathML=function(t,n,e,i){var r,l,s,a,u;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),u=o.getMathMLInfo(t,n,e),s=u[0],a=u[1],l=u[2],i?r="</math></div>":(l="",r=""),l+"<mrow>"+this.children.map(function(e){return e.toMathML(t,n)}).join("<mo>+</mo>")+"</mrow>"+r},s.prototype.toHTML=function(t,n,e,i){var r,l,s,a,u;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),u=o.getHTMLInfo(t,n,e),s=u[0],a=u[1],l=u[2],i?r="</div>":(l="",r=""),l+this.children.map(function(t){return t.toHTML()}).join("+")+r},s.prototype.toLaTeX=function(){return this.children.map(function(t){return t.toLaTeX()}).join("+")},s}(t.RoseNode),u=function(e){function u(){var t;if(t=1<=arguments.length?i.call(arguments,0):[],t.length<1)throw new Error("Mul nodes must have at least one child.");this.cmp=-2,t=p.apply(null,t),u.__super__.constructor.call(this,"*",t)}return n(u,e),u.prototype.copy=function(){var t,n;return t=function(){var t,e,i,r;for(i=this.children,r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(null!=n.copy?n.copy():n);return r}.call(this),function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,t,function(){})},u.prototype.simplifyConstants=function(){var t,n,e,i,r,o;for(n=new l.Constant("1"),e=null,o=this.children,i=0,r=o.length;r>i;i++)t=o[i],t instanceof l.Constant?n=n.multiply(t):null!=e?e.children.push(t):e=new u(t);return null==e?n:1===n.evaluate()?e:new u(n,e)},u.prototype.compareSameType=function(t){var n,e,i,r,l,o,s;for(r=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,s=this.children,i=l=0,o=s.length;o>l;i=++l){if(e=s[i],null==t.children[i])return 1;if(n=c(this.children[i],t.children[i]),0!==n)return n}return r},u.expandMulAdd=function(t,n){var e,i,r,l,o,a,h,c,p,f,d;for(o=[],f=n.children,a=0,c=f.length;c>a;a++){if(i=f[a],null!=i.copy&&(i=i.copy()),i instanceof u)for(l=t.copy(),d=i.children,h=0,p=d.length;p>h;h++)e=d[h],l.children.push(e);else i instanceof s?l=u.expandMulAdd(t,i):1===t.children.length?(l=t.copy(),l.children.push(i.copy())):l=new u(t.copy(),i.copy());o.push(l)}return r=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,o,function(){}),r=r.expand()},u.prototype.equals=function(t){var n,e,i,r,l;if(!(t instanceof u))return!1;if(t.children.length!==this.children.length)return!1;for(l=this.children,e=i=0,r=l.length;r>i;e=++i)if(n=l[e],null!=n.equals){if(!n.equals(t.children[e]))return!1}else if(n!==t.children[e])return!1;return!0},u.prototype.expand=function(){var t,n,e,i,r,l,o,a,h,c,p,f,d,y;for(i=[],f=this.children,l=0,h=f.length;h>l;l++)t=f[l],null!=t.expand?t=t.expand():null!=t.copy&&(t=t.copy()),i.push(t);for(;i.length>1;)if(i[0]instanceof u)if(i[1]instanceof s)i[0]=u.expandMulAdd(i[0],i.splice(1,1)[0]);else if(i[1]instanceof u)for(d=i.splice(1,1)[0].children,o=0,c=d.length;c>o;o++)t=d[o],i[0].children.push(t);else i[0].children.push(i.splice(1,1)[0]);else if(i[0]instanceof s)if(i[1]instanceof s){for(e=[],y=i[0].children,a=0,p=y.length;p>a;a++)t=y[a],n=new u(t,i[1]),n=n.expand(),e.push(n);i.splice(1,1),i[0]=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,e,function(){}),i[0]=i[0].expand()}else i[0]=i[1]instanceof u?u.expandMulAdd(i.splice(1,1)[0],i[0]):new u(i[0],i.splice(1,1)[0]);else i[0]=new u(i[0]);return"function"==typeof(r=i[0]).sort&&r.sort(),i[0]},u.prototype.simplify=function(){var t,n,e,i,r,o,a,c,p,f,d,y,g,m,w,v,b,M,T,x,S,L,V,A,C,q,E,_,j,k,O,H,N,I,X;for(w=[],j=this.children,b=0,S=j.length;S>b;b++)e=j[b],null!=e.simplify?e=e.simplify():null!=e.copy&&(e=e.copy()),w.push(e);for(p=[],i=null,o=0;o<w.length;){if(m=w[o],m instanceof u){for(e=w.splice(o,1)[0],k=e.children,M=0,L=k.length;L>M;M++)n=k[M],w.push(n);o-=1}else if(m instanceof l.Constant)i=null!=i?i.multiply(m):m.copy();else if(m instanceof h){for(t=m.children.left,g=m.children.right,r=!1,a=T=0,V=p.length;V>T;a=++T)c=p[a],null!=c[0].equals?c[0].equals(t)&&(p[a][1]=new s(c[1],g),p[a][1]=p[a][1].simplify(),1===(null!=(O=p[a][1].children)?O.length:void 0)&&(p[a][1]=p[a][1].children[0]),r=!0):c[0]===t&&(p[a][1]=new s(c[1],g),p[a][1]=p[a][1].simplify(),1===(null!=(H=p[a][1].children)?H.length:void 0)&&(p[a][1]=p[a][1].children[0]),r=!0);r||p.push([t,g])}else{for(r=!1,a=x=0,A=p.length;A>x;a=++x)c=p[a],null!=c[0].equals?c[0].equals(m)&&(p[a][1]=new s(c[1],new l.Constant("1")),p[a][1]=p[a][1].simplify(),1===(null!=(N=p[a][1].children)?N.length:void 0)&&(p[a][1]=p[a][1].children[0]),r=!0):c[0]===m&&(p[a][1]=new s(c[1],new l.Constant("1")),p[a][1]=p[a][1].simplify(),1===(null!=(I=p[a][1].children)?I.length:void 0)&&(p[a][1]=p[a][1].children[0]),r=!0);r||p.push([m,new l.Constant("1")])}o+=1}if(0===(null!=i?"function"==typeof i.evaluate?i.evaluate():void 0:void 0))return new l.Constant("0");for(f=null,E=0,C=p.length;C>E;E++)c=p[E],1!==("function"==typeof(v=c[1]).evaluate?v.evaluate():void 0)?(d=new h(c[0],c[1]),d=d.simplify()):d=c[0],null!=f?f.children.push(d):f=new u(d);if(null==f)return i;for(null!=i&&1!==i.evaluate()&&f.children.push(i),f.sort(),y=!0,X=f.children,_=0,q=X.length;q>_;_++)if(e=X[_],!(e instanceof l.Constant)){y=!1;break}return y?f.simplifyConstants():1!==f.children.length?f:f.children[0]},u.prototype.sort=function(){var t,n,e,i;for(i=this.children,n=0,e=i.length;e>n;n++)t=i[n],"function"==typeof t.sort&&t.sort();return this.children.sort(c)},u.prototype.expandAndSimplify=function(){var t;return t=this.expand(),null!=t.simplify?t.simplify():t},u.prototype.solve=function(t){var n,e,i,r,o,s;if(i=this.expandAndSimplify(),i instanceof l.Terminal){if(i instanceof l.Variable&&i.label===t)return[new l.Constant("0")];throw new a(i.toString(),t)}if(!(i instanceof u))return i.solve(t);for(s=i.children,r=0,o=s.length;o>r;r++){if(n=s[r],n instanceof l.Variable&&n.label===t)return[new l.Constant("0")];if(n instanceof h)try{return n.solve(t)}catch(c){if(e=c,e instanceof a)continue;throw e}}throw new a(i.toString(),t)},u.prototype.getAllVariables=function(){var t,n,e,i,r,o,s,a,u,h;for(r={},h=this.children,o=0,a=h.length;a>o;o++)if(t=h[o],t instanceof l.Variable)r[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),s=0,u=n.length;u>s;s++)i=n[s],r[i]=!0;e=[];for(i in r)e.push(i);return e},u.prototype.replaceVariables=function(t){var n,e,i,r,o,s;for(o=this.children,s=[],e=i=0,r=o.length;r>i;e=++i)n=o[e],n instanceof l.Variable&&n.label in t?s.push(this.children[e].label=t[n.label]):null!=n.replaceVariables?s.push(n.replaceVariables(t)):s.push(void 0);return s},u.prototype.sub=function(n){var e,i,r,o,s,a,h;for(o in n)n[o]instanceof l.Terminal||n[o]instanceof t.BasicNode||(n[o]=new l.Constant(n[o]));for(i=[],h=this.children,s=0,a=h.length;a>s;s++)e=h[s],e instanceof l.Variable&&e.label in n?i.push(n[e.label].copy()):null!=e.sub?i.push(e.sub(n)):i.push(e.copy());return r=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,i,function(){}),r=r.expandAndSimplify()},u.prototype.substituteExpression=function(t,n,e,i){var o,s,a,h,c,p,f,d;for(null==e&&(e=null),null==i&&(i=!1),i&&(t=t.solve(n)[0]),null==e&&(e={get:function(t){return[t]}}),h=e.get(n),s=[],f=this.children,c=0,p=f.length;p>c;c++)o=f[c],o instanceof l.Variable&&(o.label===n||(d=o.label,r.call(h,d)>=0))?s.push(t.copy()):null!=o.substituteExpression?s.push(o.substituteExpression(t,n,e)):s.push(o.copy());return a=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,s,function(){}),a.expandAndSimplify()},u.prototype.toMathML=function(t,n,e,i){var r,l,a,u,h;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),h=o.getMathMLInfo(t,n,e),a=h[0],u=h[1],l=h[2],i?r="</math></div>":(l="",r=""),l+"<mrow>"+this.children.map(function(e){return e instanceof s?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow>"+r},u.prototype.toHTML=function(t,n,e,i){var r,l,a,u,h;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),h=o.getHTMLInfo(t,n,e),a=h[0],u=h[1],l=h[2],i?r="</div>":(l="",r=""),l+this.children.map(function(t){return t instanceof s?"("+t.toHTML()+")":t.toHTML()}).join("&middot;")+r},u.prototype.toLaTeX=function(){return this.children.map(function(t){return t instanceof s?"\\left("+t.toLaTeX()+"\\right)":t.toLaTeX()}).join("\\cdot")},u}(t.RoseNode),h=function(e){function h(){var t,n,e,r;if(n=arguments[0],e=arguments[1],t=3<=arguments.length?i.call(arguments,2):[],null==n||null==e)throw new Error("Pow nodes must have two children.");if(t.length>0)throw new Error("Pow nodes must have two children.");this.cmp=-3,r=p(n,e),n=r[0],e=r[1],h.__super__.constructor.call(this,"**",n,e)
}return n(h,e),h.prototype.copy=function(){return new h(null!=this.children.left.copy?this.children.left.copy():this.children.left,null!=this.children.right.copy?this.children.right.copy():this.children.right)},h.prototype.sort=function(){var t,n;return"function"==typeof(t=this.children.left).sort&&t.sort(),"function"==typeof(n=this.children.right).sort?n.sort():void 0},h.prototype.equals=function(t){if(!(t instanceof h))return!1;if(null!=this.children.left.equals){if(!this.children.left.equals(t.children.left))return!1}else if(this.children.left!==t.children.left)return!1;if(null!=this.children.right.equals){if(!this.children.right.equals(t.children.right))return!1}else if(this.children.right!==t.children.right)return!1;return!0},h.prototype.compareSameType=function(t){var n;return n=c(this.children.left,t.children.left),0!==n?n:c(this.children.right,t.children.right)},h.prototype.expand=function(){var t,n,e,i,r,o,a,c,p,f,d,y,g;if(r=null!=this.children.left.expand?this.children.left.expand():null!=this.children.left.copy?this.children.left.copy():this.children.left,c=null!=this.children.right.expand?this.children.right.expand():null!=this.children.right.copy?this.children.right.copy():this.children.right,null!=r.children){if(r instanceof h)r.children.right=new u(r.children.right,c),r.expand();else if(r instanceof u)for(y=r.children,i=p=0,d=y.length;d>p;i=++p)t=y[i],a=new h(t,c),a=a.expand(),r.children[i]=a;else if(r instanceof s)if(c instanceof l.Constant&&0===c.evaluate()%1&&c.evaluate()>0){for(n=[],e=f=1,g=c.evaluate();g>=1?g>=f:f>=g;e=g>=1?++f:--f)n.push(r);o=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,n,function(){}),o=o.expand(),r=o}else r=new h(r,c);return r}return new h(r,c)},h.prototype.simplify=function(){var t,n,e,i;return t=null!=this.children.left.simplify?this.children.left.simplify():null!=this.children.left.copy?this.children.left.copy():this.children.left,i=null!=this.children.right.simplify?this.children.right.simplify():null!=this.children.right.copy?this.children.right.copy():this.children.right,1===("function"==typeof i.evaluate?i.evaluate():void 0)?t:1===("function"==typeof t.evaluate?t.evaluate():void 0)?t:0===("function"==typeof i.evaluate?i.evaluate():void 0)?new l.Constant("1"):i instanceof l.Constant&&t instanceof l.Constant?new l.Constant(Math.pow(t.evaluate(),i.evaluate())):t instanceof h?(e=new u(t.children.right,i),n=new h(t.children.left,e),n=n.simplify()):new h(t,i)},h.prototype.expandAndSimplify=function(){var t;return t=this.expand(),null!=t.simplify?t.simplify():t},h.prototype.solve=function(t){var n,e,i,r,o,s,c,p;if(e=this.expandAndSimplify(),e instanceof l.Terminal){if(e instanceof l.Variable&&e.label===t)return[new l.Constant("0")];throw new a(e.toString(),t)}if(e instanceof h){if(e.children.left instanceof l.Variable){if(e.children.left.label===t)return[new l.Constant("0")];throw new a(e.toString(),t)}if(e.children.left instanceof l.Terminal)throw new a(e.toString(),t);try{s=e.children.left.solve(t)}catch(f){throw n=f}if(null!=e.children.right.evaluate&&0===e.children.right.evaluate()%2){for(r=[],c=0,p=s.length;p>c;c++)o=s[c],i=new u(-1,o).simplify(),null!=i.equals?(i.equals(o)||r.push(i),r.push(o)):(i!==o&&r.push(i),r.push(o));return r}return s}return e.solve(t)},h.prototype.sub=function(n){var e,i,r,o;for(o in n)n[o]instanceof l.Terminal||n[o]instanceof t.BasicNode||(n[o]=new l.Constant(n[o]));return e=null,r=null,e=this.children.left instanceof l.Variable&&this.children.left.label in n?n[this.children.left.label].copy():null!=this.children.left.sub?this.children.left.sub(n):this.children.left.copy(),r=this.children.right instanceof l.Variable&&this.children.right.label in n?n[this.children.right.label].copy():null!=this.children.right.sub?this.children.right.sub(n):this.children.right.copy(),i=new h(e,r),i=i.expandAndSimplify()},h.prototype.getAllVariables=function(){var t,n,e,i,r,o,s,a,u;if(r={},this.children.left instanceof l.Variable)r[this.children.left.label]=!0;else if(null!=this.children.left.getAllVariables)for(t=this.children.left.getAllVariables(),o=0,a=t.length;a>o;o++)i=t[o],r[i]=!0;if(this.children.right instanceof l.Variable)r[this.children.right.label]=!0;else if(null!=this.children.right.getAllVariables)for(e=this.children.right.getAllVariables(),s=0,u=e.length;u>s;s++)i=e[s],r[i]=!0;n=[];for(i in r)n.push(i);return n},h.prototype.replaceVariables=function(t){return this.children.left instanceof l.Variable&&this.children.left.label in t?this.children.left.label=t[this.children.left.label]:null!=this.children.left.replaceVariables&&this.children.left.replaceVariables(t),this.children.right instanceof l.Variable&&this.children.right.label in t?this.children.right.label=t[this.children.right.label]:null!=this.children.right.replaceVariables?this.children.right.replaceVariables(t):void 0},h.prototype.substituteExpression=function(t,n,e,i){var o,s,a,u,c,p;return null==e&&(e=null),null==i&&(i=!1),i&&(t=t.solve(n)[0]),null==e&&(e={get:function(t){return[t]}}),u=e.get(n),o=this.children.left.copy(),a=this.children.right.copy(),this.children.left instanceof l.Variable&&(this.children.left.label===n||(c=this.children.left.label,r.call(u,c)>=0))?o=t.copy():this.children.left instanceof l.Terminal||(o=this.children.left.substituteExpression(t,n,e)),this.children.right instanceof l.Variable&&(this.children.right.label===n||(p=this.children.right.label,r.call(u,p)>=0))?a=t.copy():this.children.right instanceof l.Terminal||(a=this.children.right.substituteExpression(t,n,e)),s=new h(o,a),s=s.expandAndSimplify()},h.prototype.toMathML=function(t,n,e,i){var r,l,a,h,c,p,f,d,y,g,m;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),m=o.getMathMLInfo(t,n,e),h=m[0],c=m[1],l=m[2],i?r="</math></div>":(l="",r=""),1===("function"==typeof(f=this.children.right).evaluate?f.evaluate():void 0)?l+this.children.left.toMathML(t,n)+r:0===("function"==typeof(d=this.children.right).evaluate?d.evaluate():void 0)?l+"<mn>1</mn>"+r:(("function"==typeof(y=this.children.right).evaluate?y.evaluate():void 0)<0?(p=this.children.right.copy(),p=new u("-1",p),p=p.expandAndSimplify()):p=this.children.right.copy(),a=this.children.left instanceof s||this.children.left instanceof u?"<mfenced>"+this.children.left.toMathML(t,n)+"</mfenced>":""+this.children.left.toMathML(t,n),1!==("function"==typeof p.evaluate?p.evaluate():void 0)&&(a="<msup>"+a+p.toMathML(t,n)+"</msup>"),("function"==typeof(g=this.children.right).evaluate?g.evaluate():void 0)<0&&(a="<mfrac><mn>1</mn>"+a+"</mfrac>"),l+a+r)},h.prototype.toHTML=function(t,n,e,i){var r,s,a,u,h,c,p,f,d,y;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),y=o.getHTMLInfo(t,n,e),h=y[0],c=y[1],s=y[2],i?r="</div>":(s="",r=""),1===("function"==typeof(f=this.children.right).evaluate?f.evaluate():void 0)?s+this.children.left.toHTML()+r:0===("function"==typeof(d=this.children.right).evaluate?d.evaluate():void 0)?s+"1"+r:(u=this.children.left instanceof l.Terminal?this.children.left.toHTML():"("+this.children.left.toHTML()+")",p=this.children.right instanceof l.Terminal?this.children.right.toHTML():"("+this.children.right.toHTML()+")",a=""+u+" ** "+p,s+a+r)},h.prototype.toLaTeX=function(){var t,n,e,i,r;return 1===("function"==typeof(e=this.children.right).evaluate?e.evaluate():void 0)?this.children.left.toLaTeX():0===("function"==typeof(i=this.children.right).evaluate?i.evaluate():void 0)?"1":(t=this.children.left instanceof s||this.children.left instanceof u?"\\left("+this.children.left.toLaTeX()+"\\right)^{"+this.children.right.toLaTeX()+"}":""+this.children.left.toLaTeX()+"^{"+this.children.right.toLaTeX()+"}",("function"==typeof(r=this.children.right).evaluate?r.evaluate():void 0)<0&&(n=this.children.right.copy(),n=new u("-1",n),n=n.simplify(),t="\\frac{1}{"+t+"}"),t)},h}(t.BinaryNode),c=function(t,n){return null!=t.cmp&&null!=n.cmp?t.cmp===n.cmp?t.compareSameType(n):(t.cmp-n.cmp)/Math.abs(t.cmp-n.cmp):0},{Add:s,Mul:u,Pow:h,compare:c,AlgebraError:a}})}.call(this),function(){var t=[].slice,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("Equation",["terminals","nodes","operators","parse"],function(e,i,r,l){var o;return o=function(){function o(){var n,r;switch(n=1<=arguments.length?t.call(arguments,0):[],n.length){case 1:if(n[0]instanceof String||"string"==typeof n[0])switch(r=n[0].split("="),r.length){case 1:this.left=new e.Constant("0"),this.right=l.stringToExpression(r[0]),this.right=this.right.simplify();break;case 2:this.left=l.stringToTerminal(r[0]),this.right=l.stringToExpression(r[1]),this.right=this.right.simplify();break;default:throw new Error("Too many '=' signs.")}else{if(!(n[0]instanceof e.Terminal||n[0]instanceof i.BasicNode))throw new Error("Argument "+n[0]+" must be a String, Terminal, or Node.");this.left=new e.Constant("0"),this.right=n[0].copy()}break;case 2:if(n[0]instanceof String||"string"==typeof n[0])this.left=l.stringToTerminal(n[0]);else{if(!(n[0]instanceof e.Terminal||n[0]instanceof i.BasicNode))throw new Error("Argument "+n[0]+" must be a String, Terminal, or Node.");this.left=n[0].copy()}if(n[1]instanceof String||"string"==typeof n[1])this.right=l.stringToExpression(n[1]),this.right=this.right.simplify();else{if(!(n[1]instanceof e.Terminal||n[1]instanceof i.BasicNode))throw new Error("Argument "+n[1]+" must be a String, Terminal, or Node.");this.right=n[1].copy()}break;default:throw new Error("Too many arguments.")}}return o.prototype.solve=function(t){var n,e;return n=new r.Add(this.right,new r.Mul("-1",this.left)),e=n.solve(t),e.map(function(n){return new o(t,n)})},o.prototype.replaceVariables=function(t){return this.left.replaceVariables(t),this.right.replaceVariables(t)},o.prototype.getAllVariables=function(){var t,e,i,r,l;for(t=this.left.getAllVariables(),e=this.right.getAllVariables(),r=0,l=t.length;l>r;r++)i=t[r],n.call(e,i)<0&&e.unshift(i);return e},o.prototype.sub=function(t){var n;return this.left instanceof e.Variable&&this.left.label in t?(n=new r.Add(this.right,new r.Mul("-1",this.left)),new o(n.sub(t))):new o(this.left,this.right.sub(t))},o.prototype.substituteExpression=function(t,i,l,s){var a,u,h;return null==s&&(s=!1),t instanceof o&&(t=new r.Add(t.right,new r.Mul("-1",t.left))),null==l&&(l={get:function(t){return[t]}}),u=l.get(i),s&&(t=t.solve(i)[0]),this.left instanceof e.Variable&&(this.left.label===i||(h=this.left.label,n.call(u,h)>=0))?(a=new r.Add(this.right,new r.Mul("-1",this.left)),new o(a.substituteExpression(t,i,l))):new o(this.left,this.right.substituteExpression(t,i,l).expandAndSimplify())},o.prototype.toMathML=function(t,n,e,i){return null==n&&(n=!1),null==e&&(e=null),null==i&&(i=!1),this.right.toMathML(t,n,this.left,i)},o.prototype.toHTML=function(t,n,e,i){return null==n&&(n=!1),null==e&&(e=null),null==i&&(i=!1),this.right.toHTML(t,n,this.left,i)},o.prototype.toLaTeX=function(){return""+this.left.toLaTeX()+" = "+this.right.toLaTeX()},o.prototype.toString=function(){return""+this.left+" = "+this.right},o}()})}.call(this),function(){n.config({baseUrl:"./"}),e("coffeequate",["Equation","operators","terminals","parse"],function(t,n,e,i){return{Equation:t,tree:{operators:n,terminals:e},parse:i}})}.call(this),n(["coffeequate"]),n("coffeequate")});