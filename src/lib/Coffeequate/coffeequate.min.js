/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,n){"function"==typeof define&&define.amd?define(n):t.libGlobalName=n()}(this,function(){var t,n,e;return function(i){function r(t,n){return v.call(t,n)}function l(t,n){var e,i,r,l,o,s,a,u,h,c,p=n&&n.split("/"),f=b.map,d=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(n){for(p=p.slice(0,p.length-1),t=p.concat(t.split("/")),u=0;u<t.length;u+=1)if(c=t[u],"."===c)t.splice(u,1),u-=1;else if(".."===c){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||d)&&f){for(e=t.split("/"),u=e.length;u>0;u-=1){if(i=e.slice(0,u).join("/"),p)for(h=p.length;h>0;h-=1)if(r=f[p.slice(0,h).join("/")],r&&(r=r[i])){l=r,o=u;break}if(l)break;!s&&d&&d[i]&&(s=d[i],a=u)}!l&&s&&(l=s,o=a),l&&(e.splice(0,o,l),t=e.join("/"))}return t}function o(t,n){return function(){return f.apply(i,M.call(arguments,0).concat([t,n]))}}function s(t){return function(n){return l(n,t)}}function a(t){return function(n){g[t]=n}}function u(t){if(r(m,t)){var n=m[t];delete m[t],w[t]=!0,p.apply(i,n)}if(!r(g,t)&&!r(w,t))throw new Error("No "+t);return g[t]}function h(t){var n,e=t?t.indexOf("!"):-1;return e>-1&&(n=t.substring(0,e),t=t.substring(e+1,t.length)),[n,t]}function c(t){return function(){return b&&b.config&&b.config[t]||{}}}var p,f,d,y,g={},m={},b={},w={},v=Object.prototype.hasOwnProperty,M=[].slice;d=function(t,n){var e,i=h(t),r=i[0];return t=i[1],r&&(r=l(r,n),e=u(r)),r?t=e&&e.normalize?e.normalize(t,s(n)):l(t,n):(t=l(t,n),i=h(t),r=i[0],t=i[1],r&&(e=u(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:e}},y={require:function(t){return o(t)},exports:function(t){var n=g[t];return"undefined"!=typeof n?n:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:c(t)}}},p=function(t,n,e,l){var s,h,c,p,f,b,v=[];if(l=l||t,"function"==typeof e){for(n=!n.length&&e.length?["require","exports","module"]:n,f=0;f<n.length;f+=1)if(p=d(n[f],l),h=p.f,"require"===h)v[f]=y.require(t);else if("exports"===h)v[f]=y.exports(t),b=!0;else if("module"===h)s=v[f]=y.module(t);else if(r(g,h)||r(m,h)||r(w,h))v[f]=u(h);else{if(!p.p)throw new Error(t+" missing "+h);p.p.load(p.n,o(l,!0),a(h),{}),v[f]=g[h]}c=e.apply(g[t],v),t&&(s&&s.exports!==i&&s.exports!==g[t]?g[t]=s.exports:c===i&&b||(g[t]=c))}else t&&(g[t]=e)},t=n=f=function(t,n,e,r,l){return"string"==typeof t?y[t]?y[t](n):u(d(t,n).f):(t.splice||(b=t,n.splice?(t=n,n=e,e=null):t=i),n=n||function(){},"function"==typeof e&&(e=r,r=l),r?p(i,t,n,e):setTimeout(function(){p(i,t,n,e)},4),f)},f.config=function(t){return b=t,b.deps&&f(b.deps,b.callback),f},t._defined=g,e=function(t,n,e){n.splice||(e=n,n=[]),r(g,t)||r(m,t)||(m[t]=[t,n,e])},e.amd={jQuery:!0}}(),e("lib/almond",function(){}),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};e("parse",["require"],function(t){var e,i,r;return e=function(t){function e(t,n){this.input=t,this.type=n}return n(e,t),e.prototype.toString=function(){return"Could not parse '"+this.input+"' as "+this.type},e}(Error),r=function(n){var i;if(i=t("terminals"),/^-?\d+(\.\d+)?$/.test(n)||/^-?\d+(\.\d+)?\/\d+(\.\d+)?$/.test(n))return new i.Constant(n);if(/^[a-zA-Z][a-zA-Z_\-\d]*$/.test(n))return new i.Variable(n);if(/^\\[a-zA-Z][a-zA-Z_\-\d]*$/.test(n))return new i.SymbolicConstant(n.slice(1));throw new e(n,"terminal")},i=function(){function n(e){return this.tokens=n.tokenise(e).reverse(),this.upto=0,this.operators=t("operators"),this.parseAddition()}return n.tokenise=function(t){return t.split(/(\*\*|[+*()\-]|\s)/).filter(function(t){return!/^\s*$/.test(t)})},n.prototype.getToken=function(){return this.tokens[this.upto]},n.prototype.parseAddition=function(){var t,n;return n=this.parseMultiplication(),"+"!==this.getToken()?n:(this.upto+=1,t=this.parseAddition(),new this.operators.Add(t,n))},n.prototype.parseMultiplication=function(){var t,n;return n=this.parsePower(),"*"!==this.getToken()?n:(this.upto+=1,t=this.parseMultiplication(),new this.operators.Mul(t,n))},n.prototype.parsePower=function(){var t,n;return t=this.parseBracket(),"**"!==this.getToken()?t:(this.upto+=1,n=this.parsePower(),new this.operators.Pow(n,t))},n.prototype.parseBracket=function(){var t,n;if(")"===this.getToken()){if(this.upto+=1,t=this.parseAddition(),"("!==this.getToken())throw new Error("ParseError: Expected '(' but found '"+this.getToken()+"' at position "+(""+(this.tokens.length-this.upto)+"/"+this.tokens.length+" in token stream '"+this.tokens.reverse().join(" ")+"'"));return this.upto+=1,"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,t)):t}return n=this.parseTerm(),"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,n)):n},n.prototype.parseTerm=function(){var t;return t=r(this.getToken()),this.upto+=1,t},n}(),{ParseError:e,stringToExpression:function(t){return new i(t)},constant:function(t){if("string"==typeof t||t instanceof String){if(""===t)throw new e("","constant");if(t=t.split("/"),1===t.length)return[parseFloat(t[0]),1];if(2===t.length)return[parseFloat(t[0]),parseFloat(t[1])];throw new e(t.join("/"),"constant")}if("number"==typeof t||t instanceof Number)return[t,1];throw new e(t,"constant")},stringToTerminal:r}})}.call(this),function(){e("generateInfo",[],function(){return{getMathMLInfo:function(t,n,e){var i,r,l;return null==e&&(e="0"),r=n?"expression":"equation",l=""+r+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),i='<div id="'+l+'" class="'+r+'"><math xmlns="http://www.w3.org/1998/Math/MathML">'+(null!=e?(isFinite(e)?"<mn>"+e+"</mn>":null!=e.toMathML?""+e.toMathML(t,n):"<mi>"+e+"</mi>")+"<mo>=</mo>":""),[r,l,i]},getHTMLInfo:function(t,n,e){var i,r,l;return null==e&&(e="0"),r=n?"expression":"equation",l=""+r+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),i='<div id="'+l+'" class="'+r+'">'+(null!=e?(null!=e.toHTML?""+e.toHTML(t,n):""+e)+"=":""),[r,l,i]}}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n},i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("terminals",["parse","generateInfo"],function(t,e){var r,l,o,s;return o=function(){function t(t){this.label=t}return t.prototype.evaluate=function(){},t.prototype.copy=function(){return new t(this.label)},t.prototype.toString=function(){return this.label},t}(),r=function(i){function r(n,e){var i,r;this.denominator=null!=e?e:null,this.cmp=-6,null!=this.denominator?(i=t.constant(n),this.numerator=i[0],e=i[1],this.denominator*=e):(r=t.constant(n),this.numerator=r[0],this.denominator=r[1])}return n(r,i),r.prototype.evaluate=function(){return this.numerator/this.denominator},r.prototype.copy=function(){return new r(this.numerator,this.denominator)},r.prototype.compareSameType=function(t){return this.evaluate()<t.evaluate()?-1:this.evaluate()===t.evaluate()?0:1},r.prototype.multiply=function(t){return new r(this.numerator*t.numerator,this.denominator*t.denominator)},r.prototype.add=function(t){return new r(t.denominator*this.numerator+this.denominator*t.numerator,this.denominator*t.denominator)},r.prototype.equals=function(t){return t instanceof r?this.evaluate()===t.evaluate():!1},r.prototype.replaceVariables=function(){return this.copy()},r.prototype.getAllVariables=function(){return[]},r.prototype.sub=function(){return this.copy()},r.prototype.simplify=function(){return this.copy()},r.prototype.expand=function(){return this.copy()},r.prototype.expandAndSimplify=function(){return this.copy()},r.prototype.substituteExpression=function(){return this.copy()},r.prototype.toMathML=function(t,n,i,r){var l,o,s,a,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(u=e.getMathMLInfo(t,n,i),s=u[0],a=u[1],o=u[2],l="</math></div>"):(o="",l=""),1===this.denominator?o+("<mn>"+this.numerator+"</mn>")+l:o+("<mfrac><mrow><mn>"+this.numerator+"</mn></mrow><mrow><mn>"+this.denominator+"</mn></mrow></mfrac>")+l},r.prototype.toHTML=function(t,n,i,r){var l,o,s,a,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),u=e.getHTMLInfo(t,n,i),s=u[0],a=u[1],o=u[2],r?l="</div>":(o="",l=""),1===this.denominator?o+(""+this.numerator)+l:o+("("+this.numerator+"/"+this.denominator+")")+l},r.prototype.toLaTeX=function(){return 1===this.denominator?""+this.numerator:"\\frac{"+this.numerator+"}{"+this.denominator+"}"},r.prototype.toString=function(){return 1!==this.denominator?""+this.numerator+"/"+this.denominator:""+this.numerator},r}(o),l=function(t){function i(t,n){this.label=t,this.value=null!=n?n:null,this.cmp=-5}return n(i,t),i.prototype.copy=function(){return new i(this.label,this.value)},i.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},i.prototype.evaluate=function(){return this.value},i.prototype.equals=function(t){return t instanceof i?this.label===t.label&&this.value===t.value:!1},i.prototype.replaceVariables=function(){return this.copy()},i.prototype.getAllVariables=function(){return[]},i.prototype.sub=function(){return this.copy()},i.prototype.simplify=function(){return this.copy()},i.prototype.expand=function(){return this.copy()},i.prototype.expandAndSimplify=function(){return this.copy()},i.prototype.substituteExpression=function(){return this.copy()},i.prototype.toHTML=function(t,n,i,r){var l,o,s,a,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(u=e.getHTMLInfo(t,n,i),s=u[0],a=u[1],o=u[2],l="</div>"):(o="",l=""),o+this.toString()+l},i.prototype.toMathML=function(t,n,i,r){var l,o,s,a,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(u=e.getMathMLInfo(t,n,i),s=u[0],a=u[1],o=u[2],l="</math></div>"):(o="",l=""),""+o+"<mn>"+this.label+"</mn>"+l},i.prototype.toLaTeX=function(){return this.toString()},i}(o),s=function(t){function l(t){this.label=t,this.cmp=-4}return n(l,t),l.prototype.copy=function(){return new l(this.label)},l.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},l.prototype.equals=function(t,n){var e;return null==n&&(n=null),t instanceof l?null!=n?(e=this.label,i.call(n.get(t.label),e)>=0):t.label===this.label:!1},l.prototype.replaceVariables=function(t){return this.label in t?this.label=t[this.label]:void 0},l.prototype.getAllVariables=function(){return[this.label]},l.prototype.sub=function(t){var n;return this.label in t?(n=t[this.label],null!=n.copy?n.copy():new r(n)):this.copy()},l.prototype.substituteExpression=function(t,n,e,r){var l,o;return null==e&&(e=null),null==r&&(r=!1),null==e&&(e={get:function(t){return[t]}}),l=e.get(n),r&&(t=t.solve(n)[0]),this.label===n||(o=this.label,i.call(l,o)>=0)?t.copy():this.copy()},l.prototype.simplify=function(){return this.copy()},l.prototype.expand=function(){return this.copy()},l.prototype.expandAndSimplify=function(){return this.copy()},l.prototype.toMathML=function(t,n,i,r){var l,o,s,a,u,h,c,p;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(p=e.getMathMLInfo(t,n,i),h=p[0],c=p[1],o=p[2],l="</div>"):(o="",l=""),a=this.label.split("-"),s=a[0],u=null!=a[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",s.length>1?o+'<msub class="variable"'+u+"><mi>"+s[0]+"</mi><mi>"+s.slice(1)+"</mi></msub>"+l:o+'<mi class="variable"'+u+">"+s+"</mi>"+l},l.prototype.toHTML=function(t,n,i,r){var l,o,s,a,u,h,c,p;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(p=e.getHTMLInfo(t,n,i),h=p[0],c=p[1],o=p[2],l="</div>"):(o="",l=""),a=this.label.split("-"),s=a[0],u=null!=a[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",o+'<span class="variable"'+u+">"+s+"</span>"+l},l.prototype.toLaTeX=function(){return this.toString()},l}(o),{Terminal:o,Variable:s,Constant:r,SymbolicConstant:l}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};e("nodes",[],function(){var t;return t=function(){function t(t){this.label=t}return t.prototype.getChildren=function(){return[]},t}(),{BasicNode:t,RoseNode:function(t){function e(t,n){this.children=null!=n?n:null,null==this.children&&(this.children=[]),e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.getChildren=function(){return this.children},e.prototype.toLisp=function(){return"("+this.label+(this.children?" ":"")+this.children.join(" ")+")"},e.prototype.toString=function(){return"("+this.children.join(" "+this.label+" ")+")"},e}(t),BinaryNode:function(t){function e(t,n,e){this.label=t,this.children={left:n,right:e}}return n(e,t),e.prototype.getChildren=function(){return[this.children.left,this.children.right]},e.prototype.toLisp=function(){return"("+this.label+" "+this.children.left+" "+this.children.right+")"},e.prototype.toString=function(){return"("+this.children.left+" "+this.label+" "+this.children.right+")"},e}(t)}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n},i=[].slice,r=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators",["nodes","parse","terminals","generateInfo"],function(t,e,l,o){var s,a,u,h,c,p,f;return a=function(t){function e(t,n,i){null==i&&(i=null),e.__super__.constructor.call(this,"Unsolvable: "+t+" for "+n+(i?";"+i:""))}return n(e,t),e}(Error),f=function(t){var n,e,i,r;for(e=[],i=0,r=t.length;r>i;i++)n=t[i],n instanceof Array?e.push(f(n)):e.push("function"==typeof n.toString?n.toString():void 0);return"["+e.join(", ")+"]"},p=function(){var n,r,o,s,a;for(r=1<=arguments.length?i.call(arguments,0):[],o=[],s=0,a=r.length;a>s;s++)if(n=r[s],"string"==typeof n||n instanceof String)o.push(e.stringToTerminal(n));else if("number"==typeof n||n instanceof Number)o.push(new l.Constant(n));else{if(!(n instanceof l.Terminal||n instanceof t.BasicNode||null!=n.isTerminal))throw new Error("Invalid argument "+n+", ("+typeof n+"), ("+n.toString()+")");o.push(n)}return o},s=function(e){function s(){var t;if(t=1<=arguments.length?i.call(arguments,0):[],t.length<1)throw new Error("Add nodes must have at least one child.");this.cmp=-1,t=p.apply(null,t),s.__super__.constructor.call(this,"+",t)}return n(s,e),s.prototype.copy=function(){var t,n;return t=function(){var t,e,i,r;for(i=this.children,r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(null!=n.copy?n.copy():n);return r}.call(this),function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,t,function(){})},s.prototype.compareSameType=function(t){var n,e,i,r,l,o,s;for(r=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,s=this.children,i=l=0,o=s.length;o>l;i=++l){if(e=s[i],null==t.children[i])return 1;if(n=c(this.children[i],t.children[i]),0!==n)return n}return r},s.prototype.expand=function(){var t,n,e,i,r,l,o,a,u,h;for(i=[],u=this.children,r=0,o=u.length;o>r;r++)if(e=u[r],null!=e.expand?e=e.expand():null!=e.copy&&(e=e.copy()),e instanceof s)for(h=e.children,l=0,a=h.length;a>l;l++)n=h[l],i.push(n);else i.push(e);return t=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,i,function(){}),t.sort(),t},s.prototype.sort=function(){var t,n,e,i;for(i=this.children,n=0,e=i.length;e>n;n++)t=i[n],"function"==typeof t.sort&&t.sort();return this.children.sort(c)},s.prototype.equals=function(t,n){var e,i,r,l,o;if(!(t instanceof s))return!1;if(t.children.length!==this.children.length)return!1;for(o=this.children,i=r=0,l=o.length;l>r;i=++r)if(e=o[i],null!=e.equals){if(!e.equals(t.children[i],n))return!1}else if(e!==t.children[i])return!1;return!0},s.prototype.simplify=function(t){var n,e,i,r,o,a,h,c,p,f,d,y,g,m,b,w,v,M,T,x,S,L,V,A,C,q,E,_,j,k;for(null==t&&(t={get:function(t){return[t]}}),g=[],_=this.children,w=0,x=_.length;x>w;w++)e=_[w],null!=e.simplify?e=e.simplify(t):null!=e.copy&&(e=e.copy()),g.push(e);for(p=[],i=null,a=0;a<g.length;){if(y=g[a],y instanceof s){for(g.splice(a,1)[0],j=y.children,v=0,S=j.length;S>v;v++)n=j[v],g.push(n);a-=1}else if(y instanceof l.Constant)i=null!=i?i.add(y):y.copy();else if(y instanceof u){for(r=null,m=null,k=y.children,M=0,L=k.length;L>M;M++)e=k[M],e instanceof l.Constant?r=null!=r?r.multiply(e):e.copy():null!=m?m.children.push(e):m=new u(e);if(1===m.children.length&&(m=m.children[0]),null!=r&&null==m)i=null!=i?i.add(r):r.copy();else{for(null==r&&(r=new l.Constant("1")),o=!1,h=T=0,V=p.length;V>T;h=++T)c=p[h],null!=c[0].equals?c[0].equals(m,t)&&(p[h][1]=new s(c[1],r),p[h][1]=p[h][1].simplify(t),o=!0):c[0]===m&&(p[h][1]=new s(c[1],r),p[h][1]=p[h][1].simplify(t),o=!0);o||p.push([m,r])}}else{for(o=!1,h=q=0,A=p.length;A>q;h=++q)c=p[h],null!=c[0].equals?c[0].equals(y,t)&&(p[h][1]=new s(c[1],new l.Constant("1")),p[h][1]=p[h][1].simplify(t),o=!0):c[0]===y&&(p[h][1]=new s(c[1],new l.Constant("1")),p[h][1]=p[h][1].simplify(t),o=!0);o||p.push([y,new l.Constant("1")])}a+=1}for(f=null,E=0,C=p.length;C>E;E++)c=p[E],null!=c[0].children&&1===c[0].children.length&&(c[0]=c[0].children[0]),1!==("function"==typeof(b=c[1]).evaluate?b.evaluate():void 0)?(d=new u(c[0],c[1]),d=d.simplify(t)):d=c[0],null!=f?f.children.push(d):f=new s(d);return null==f?i:(null!=i&&0!==i.evaluate()&&f.children.push(i),f.sort(),1!==f.children.length?f:f.children[0])},s.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},s.prototype.solve=function(t,n){var e,i,o,c,p,f,d,y,g,m,b,w,v,M,T,x,S,L,V,A,C,q,E,_,j,k,O,H,N,I,X,P,B,z,$,F,Z,R,U,G,Q,D,J,K,W,Y,tn,nn,en,rn,ln,on,sn,an,un,hn,cn;if(null==n&&(n=null),g=this.expandAndSimplify(n),null==n&&(n={get:function(t){return[t]}}),B=[],z=[],g instanceof l.Terminal){if(g instanceof l.Variable&&(g.label===t||(tn=g.label,r.call(n.get(t),tn)>=0)))return[new l.Constant("0")];throw new a(g.toString(),t)}if(!(g instanceof s))return g.solve(t,n);for(nn=g.children,Z=0,Q=nn.length;Q>Z;Z++)if(P=nn[Z],null!=P.copy&&(P=P.copy()),P instanceof h)P.children.left instanceof l.Variable&&(P.children.left.label===t||(rn=P.children.left.label,r.call(n.get(t),rn)>=0))?B.push(P):z.push(P);else if(P instanceof u){for(c=!1,ln=P.children,R=0,D=ln.length;D>R;R++){if(I=ln[R],I instanceof l.Variable&&(I.label===t||(on=I.label,r.call(n.get(t),on)>=0))){B.push(P),c=!0;break}if(I instanceof h&&I.children.left instanceof l.Variable&&(I.children.left.label===t||(sn=I.children.left.label,r.call(n.get(t),sn)>=0))){B.push(P),c=!0;break}}c||z.push(P)}else P instanceof l.Variable&&(P.label===t||(an=P.label,r.call(n.get(t),an)>=0))?B.push(P):z.push(P);if(0===B.length)throw new a(g.toString(),t);for(m=[],w=[],S=[],V=[],U=0,J=B.length;J>U;U++)if(P=B[U],P instanceof l.Variable)m.push(new l.Constant("1"));else if(P instanceof h){if(!(P.children.right instanceof l.Constant))throw new a(g.toString(),t);if(O=P.children.right.evaluate(),!(P.children.left instanceof l.Variable&&(P.children.left.label===t||(un=P.children.left.label,r.call(n.get(t),un)>=0))))throw new a(g.toString(),t," (this shouldn't happen)");if(1===O)m.push(new l.Constant("1"));else if(2===O)w.push(new l.Constant("1"));else if(-1===O)S.push(new l.Constant("1"));else{if(-2!==O)throw new a(g.toString(),t," (not supported)");V.push(new l.Constant("1"))}}else if(P instanceof u){for(X=[],H=!1,T=!1,x=!1,hn=P.children,G=0,K=hn.length;K>G;G++)if(I=hn[G],I instanceof l.Variable&&(I.label===t||(cn=I.label,r.call(n.get(t),cn)>=0)));else if(I instanceof h){if(!(I.children.right instanceof l.Constant))throw new a(g.toString(),t);if(O=I.children.right.evaluate(),I.children.left instanceof l.Variable&&(I.children.left.label===t||(en=I.children.left.label,r.call(n.get(t),en)>=0)))if(1===O);else if(2===O)H=!0;else if(-1===O)T=!0;else{if(-2!==O)throw new a(g.toString(),t," (not supported)");x=!0}else X.push(I)}else X.push(I);M=X.length>0?function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,X,function(){}):new l.Constant("1"),H?w.push(M):T?S.push(M):x?V.push(M):m.push(M)}for(C=[],Y=0,W=z.length;W>Y;Y++)P=z[Y],_=new u("-1",null!=P.copy?P.copy():P),_=_.simplify(n),C.push(_);if(0!==C.length&&(q=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,C,function(){})),0!==z.length&&(k=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,z,function(){})),0!==m.length&&(b=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,m,function(){})),0!==w.length&&(v=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,w,function(){})),0!==S.length&&(L=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,S,function(){})),0!==V.length&&(A=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,V,function(){})),0===C.length&&(q=new l.Constant("0")),0===w.length){if(0===m.length){if(0===S.length){if(0===V.length)throw new a(g.toString(),t);return p=new u(new h(A,"1/2"),new h(q,"-1/2")),i=new u(-1,p.copy()),i=i.expandAndSimplify(n),o=p.expandAndSimplify(n),("function"==typeof i.equals?i.equals(o):void 0)?[i]:[i,o]}return 0===V.length?(p=new u(L,new h(q,"-1")),[p.expandAndSimplify(n)]):(E=new s(new u(k,new h(new l.Variable(t),2)),new u(L,new l.Variable(t)),A),E.solve(t,n))}if(0===S.length){if(0===V.length)return p=new u(q,new h(b,"-1")),[p.expandAndSimplify(n)];throw new a(g.toString(),t," (not supported)")}throw new a(g.toString(),t," (not supported)")}if(0===m.length){if(0===S.length){if(0===V.length)return p=new h(new u(q,new h(v,"-1")),"1/2"),i=new u("-1",p.copy()),i=i.expandAndSimplify(n),o=p.expandAndSimplify(n),("function"==typeof i.equals?i.equals(o):void 0)?[i]:[i,o];throw new a(g.toString(),t," (not supported)")}throw new a(g.toString(),t," (not supported)")}if(S.length>0||V.length>0)throw new a(g.toString(),t," (not supported)");return null!=k?(e=v,f=b,d=k,y=new s(new h(f,"2"),new u("-4",e,d)),N=new h(y,"1/2"),$=new u(new s(new u("-1",f),N),new h(new u("2",e),"-1")),F=new u("-1",new s(f,N),new h(new u("2",e),"-1")),$=$.expandAndSimplify(n),F=F.expandAndSimplify(n),null!=$.equals&&$.equals(F)?[$]:[$,F]):(j=new h(v,"-1"),_=new u("-1",b,j),_=_.simplify(n),[0,_])},s.prototype.getAllVariables=function(){var t,n,e,i,r,o,s,a,u,h;for(r={},h=this.children,o=0,a=h.length;a>o;o++)if(t=h[o],t instanceof l.Variable)r[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),s=0,u=n.length;u>s;s++)i=n[s],r[i]=!0;e=[];for(i in r)e.push(i);return e},s.prototype.replaceVariables=function(t){var n,e,i,r,o,s;for(o=this.children,s=[],e=i=0,r=o.length;r>i;e=++i)n=o[e],n instanceof l.Variable&&n.label in t?s.push(this.children[e].label=t[n.label]):null!=n.replaceVariables?s.push(n.replaceVariables(t)):s.push(void 0);return s},s.prototype.sub=function(n,e){var i,r,o,a,u,h,c;null==e&&(e=null);for(a in n)n[a]instanceof l.Terminal||n[a]instanceof t.BasicNode||(n[a]=new l.Constant(n[a]));for(r=[],c=this.children,u=0,h=c.length;h>u;u++)i=c[u],i instanceof l.Variable&&i.label in n?r.push(n[i.label].copy()):null!=i.sub?r.push(i.sub(n)):r.push(i.copy());return o=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,r,function(){}),o=o.expandAndSimplify(e)},s.prototype.substituteExpression=function(t,n,e,i){var o,a,u,h,c,p,f,d;for(null==e&&(e=null),null==i&&(i=!1),i&&(t=t.solve(n,e)[0]),null==e&&(e={get:function(t){return[t]}}),h=e.get(n),a=[],f=this.children,c=0,p=f.length;p>c;c++)o=f[c],o instanceof l.Variable&&(o.label===n||(d=o.label,r.call(h,d)>=0))?a.push(t.copy()):null!=o.substituteExpression?a.push(o.substituteExpression(t,n,e)):a.push(o.copy());return u=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,a,function(){}),console.log(u.toString()),u.expandAndSimplify(e)},s.prototype.toMathML=function(t,n,e,i){var r,l,s,a,u;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),u=o.getMathMLInfo(t,n,e),s=u[0],a=u[1],l=u[2],i?r="</math></div>":(l="",r=""),l+"<mrow>"+this.children.map(function(e){return e.toMathML(t,n)}).join("<mo>+</mo>")+"</mrow>"+r},s.prototype.toHTML=function(t,n,e,i){var r,l,s,a,u;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),u=o.getHTMLInfo(t,n,e),s=u[0],a=u[1],l=u[2],i?r="</div>":(l="",r=""),l+this.children.map(function(t){return t.toHTML()}).join("+")+r},s.prototype.toLaTeX=function(){return this.children.map(function(t){return t.toLaTeX()}).join("+")},s}(t.RoseNode),u=function(e){function u(){var t;if(t=1<=arguments.length?i.call(arguments,0):[],t.length<1)throw new Error("Mul nodes must have at least one child.");this.cmp=-2,t=p.apply(null,t),u.__super__.constructor.call(this,"*",t)}return n(u,e),u.prototype.copy=function(){var t,n;return t=function(){var t,e,i,r;for(i=this.children,r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(null!=n.copy?n.copy():n);return r}.call(this),function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,t,function(){})},u.prototype.simplifyConstants=function(){var t,n,e,i,r,o;for(n=new l.Constant("1"),e=null,o=this.children,i=0,r=o.length;r>i;i++)t=o[i],t instanceof l.Constant?n=n.multiply(t):null!=e?e.children.push(t):e=new u(t);return null==e?n:1===n.evaluate()?e:new u(n,e)},u.prototype.compareSameType=function(t){var n,e,i,r,l,o,s;for(r=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,s=this.children,i=l=0,o=s.length;o>l;i=++l){if(e=s[i],null==t.children[i])return 1;if(n=c(this.children[i],t.children[i]),0!==n)return n}return r},u.expandMulAdd=function(t,n){var e,i,r,l,o,a,h,c,p,f,d;for(o=[],f=n.children,a=0,c=f.length;c>a;a++){if(i=f[a],null!=i.copy&&(i=i.copy()),i instanceof u)for(l=t.copy(),d=i.children,h=0,p=d.length;p>h;h++)e=d[h],l.children.push(e);else i instanceof s?l=u.expandMulAdd(t,i):1===t.children.length?(l=t.copy(),l.children.push(i.copy())):l=new u(t.copy(),i.copy());o.push(l)}return r=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,o,function(){}),r=r.expand()},u.prototype.equals=function(t,n){var e,i,r,l,o;if(!(t instanceof u))return!1;if(t.children.length!==this.children.length)return!1;for(o=this.children,i=r=0,l=o.length;l>r;i=++r)if(e=o[i],null!=e.equals){if(!e.equals(t.children[i],n))return!1}else if(e!==t.children[i])return!1;return!0},u.prototype.expand=function(){var t,n,e,i,r,l,o,a,h,c,p,f,d,y;for(i=[],f=this.children,l=0,h=f.length;h>l;l++)t=f[l],null!=t.expand?t=t.expand():null!=t.copy&&(t=t.copy()),i.push(t);for(;i.length>1;)if(i[0]instanceof u)if(i[1]instanceof s)i[0]=u.expandMulAdd(i[0],i.splice(1,1)[0]);else if(i[1]instanceof u)for(d=i.splice(1,1)[0].children,o=0,c=d.length;c>o;o++)t=d[o],i[0].children.push(t);else i[0].children.push(i.splice(1,1)[0]);else if(i[0]instanceof s)if(i[1]instanceof s){for(e=[],y=i[0].children,a=0,p=y.length;p>a;a++)t=y[a],n=new u(t,i[1]),n=n.expand(),e.push(n);i.splice(1,1),i[0]=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(s,e,function(){}),i[0]=i[0].expand()}else i[0]=i[1]instanceof u?u.expandMulAdd(i.splice(1,1)[0],i[0]):new u(i[0],i.splice(1,1)[0]);else i[0]=new u(i[0]);return"function"==typeof(r=i[0]).sort&&r.sort(),i[0]},u.prototype.simplify=function(t){var n,e,i,r,o,a,c,p,f,d,y,g,m,b,w,v,M,T,x,S,L,V,A,C,q,E,_,j,k,O,H,N,I,X,P;for(null==t&&(t={get:function(t){return[t]}}),w=[],k=this.children,M=0,L=k.length;L>M;M++)i=k[M],null!=i.simplify?i=i.simplify(t):null!=i.copy&&(i=i.copy()),w.push(i);for(f=[],r=null,a=0;a<w.length;){if(b=w[a],b instanceof u){for(i=w.splice(a,1)[0],O=i.children,T=0,V=O.length;V>T;T++)e=O[T],w.push(e);a-=1}else if(b instanceof l.Constant)r=null!=r?r.multiply(b):b.copy();else if(b instanceof h){for(n=b.children.left,m=b.children.right,o=!1,c=x=0,A=f.length;A>x;c=++x)p=f[c],null!=p[0].equals?p[0].equals(n,t)&&(f[c][1]=new s(p[1],m),f[c][1]=f[c][1].simplify(t),1===(null!=(H=f[c][1].children)?H.length:void 0)&&(f[c][1]=f[c][1].children[0]),o=!0):p[0]===n&&(f[c][1]=new s(p[1],m),f[c][1]=f[c][1].simplify(t),1===(null!=(N=f[c][1].children)?N.length:void 0)&&(f[c][1]=f[c][1].children[0]),o=!0);o||f.push([n,m])}else{for(o=!1,c=S=0,C=f.length;C>S;c=++S)p=f[c],null!=p[0].equals?p[0].equals(b,t)&&(f[c][1]=new s(p[1],new l.Constant("1")),f[c][1]=f[c][1].simplify(t),1===(null!=(I=f[c][1].children)?I.length:void 0)&&(f[c][1]=f[c][1].children[0]),o=!0):p[0]===b&&(f[c][1]=new s(p[1],new l.Constant("1")),f[c][1]=f[c][1].simplify(t),1===(null!=(X=f[c][1].children)?X.length:void 0)&&(f[c][1]=f[c][1].children[0]),o=!0);o||f.push([b,new l.Constant("1")])}a+=1}if(0===(null!=r?"function"==typeof r.evaluate?r.evaluate():void 0:void 0))return new l.Constant("0");for(d=null,_=0,q=f.length;q>_;_++)p=f[_],1!==("function"==typeof(v=p[1]).evaluate?v.evaluate():void 0)?(y=new h(p[0],p[1]),y=y.simplify(t)):y=p[0],null!=d?d.children.push(y):d=new u(y);if(null==d)return r;for(null!=r&&1!==r.evaluate()&&d.children.push(r),d.sort(),g=!0,P=d.children,j=0,E=P.length;E>j;j++)if(i=P[j],!(i instanceof l.Constant)){g=!1;break}return g?d.simplifyConstants():1!==d.children.length?d:d.children[0]},u.prototype.sort=function(){var t,n,e,i;for(i=this.children,n=0,e=i.length;e>n;n++)t=i[n],"function"==typeof t.sort&&t.sort();return this.children.sort(c)},u.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},u.prototype.solve=function(t,n){var e,i,o,s,c,p,f,d;if(null==n&&(n=null),o=this.expandAndSimplify(n),null==n&&(n={get:function(t){return[t]}}),o instanceof l.Terminal){if(o instanceof l.Variable&&(o.label===t||(p=o.label,r.call(n.get(t),p)>=0)))return[new l.Constant("0")];throw new a(o.toString(),t)}if(!(o instanceof u))return o.solve(t,n);for(f=o.children,s=0,c=f.length;c>s;s++){if(e=f[s],e instanceof l.Variable&&(e.label===t||(d=e.label,r.call(n.get(t),d)>=0)))return[new l.Constant("0")];if(e instanceof h)try{return e.solve(t,n)}catch(y){if(i=y,i instanceof a)continue;throw i}}throw new a(o.toString(),t)},u.prototype.getAllVariables=function(){var t,n,e,i,r,o,s,a,u,h;for(r={},h=this.children,o=0,a=h.length;a>o;o++)if(t=h[o],t instanceof l.Variable)r[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),s=0,u=n.length;u>s;s++)i=n[s],r[i]=!0;e=[];for(i in r)e.push(i);return e},u.prototype.replaceVariables=function(t){var n,e,i,r,o,s;for(o=this.children,s=[],e=i=0,r=o.length;r>i;e=++i)n=o[e],n instanceof l.Variable&&n.label in t?s.push(this.children[e].label=t[n.label]):null!=n.replaceVariables?s.push(n.replaceVariables(t)):s.push(void 0);return s},u.prototype.sub=function(n,e){var i,r,o,s,a,h,c;null==e&&(e=null);for(s in n)n[s]instanceof l.Terminal||n[s]instanceof t.BasicNode||(n[s]=new l.Constant(n[s]));for(r=[],c=this.children,a=0,h=c.length;h>a;a++)i=c[a],i instanceof l.Variable&&i.label in n?r.push(n[i.label].copy()):null!=i.sub?r.push(i.sub(n)):r.push(i.copy());return o=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,r,function(){}),o=o.expandAndSimplify(e)},u.prototype.substituteExpression=function(t,n,e,i){var o,s,a,h,c,p,f,d;for(null==e&&(e=null),null==i&&(i=!1),i&&(t=t.solve(n,e)[0]),null==e&&(e={get:function(t){return[t]}}),h=e.get(n),s=[],f=this.children,c=0,p=f.length;p>c;c++)o=f[c],o instanceof l.Variable&&(o.label===n||(d=o.label,r.call(h,d)>=0))?s.push(t.copy()):null!=o.substituteExpression?s.push(o.substituteExpression(t,n,e)):s.push(o.copy());return a=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,s,function(){}),a.expandAndSimplify(e)},u.prototype.toMathML=function(t,n,e,i){var r,l,a,u,h;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),h=o.getMathMLInfo(t,n,e),a=h[0],u=h[1],l=h[2],i?r="</math></div>":(l="",r=""),l+"<mrow>"+this.children.map(function(e){return e instanceof s?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)
}).join("<mo>&middot;</mo>")+"</mrow>"+r},u.prototype.toHTML=function(t,n,e,i){var r,l,a,u,h;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),h=o.getHTMLInfo(t,n,e),a=h[0],u=h[1],l=h[2],i?r="</div>":(l="",r=""),l+this.children.map(function(t){return t instanceof s?"("+t.toHTML()+")":t.toHTML()}).join("&middot;")+r},u.prototype.toLaTeX=function(){return this.children.map(function(t){return t instanceof s?"\\left("+t.toLaTeX()+"\\right)":t.toLaTeX()}).join("\\cdot")},u}(t.RoseNode),h=function(e){function h(){var t,n,e,r;if(n=arguments[0],e=arguments[1],t=3<=arguments.length?i.call(arguments,2):[],null==n||null==e)throw new Error("Pow nodes must have two children.");if(t.length>0)throw new Error("Pow nodes must have two children.");this.cmp=-3,r=p(n,e),n=r[0],e=r[1],h.__super__.constructor.call(this,"**",n,e)}return n(h,e),h.prototype.copy=function(){return new h(null!=this.children.left.copy?this.children.left.copy():this.children.left,null!=this.children.right.copy?this.children.right.copy():this.children.right)},h.prototype.sort=function(){var t,n;return"function"==typeof(t=this.children.left).sort&&t.sort(),"function"==typeof(n=this.children.right).sort?n.sort():void 0},h.prototype.equals=function(t,n){if(!(t instanceof h))return!1;if(null!=this.children.left.equals){if(!this.children.left.equals(t.children.left,n))return!1}else if(this.children.left!==t.children.left)return!1;if(null!=this.children.right.equals){if(!this.children.right.equals(t.children.right,n))return!1}else if(this.children.right!==t.children.right)return!1;return!0},h.prototype.compareSameType=function(t){var n;return n=c(this.children.left,t.children.left),0!==n?n:c(this.children.right,t.children.right)},h.prototype.expand=function(){var t,n,e,i,r,o,a,c,p,f,d,y,g;if(r=null!=this.children.left.expand?this.children.left.expand():null!=this.children.left.copy?this.children.left.copy():this.children.left,c=null!=this.children.right.expand?this.children.right.expand():null!=this.children.right.copy?this.children.right.copy():this.children.right,null!=r.children){if(r instanceof h)r.children.right=new u(r.children.right,c),r.expand();else if(r instanceof u)for(y=r.children,i=p=0,d=y.length;d>p;i=++p)t=y[i],a=new h(t,c),a=a.expand(),r.children[i]=a;else if(r instanceof s)if(c instanceof l.Constant&&0===c.evaluate()%1&&c.evaluate()>0){for(n=[],e=f=1,g=c.evaluate();g>=1?g>=f:f>=g;e=g>=1?++f:--f)n.push(r);o=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,n,function(){}),o=o.expand(),r=o}else r=new h(r,c);return r}return new h(r,c)},h.prototype.simplify=function(t){var n,e,i,r;return null==t&&(t={get:function(t){return[t]}}),n=null!=this.children.left.simplify?this.children.left.simplify(t):null!=this.children.left.copy?this.children.left.copy():this.children.left,r=null!=this.children.right.simplify?this.children.right.simplify(t):null!=this.children.right.copy?this.children.right.copy():this.children.right,1===("function"==typeof r.evaluate?r.evaluate():void 0)?n:1===("function"==typeof n.evaluate?n.evaluate():void 0)?n:0===("function"==typeof r.evaluate?r.evaluate():void 0)?new l.Constant("1"):r instanceof l.Constant&&n instanceof l.Constant?new l.Constant(Math.pow(n.evaluate(),r.evaluate())):n instanceof h?(i=new u(n.children.right,r),e=new h(n.children.left,i),e=e.simplify(t)):new h(n,r)},h.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},h.prototype.solve=function(t,n){var e,i,o,s,c,p,f,d,y,g;if(null==n&&(n={get:function(t){return[t]}}),i=this.expandAndSimplify(n),i instanceof l.Terminal){if(i instanceof l.Variable&&(i.label===t||(y=i.label,r.call(n.get(t),y)>=0)))return[new l.Constant("0")];throw new a(i.toString(),t)}if(i instanceof h){if(i.children.left instanceof l.Variable){if(i.children.left.label===t||(g=i.children.left.label,r.call(n.get(t),g)>=0))return[new l.Constant("0")];throw new a(i.toString(),t)}if(i.children.left instanceof l.Terminal)throw new a(i.toString(),t);try{p=i.children.left.solve(t,n)}catch(m){throw e=m}if(null!=i.children.right.evaluate&&0===i.children.right.evaluate()%2){for(s=[],f=0,d=p.length;d>f;f++)c=p[f],o=new u(-1,c).simplify(n),null!=o.equals?(o.equals(c)||s.push(o),s.push(c)):(o!==c&&s.push(o),s.push(c));return s}return p}return i.solve(t,n)},h.prototype.sub=function(n,e){var i,r,o,s;null==e&&(e=null);for(s in n)n[s]instanceof l.Terminal||n[s]instanceof t.BasicNode||(n[s]=new l.Constant(n[s]));return i=null,o=null,i=this.children.left instanceof l.Variable&&this.children.left.label in n?n[this.children.left.label].copy():null!=this.children.left.sub?this.children.left.sub(n):this.children.left.copy(),o=this.children.right instanceof l.Variable&&this.children.right.label in n?n[this.children.right.label].copy():null!=this.children.right.sub?this.children.right.sub(n):this.children.right.copy(),r=new h(i,o),r=r.expandAndSimplify(e)},h.prototype.getAllVariables=function(){var t,n,e,i,r,o,s,a,u;if(r={},this.children.left instanceof l.Variable)r[this.children.left.label]=!0;else if(null!=this.children.left.getAllVariables)for(t=this.children.left.getAllVariables(),o=0,a=t.length;a>o;o++)i=t[o],r[i]=!0;if(this.children.right instanceof l.Variable)r[this.children.right.label]=!0;else if(null!=this.children.right.getAllVariables)for(e=this.children.right.getAllVariables(),s=0,u=e.length;u>s;s++)i=e[s],r[i]=!0;n=[];for(i in r)n.push(i);return n},h.prototype.replaceVariables=function(t){return this.children.left instanceof l.Variable&&this.children.left.label in t?this.children.left.label=t[this.children.left.label]:null!=this.children.left.replaceVariables&&this.children.left.replaceVariables(t),this.children.right instanceof l.Variable&&this.children.right.label in t?this.children.right.label=t[this.children.right.label]:null!=this.children.right.replaceVariables?this.children.right.replaceVariables(t):void 0},h.prototype.substituteExpression=function(t,n,e,i){var o,s,a,u,c,p;return null==e&&(e=null),null==i&&(i=!1),i&&(t=t.solve(n,e)[0]),null==e&&(e={get:function(t){return[t]}}),u=e.get(n),o=this.children.left.copy(),a=this.children.right.copy(),this.children.left instanceof l.Variable&&(this.children.left.label===n||(c=this.children.left.label,r.call(u,c)>=0))?o=t.copy():this.children.left instanceof l.Terminal||(o=this.children.left.substituteExpression(t,n,e)),this.children.right instanceof l.Variable&&(this.children.right.label===n||(p=this.children.right.label,r.call(u,p)>=0))?a=t.copy():this.children.right instanceof l.Terminal||(a=this.children.right.substituteExpression(t,n,e)),s=new h(o,a),s=s.expandAndSimplify(e)},h.prototype.toMathML=function(t,n,e,i){var r,l,a,h,c,p,f,d,y,g,m;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),m=o.getMathMLInfo(t,n,e),h=m[0],c=m[1],l=m[2],i?r="</math></div>":(l="",r=""),1===("function"==typeof(f=this.children.right).evaluate?f.evaluate():void 0)?l+this.children.left.toMathML(t,n)+r:0===("function"==typeof(d=this.children.right).evaluate?d.evaluate():void 0)?l+"<mn>1</mn>"+r:(("function"==typeof(y=this.children.right).evaluate?y.evaluate():void 0)<0?(p=this.children.right.copy(),p=new u("-1",p),p=p.expandAndSimplify()):p=this.children.right.copy(),a=this.children.left instanceof s||this.children.left instanceof u?"<mfenced>"+this.children.left.toMathML(t,n)+"</mfenced>":""+this.children.left.toMathML(t,n),1!==("function"==typeof p.evaluate?p.evaluate():void 0)&&(a="<msup>"+a+p.toMathML(t,n)+"</msup>"),("function"==typeof(g=this.children.right).evaluate?g.evaluate():void 0)<0&&(a="<mfrac><mn>1</mn>"+a+"</mfrac>"),l+a+r)},h.prototype.toHTML=function(t,n,e,i){var r,s,a,u,h,c,p,f,d,y;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),y=o.getHTMLInfo(t,n,e),h=y[0],c=y[1],s=y[2],i?r="</div>":(s="",r=""),1===("function"==typeof(f=this.children.right).evaluate?f.evaluate():void 0)?s+this.children.left.toHTML()+r:0===("function"==typeof(d=this.children.right).evaluate?d.evaluate():void 0)?s+"1"+r:(u=this.children.left instanceof l.Terminal?this.children.left.toHTML():"("+this.children.left.toHTML()+")",p=this.children.right instanceof l.Terminal?this.children.right.toHTML():"("+this.children.right.toHTML()+")",a=""+u+" ** "+p,s+a+r)},h.prototype.toLaTeX=function(){var t,n,e,i,r;return 1===("function"==typeof(e=this.children.right).evaluate?e.evaluate():void 0)?this.children.left.toLaTeX():0===("function"==typeof(i=this.children.right).evaluate?i.evaluate():void 0)?"1":(t=this.children.left instanceof s||this.children.left instanceof u?"\\left("+this.children.left.toLaTeX()+"\\right)^{"+this.children.right.toLaTeX()+"}":""+this.children.left.toLaTeX()+"^{"+this.children.right.toLaTeX()+"}",("function"==typeof(r=this.children.right).evaluate?r.evaluate():void 0)<0&&(n=this.children.right.copy(),n=new u("-1",n),n=n.simplify(),t="\\frac{1}{"+t+"}"),t)},h}(t.BinaryNode),c=function(t,n){return null!=t.cmp&&null!=n.cmp?t.cmp===n.cmp?t.compareSameType(n):(t.cmp-n.cmp)/Math.abs(t.cmp-n.cmp):0},{Add:s,Mul:u,Pow:h,compare:c,AlgebraError:a}})}.call(this),function(){var t=[].slice,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("Equation",["terminals","nodes","operators","parse"],function(e,i,r,l){var o;return o=function(){function o(){var n,r;switch(n=1<=arguments.length?t.call(arguments,0):[],n.length){case 1:if(n[0]instanceof String||"string"==typeof n[0])switch(r=n[0].split("="),r.length){case 1:this.left=new e.Constant("0"),this.right=l.stringToExpression(r[0]),this.right=this.right.simplify();break;case 2:this.left=l.stringToTerminal(r[0]),this.right=l.stringToExpression(r[1]),this.right=this.right.simplify();break;default:throw new Error("Too many '=' signs.")}else{if(!(n[0]instanceof e.Terminal||n[0]instanceof i.BasicNode))throw new Error("Argument "+n[0]+" must be a String, Terminal, or Node.");this.left=new e.Constant("0"),this.right=n[0].copy()}break;case 2:if(n[0]instanceof String||"string"==typeof n[0])this.left=l.stringToTerminal(n[0]);else{if(!(n[0]instanceof e.Terminal||n[0]instanceof i.BasicNode))throw new Error("Argument "+n[0]+" must be a String, Terminal, or Node.");this.left=n[0].copy()}if(n[1]instanceof String||"string"==typeof n[1])this.right=l.stringToExpression(n[1]),this.right=this.right.simplify();else{if(!(n[1]instanceof e.Terminal||n[1]instanceof i.BasicNode))throw new Error("Argument "+n[1]+" must be a String, Terminal, or Node.");this.right=n[1].copy()}break;default:throw new Error("Too many arguments.")}}return o.prototype.solve=function(t,n){var e,i;return null==n&&(n=null),e=new r.Add(this.right,new r.Mul("-1",this.left)),i=e.solve(t,n),i.map(function(n){return new o(t,n)})},o.prototype.replaceVariables=function(t){return this.left.replaceVariables(t),this.right.replaceVariables(t)},o.prototype.getAllVariables=function(){var t,e,i,r,l;for(t=this.left.getAllVariables(),e=this.right.getAllVariables(),r=0,l=t.length;l>r;r++)i=t[r],n.call(e,i)<0&&e.unshift(i);return e},o.prototype.sub=function(t){var n;return this.left instanceof e.Variable&&this.left.label in t?(n=new r.Add(this.right,new r.Mul("-1",this.left)),new o(n.sub(t))):new o(this.left,this.right.sub(t))},o.prototype.substituteExpression=function(t,i,l,s){var a,u,h;return null==s&&(s=!1),t instanceof o&&(t=new r.Add(t.right,new r.Mul("-1",t.left))),null==l&&(l={get:function(t){return[t]}}),u=l.get(i),s&&(t=t.solve(i,l)[0]),this.left instanceof e.Variable&&(this.left.label===i||(h=this.left.label,n.call(u,h)>=0))?(a=new r.Add(this.right,new r.Mul("-1",this.left)),new o(a.substituteExpression(t,i,l))):new o(this.left,this.right.substituteExpression(t,i,l).expandAndSimplify(l))},o.prototype.toMathML=function(t,n,e,i){return null==n&&(n=!1),null==e&&(e=null),null==i&&(i=!1),this.right.toMathML(t,n,this.left,i)},o.prototype.toHTML=function(t,n,e,i){return null==n&&(n=!1),null==e&&(e=null),null==i&&(i=!1),this.right.toHTML(t,n,this.left,i)},o.prototype.toLaTeX=function(){return""+this.left.toLaTeX()+" = "+this.right.toLaTeX()},o.prototype.toString=function(){return""+this.left+" = "+this.right},o}()})}.call(this),function(){n.config({baseUrl:"./"}),e("coffeequate",["Equation","operators","terminals","parse"],function(t,n,e,i){return{Equation:t,tree:{operators:n,terminals:e},parse:i}})}.call(this),n(["coffeequate"]),n("coffeequate")});