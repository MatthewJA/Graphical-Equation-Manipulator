/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,n){"function"==typeof define&&define.amd?define(n):t.libGlobalName=n()}(this,function(){var t,n,e;return function(r){function i(t,n){return v.call(t,n)}function o(t,n){var e,r,i,o,l,a,u,s,h,c,p=n&&n.split("/"),f=w.map,d=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(n){for(p=p.slice(0,p.length-1),t=p.concat(t.split("/")),s=0;s<t.length;s+=1)if(c=t[s],"."===c)t.splice(s,1),s-=1;else if(".."===c){if(1===s&&(".."===t[2]||".."===t[0]))break;s>0&&(t.splice(s-1,2),s-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||d)&&f){for(e=t.split("/"),s=e.length;s>0;s-=1){if(r=e.slice(0,s).join("/"),p)for(h=p.length;h>0;h-=1)if(i=f[p.slice(0,h).join("/")],i&&(i=i[r])){o=i,l=s;break}if(o)break;!a&&d&&d[r]&&(a=d[r],u=s)}!o&&a&&(o=a,l=u),o&&(e.splice(0,l,o),t=e.join("/"))}return t}function l(t,n){return function(){return f.apply(r,M.call(arguments,0).concat([t,n]))}}function a(t){return function(n){return o(n,t)}}function u(t){return function(n){y[t]=n}}function s(t){if(i(m,t)){var n=m[t];delete m[t],b[t]=!0,p.apply(r,n)}if(!i(y,t)&&!i(b,t))throw new Error("No "+t);return y[t]}function h(t){var n,e=t?t.indexOf("!"):-1;return e>-1&&(n=t.substring(0,e),t=t.substring(e+1,t.length)),[n,t]}function c(t){return function(){return w&&w.config&&w.config[t]||{}}}var p,f,d,g,y={},m={},w={},b={},v=Object.prototype.hasOwnProperty,M=[].slice;d=function(t,n){var e,r=h(t),i=r[0];return t=r[1],i&&(i=o(i,n),e=s(i)),i?t=e&&e.normalize?e.normalize(t,a(n)):o(t,n):(t=o(t,n),r=h(t),i=r[0],t=r[1],i&&(e=s(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:e}},g={require:function(t){return l(t)},exports:function(t){var n=y[t];return"undefined"!=typeof n?n:y[t]={}},module:function(t){return{id:t,uri:"",exports:y[t],config:c(t)}}},p=function(t,n,e,o){var a,h,c,p,f,w,v=[];if(o=o||t,"function"==typeof e){for(n=!n.length&&e.length?["require","exports","module"]:n,f=0;f<n.length;f+=1)if(p=d(n[f],o),h=p.f,"require"===h)v[f]=g.require(t);else if("exports"===h)v[f]=g.exports(t),w=!0;else if("module"===h)a=v[f]=g.module(t);else if(i(y,h)||i(m,h)||i(b,h))v[f]=s(h);else{if(!p.p)throw new Error(t+" missing "+h);p.p.load(p.n,l(o,!0),u(h),{}),v[f]=y[h]}c=e.apply(y[t],v),t&&(a&&a.exports!==r&&a.exports!==y[t]?y[t]=a.exports:c===r&&w||(y[t]=c))}else t&&(y[t]=e)},t=n=f=function(t,n,e,i,o){return"string"==typeof t?g[t]?g[t](n):s(d(t,n).f):(t.splice||(w=t,n.splice?(t=n,n=e,e=null):t=r),n=n||function(){},"function"==typeof e&&(e=i,i=o),i?p(r,t,n,e):setTimeout(function(){p(r,t,n,e)},4),f)},f.config=function(t){return w=t,w.deps&&f(w.deps,w.callback),f},t._defined=y,e=function(t,n,e){n.splice||(e=n,n=[]),i(y,t)||i(m,t)||(m[t]=[t,n,e])},e.amd={jQuery:!0}}(),e("lib/almond",function(){}),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};e("parse",["require"],function(t){var e,r,i,o,l,a,u,s;return i=function(t){function e(t,n){this.input=t,this.type=n}return n(e,t),e.prototype.toString=function(){return"Could not parse '"+this.input+"' as "+this.type},e}(Error),u=/^@*[a-zA-Zα-ωΑ-Ω][a-zA-Zα-ωΑ-Ω_\-\d]*$/,e=/^-?\d+(\.\d+)?$/,o=/^-?\d+(\.\d+)?\/\d+(\.\d+)?$/,l=/^\\@*[a-zA-Zα-ωΑ-Ω][a-zA-Zα-ωΑ-Ω_\-\d]*$/,r=/^[^:]*::\{[^:+]*\}$/,s=function(n){var h,c,p;if(/\^/.test(n))throw new Error("Unexpected carat (^). Coffeequate uses ** for exponentiation");if(r.test(n))return h=n.split("::"),c=s(h[0]),c.units=new a(h[1].slice(1,h[1].length-1)),c;if(n=n.trim(),p=t("terminals"),e.test(n)||o.test(n))return new p.Constant(n);if(u.test(n))return"σ"===n[0]?new p.Uncertainty(n.slice(1)):new p.Variable(n);if(l.test(n))return new p.SymbolicConstant(n.slice(1));throw new i(n,"terminal")},a=function(){function n(e,r){var i;return null==r&&(r=!0),this.tokens=n.tokenise(e).reverse(),this.upto=0,this.operators=t("operators"),i=this.parseAddition(),r&&(i=i.expandAndSimplify()),i}return n.tokenise=function(t){return t.split(/(\*\*|[+*()\-:]|\s)/).filter(function(t){return!/^\s*$/.test(t)})},n.prototype.getToken=function(){return this.tokens[this.upto]},n.prototype.parseAddition=function(){var t,n;return n=this.parseMultiplication(),"+"!==this.getToken()?n:(this.upto+=1,t=this.parseAddition(),new this.operators.Add(t,n))},n.prototype.parseMultiplication=function(){var t,n;if(n=this.parsePower(),this.getToken()&&u.test(this.getToken()))throw new i(this.getToken(),"multiplication");return"*"!==this.getToken()?n:(this.upto+=1,t=this.parseMultiplication(),new this.operators.Mul(t,n))},n.prototype.parsePower=function(){var t,n;return t=this.parseBracket(),"**"!==this.getToken()?t:(this.upto+=1,n=this.parsePower(),new this.operators.Pow(n,t))},n.prototype.parseBracket=function(){var t,n;if(")"===this.getToken()){if(this.upto+=1,t=this.parseAddition(),"("!==this.getToken())throw new Error("ParseError: Expected '(' but found '"+this.getToken()+"' at position "+(""+(this.tokens.length-this.upto)+"/"+this.tokens.length+" in token stream '"+this.tokens.reverse().join(" ")+"'"));return this.upto+=1,"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,t)):t}return n=this.parseTerm(),"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,n)):n},n.prototype.parseTerm=function(){var t,n;if(n=[],"}"===this.getToken()[this.getToken().length-1]){for(;":"!==this.getToken()[0];)n.push(this.getToken()),this.upto+=1;n.push(this.getToken()),this.upto+=1,n.push(this.getToken()),this.upto+=1,n.push(this.getToken()),t=s(n.reverse().join(""))}else t=s(this.getToken());return this.upto+=1,t},n}(),{ParseError:i,stringToExpression:function(t,n){return null==n&&(n=!0),new a(t,n)},constant:function(t){if("string"==typeof t||t instanceof String){if(""===t)throw new i("","constant");if(t=t.split("/"),1===t.length)return[parseFloat(t[0]),1];if(2===t.length)return[parseFloat(t[0]),parseFloat(t[1])];throw new i(t.join("/"),"constant")}if("number"==typeof t||t instanceof Number)return[t,1];throw new i(t,"constant")},stringToTerminal:s}})}.call(this),function(){e("generateInfo",[],function(){return{getMathMLInfo:function(t,n,e){var r,i,o,l;return null==e&&(e="0"),i=n?"expression":"equation",o=""+i+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),l=null!=t?'id="'+o+'"':"",r="<div "+l+' class="'+i+'"><math xmlns="http://www.w3.org/1998/Math/MathML">'+(null!=e?(isFinite(e)?"<mn>"+e+"</mn>":null!=e.toMathML?""+e.toMathML(t,n):"<mi>"+e+"</mi>")+"<mo>=</mo>":""),[i,o,r]},getHTMLInfo:function(t,n,e){var r,i,o,l;return null==e&&(e="0"),i=n?"expression":"equation",o=""+i+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),l=null!=t?'id="'+o+'"':"",r="<div "+l+' class="'+i+'">'+(null!=e?(null!=e.toHTML?""+e.toHTML(t,n):""+e)+"=":""),[i,o,r]}}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};e("nodes",["generateInfo"],function(t){var e;return e=function(){function n(t){this.label=t}return n.prototype.getChildren=function(){return[]},n.prototype.getAllVariables=function(){return[]},n.prototype.toDrawingNode=function(){throw new Error("toDrawingNode not implemented for "+self.toString())},n.prototype.toLaTeX=function(){return this.toDrawingNode().renderLaTeX()},n.prototype.toString=function(){return this.toDrawingNode().renderString()},n.prototype.toMathML2=function(n,e,r){var i,o,l,a,u;return null==r&&(r="0"),u=t.getMathMLInfo(n,e,r),o=u[0],l=u[1],a=u[2],i="</math></div>",a+this.toDrawingNode().renderMathML(n,e)+i},n.prototype.stringEqual=function(t){return t.toString()===this.toString()},n}(),{BasicNode:e,RoseNode:function(t){function e(t,n){this.children=null!=n?n:null,null==this.children&&(this.children=[]),e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.getChildren=function(){return this.children},e.prototype.toLisp=function(){var t;return t=this.children.map(function(t){return t.toLisp?t.toLisp():t}),"("+this.label+(this.children?" ":"")+t.join(" ")+")"},e}(e),BinaryNode:function(t){function e(t,n,e){this.label=t,this.children={left:n,right:e}}return n(e,t),e.prototype.getChildren=function(){return[this.children.left,this.children.right]},e.prototype.toLisp=function(){var t;return t=function(t){return t.toLisp?t.toLisp():t},"("+this.label+" "+t(this.children.left)+" "+t(this.children.right)+")"},e}(e)}})}.call(this),function(){var t=[].slice,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};e("prettyRender",[],function(){var n,e,i,o,l,a,u,s,h,c;return i=function(){function t(){}return t.prototype.toString=function(){throw new Error("not implemented")},t.prototype.renderLaTeX=function(){throw new Error("not implemented")},t.prototype.bindingStrength=function(){return 8},t.prototype.bracketIfNeeded=function(t){return t.bindingStrength()<=this.bindingStrength()?new e(t):t},t}(),i.makeWithBrackets=function(){var n,r;return r=1<=arguments.length?t.call(arguments,0):[],n=new this,r=r.map(function(t){return t.bindingStrength()<=n.bindingStrength()?new e(t):t}),n.terms=r,n},n=function(n){function e(){var n;n=1<=arguments.length?t.call(arguments,0):[],this.terms=n}return r(e,n),e.prototype.bindingStrength=function(){return 4},e.prototype.renderLaTeX=function(){return this.terms.map(function(t){return t.renderLaTeX()}).join(" + ")},e.prototype.renderString=function(){return this.terms.map(function(t){return t.renderString()}).join(" + ")},e.prototype.renderMathML=function(t,n){return this.terms.map(function(e){return e.renderMathML(t,n)}).join("<mo>+</mo>")},e}(i),l=function(n){function e(){var n;n=1<=arguments.length?t.call(arguments,0):[],this.terms=n}return r(e,n),e.prototype.bindingStrength=function(){return 6},e.prototype.renderLaTeX=function(){return this.terms.map(function(t){return t.renderLaTeX()}).join(" \\cdot ")},e.prototype.renderString=function(){return this.terms.map(function(t){return t.renderString()}).join("*")},e.prototype.renderMathML=function(){},e}(i),u=function(t){function n(t,n){this.left=t,this.right=n}return r(n,t),n.prototype.renderLaTeX=function(){return""+this.left.renderLaTeX()+"^{"+this.right.renderLaTeX()+"}"},n.prototype.renderString=function(){return""+this.left.renderString()+"**"+this.bracketIfNeeded(this.right).renderString()},n}(i),e=function(t){function n(t){this.contents=t}return r(n,t),n.prototype.bindingStrength=function(){return 9},n.prototype.renderLaTeX=function(){return"\\left("+this.contents.renderLaTeX()+"\\right)"},n.prototype.renderString=function(){return"("+this.contents.renderString()+")"},n.prototype.renderMathML=function(t,n){return"<mfenced>"+this.contents.renderMathML(t,n)+"</mfenced>"},n}(i),a=function(t){function n(t){this.value=t}return r(n,t),n.prototype.bindingStrength=function(){return 10},n.prototype.renderLaTeX=function(){return this.value+""},n.prototype.renderString=function(){return this.value+""},n.prototype.renderMathML=function(){return'<mn class="constant">'+this.value+"</mn>"},n}(i),c=function(t){function n(t,n){this.label=t,this["class"]=null!=n?n:"default"}return r(n,t),n.prototype.bindingStrength=function(){return 10},n.prototype.renderLaTeX=function(){return this.label},n.prototype.renderString=function(){return this.label},n.prototype.renderMathML=function(t,n){var e,r,i,o,l,a,u;for(a=this.label.split("-"),l=a[0],u=null!=a[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",e=0;"@"===l[0];)e+=1,l=l.slice(1);return i='<mover accent="true">',r="<mrow><mo>"+function(){var t,n;for(n=[],o=t=0;e>=0?e>t:t>e;o=e>=0?++t:--t)n.push(".");return n}().join("")+"</mo></mrow></mover>",l.length>1?i+'<msub class="variable"'+u+"><mi>"+l[0]+"</mi><mi>"+l.slice(1)+"</mi></msub>"+r:'<mi class="variable"'+u+">"+l+"</mi>"},n}(i),o=function(t){function n(t,n){this.top=t,this.bottom=n}return r(n,t),n.prototype.bindingStrength=function(){return 8},n.prototype.renderLaTeX=function(){return"\\frac{"+this.top.renderLaTeX()+"}{"+this.bottom.renderLaTeX()+"}"},n.prototype.renderString=function(){return""+this.bracketIfNeeded(this.top).renderString()+"/"+this.bracketIfNeeded(this.bottom).renderString()},n}(i),s=function(t){function n(t,n){this.contents=t,this.power=null!=n?n:null}return r(n,t),n.prototype.renderLaTeX=function(){return this.power&&2!==this.power?"\\sqrt["+this.power+"]{"+this.contents.renderLaTeX()+"}":"\\sqrt{"+this.contents.renderLaTeX()+"}"},n.prototype.renderString=function(){return this.power&&2!==this.power?""+this.bracketIfNeeded(this.contents).renderString()+" ** "+this.power+"}":"sqrt("+this.contents.renderString()+")"},n}(i),h=function(t){function n(t,n){this.label=t,this["class"]=null!=n?n:"default"}return r(n,t),n.prototype.bindingStrength=function(){return 9},n.prototype.renderLaTeX=function(){return"\\sigma_{"+this.label+"}"},n.prototype.renderString=function(){return"σ("+this.label+")"},n}(i),{DrawingNode:i,Add:n,Mul:l,Pow:u,Bracket:e,Number:a,Variable:c,Fraction:o,Surd:s,Uncertainty:h}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},i=[].slice;e("terminals",["parse","generateInfo","nodes","prettyRender"],function(t,e,o,l){var a,u,s,h,c;return s=function(t){function e(t){this.label=t}return n(e,t),e.prototype.evaluate=function(){},e.prototype.copy=function(){return new e(this.label)},e}(o.BasicNode),a=function(r){function i(n,e){var r,i;this.denominator=null!=e?e:null,this.cmp=-6,null!=this.denominator?(r=t.constant(n),this.numerator=r[0],e=r[1],this.denominator*=e):(i=t.constant(n),this.numerator=i[0],this.denominator=i[1]),this.denominator<0&&(this.denominator*=-1,this.numerator*=-1),this.simplifyInPlace()}return n(i,r),i.prototype.evaluate=function(){return this.numerator/this.denominator},i.prototype.copy=function(){return new i(this.numerator,this.denominator)},i.prototype.compareSameType=function(t){return this.evaluate()<t.evaluate()?-1:this.evaluate()===t.evaluate()?0:1},i.prototype.multiply=function(t){return new i(this.numerator*t.numerator,this.denominator*t.denominator)},i.prototype.add=function(t){return new i(t.denominator*this.numerator+this.denominator*t.numerator,this.denominator*t.denominator)},i.prototype.equals=function(t){return t instanceof i?this.evaluate()===t.evaluate():!1},i.prototype.replaceVariables=function(){return this.copy()},i.prototype.getAllVariables=function(){return[]},i.prototype.sub=function(){return this.copy()},i.prototype.simplifyInPlace=function(){var t,n,e,r;for(t=this.numerator,n=this.denominator;0!==n;)r=[n,Math.round(10*(t%n))/10],t=r[0],n=r[1];return e=t,this.numerator/=e,this.numerator=Math.round(10*this.numerator)/10,this.denominator/=e,this.denominator=Math.round(10*this.denominator)/10},i.prototype.simplify=function(){var t;return t=this.copy(),t.simplifyInPlace(),t},i.prototype.expand=function(){return this.copy()},i.prototype.expandAndSimplify=function(){return this.copy()},i.prototype.substituteExpression=function(){return[this.copy()]},i.prototype.getUncertainty=function(){return new i(0)},i.prototype.getVariableUnits=function(){return null},i.prototype.toMathML=function(t,n,r,i){var o,l,a,u,s;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),i?(s=e.getMathMLInfo(t,n,r),a=s[0],u=s[1],l=s[2],o="</math></div>"):(l="",o=""),1===this.denominator?l+('<mn class="constant">'+this.numerator+"</mn>")+o:l+('<mfrac class="constant"><mrow><mn>'+this.numerator+"</mn></mrow><mrow><mn>"+this.denominator+"</mn></mrow></mfrac>")+o},i.prototype.toHTML=function(t,n,r,i){var o,l,a,u,s;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),s=e.getHTMLInfo(t,n,r),a=s[0],u=s[1],l=s[2],i?o="</div>":(l="",o=""),1===this.denominator?l+(""+this.numerator)+o:l+("("+this.numerator+"/"+this.denominator+")")+o},i.prototype.toDrawingNode=function(){var t,n;return n=l.Number,t=l.Fraction,1===this.denominator?new n(this.numerator):new t(new n(this.numerator),new n(this.denominator))},i.prototype.differentiate=function(){return new i(0)},i}(s),u=function(t){function r(t,n,e){this.label=t,this.value=null!=n?n:null,this.units=null!=e?e:null,this.cmp=-5}return n(r,t),r.prototype.copy=function(){return new r(this.label,this.value,this.units)},r.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},r.prototype.evaluate=function(){return this.value},r.prototype.equals=function(t){return t instanceof r?this.label===t.label&&this.value===t.value:!1},r.prototype.replaceVariables=function(){return this.copy()},r.prototype.getAllVariables=function(){return[]},r.prototype.sub=function(){return this.copy()},r.prototype.simplify=function(){return this.copy()},r.prototype.expand=function(){return this.copy()},r.prototype.expandAndSimplify=function(){return this.copy()},r.prototype.substituteExpression=function(){return[this.copy()]},r.prototype.getUncertainty=function(){return new a(0)},r.prototype.getVariableUnits=function(){return null},r.prototype.toHTML=function(t,n,r,i){var o,l,a,u,s;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),i?(s=e.getHTMLInfo(t,n,r),a=s[0],u=s[1],l=s[2],o="</div>"):(l="",o=""),l+'<span class="constant symbolic-constant">'+this.toString()+"</span>"+o},r.prototype.toMathML=function(t,n,r,i){var o,l,a,u,s;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),i?(s=e.getMathMLInfo(t,n,r),a=s[0],u=s[1],l=s[2],o="</math></div>"):(l="",o=""),""+l+'<mn class="constant symbolic-constant">'+this.label+"</mn>"+o},r.prototype.toDrawingNode=function(){var t;return t=l.Variable,new t(this.label,"symbolic-constant")},r.prototype.differentiate=function(){return new a(0)},r}(s),c=function(t){function i(t,n){this.label=t,this.units=null!=n?n:null,this.cmp=-4}return n(i,t),i.prototype.copy=function(){return new i(this.label,this.units)},i.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},i.prototype.equals=function(t,n){var e;return null==n&&(n=null),t instanceof i?null!=n?(e=this.label,r.call(n.get(t.label),e)>=0):t.label===this.label:!1},i.prototype.replaceVariables=function(t){var n;return n=this.copy(),this.label in t&&(n.label=t[this.label]),n},i.prototype.getAllVariables=function(){return[this.label]},i.prototype.sub=function(t){var n;return this.label in t?(n=t[this.label],null!=n.copy?n.copy():new a(n)):this.copy()},i.prototype.substituteExpression=function(t,n,e,i){var o,l,a,u;return null==e&&(e=null),null==i&&(i=!1),null==e&&(e={get:function(t){return[t]}}),a=e.get(n),l=i?t.solve(n):[t],this.label===n||(u=this.label,r.call(a,u)>=0)?function(){var t,n,e;for(e=[],t=0,n=l.length;n>t;t++)o=l[t],e.push(o.copy());return e}():[this.copy()]},i.prototype.getUncertainty=function(){return new h(this.label)},i.prototype.getVariableUnits=function(t,n){var e;if(null!=n){if(e=this.label,r.call(n.get(t),e)>=0)return this.units}else if(this.label===t)return this.units;return null},i.prototype.simplify=function(){return this.copy()},i.prototype.expand=function(){return this.copy()},i.prototype.expandAndSimplify=function(){return this.copy()},i.prototype.toMathML=function(t,n,r,i){var o,l,a,u,s,h,c,p,f,d,g,y;for(null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),i?(y=e.getMathMLInfo(t,n,r),d=y[0],g=y[1],s=y[2],u="</div>"):(s="",u=""),p=this.label.split("-"),c=p[0],f=null!=p[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",o=0;"@"===c[0];)o+=1,c=c.slice(1);return a='<mover accent="true">',l="<mrow><mo>"+function(){var t,n;for(n=[],h=t=0;o>=0?o>t:t>o;h=o>=0?++t:--t)n.push(".");return n}().join("")+"</mo></mrow></mover>",c.length>1?s+a+'<msub class="variable"'+f+"><mi>"+c[0]+"</mi><mi>"+c.slice(1)+"</mi></msub>"+l+u:s+a+'<mi class="variable"'+f+">"+c+"</mi>"+l+u},i.prototype.toHTML=function(t,n,r,i){var o,l,a,u,s,h,c,p;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),i?(p=e.getHTMLInfo(t,n,r),h=p[0],c=p[1],l=p[2],o="</div>"):(l="",o=""),u=this.label.split("-"),a=u[0],s=null!=u[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",l+'<span class="variable"'+s+">"+a+"</span>"+o},i.prototype.toDrawingNode=function(){var t;return t=l.Variable,new t(this.label)},i.prototype.differentiate=function(t){return t===this.label?new a(1):new a(0)},i}(s),h=function(t){function e(t){this.label=t,this.cmp=-4.5}return n(e,t),e.prototype.copy=function(){return new e(this.label)},e.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},e.prototype.equals=function(t,n){var i;return null==n&&(n=null),t instanceof e?null!=n?(i=this.label,r.call(n.get(t.label),i)>=0):t.label===this.label:!1},e.prototype.replaceVariables=function(t){var n;return n=this.copy(),this.label in t&&(n.label=t[this.label]),n},e.prototype.getAllVariables=function(){return[this.label]},e.prototype.sub=function(t,n){var e;return this.label in n?(e=n[this.label],null!=e.copy?e.copy():new a(e)):this.copy()},e.prototype.substituteExpression=function(t,n,e,r){throw null==e&&(e=null),null==r&&(r=!1),new Error("Can't sub uncertainties")},e.prototype.getUncertainty=function(){throw new Error("Can't take uncertainty of an uncertainty")},e.prototype.getVariableUnits=function(){throw new Error("Can't do that with uncertainties")},e.prototype.simplify=function(){return this.copy()},e.prototype.expand=function(){return this.copy()},e.prototype.expandAndSimplify=function(){return this.copy()},e.prototype.toMathML=function(){var t,n;return t=1<=arguments.length?i.call(arguments,0):[],n=new c("σ"+this.label),n.toMathML.apply(n,t)},e.prototype.toHTML=function(){var t,n;return t=1<=arguments.length?i.call(arguments,0):[],n=new c("σ"+this.label),n.toHTML.apply(n,t)},e.prototype.toDrawingNode=function(){var t;return t=l.Uncertainty,new t(this.label)},e.prototype.differentiate=function(){throw new Error("Can't differentiate uncertainties!")},e}(s),{Terminal:s,Variable:c,Constant:a,SymbolicConstant:u,Uncertainty:h}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};e("AlgebraError",[],function(){var t;return t=function(t){function e(t,n,r){null==r&&(r=null),e.__super__.constructor.call(this,"Unsolvable: "+t+" for "+n+(r?";"+r:""))}return n(e,t),e}(Error)})}.call(this),function(){var t=[].slice;e("parseArgs",["nodes","parse","terminals"],function(n,e,r){var i;return i=function(){var i,o,l,a,u;for(o=1<=arguments.length?t.call(arguments,0):[],l=[],a=0,u=o.length;u>a;a++)if(i=o[a],"string"==typeof i||i instanceof String)l.push(e.stringToTerminal(i));else if("number"==typeof i||i instanceof Number)l.push(new r.Constant(i));else{if(!(i instanceof r.Terminal||i instanceof n.BasicNode||null!=i.isTerminal))throw new Error("Invalid argument "+i+", ("+typeof i+"), ("+i.toString()+")");l.push(i)}return l}})}.call(this),function(){e("compare",[],function(){var t;return t=function(t,n){return null!=t.cmp&&null!=n.cmp?t.cmp===n.cmp?t.compareSameType(n):(t.cmp-n.cmp)/Math.abs(t.cmp-n.cmp):0}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].slice,i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators/Add",["nodes","terminals","generateInfo","AlgebraError","parseArgs","require","compare","prettyRender"],function(t,e,o,l,a,u,s,h){var c,p;return p=function(t){var n,e,r,i,o,l,a,u,s;if(1===t.length)return function(){var e,r,i,o;for(i=t[0],o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(n);return o}();for(r=[],u=t[0],i=0,l=u.length;l>i;i++)for(n=u[i],s=p(t.slice(1)),o=0,a=s.length;a>o;o++)e=s[o],r.push([n].concat(e));return r},c=function(c){function f(){var t;if(t=1<=arguments.length?r.call(arguments,0):[],t.length<1)throw new Error("Add nodes must have at least one child.");this.cmp=-1,t=a.apply(null,t),f.__super__.constructor.call(this,"+",t)}return n(f,c),f.prototype.copy=function(){var t,n;return t=function(){var t,e,r,i;for(r=this.children,i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(null!=n.copy?n.copy():n);return i}.call(this),function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,t,function(){})},f.prototype.compareSameType=function(t){var n,e,r,i,o,l,a;for(i=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,a=this.children,r=o=0,l=a.length;l>o;r=++o){if(e=a[r],null==t.children[r])return 1;if(n=s(this.children[r],t.children[r]),0!==n)return n}return i},f.prototype.getVariableUnits=function(t,n){var r,o,l,a,u,s,h;for(l=null!=n?n.get(t):[t],s=this.children,a=0,u=s.length;u>a;a++){if(r=s[a],r instanceof e.Variable&&(h=r.label,i.call(l,h)>=0))return r.units;if(o=r.getVariableUnits(t,n),null!=o)return o}return null},f.prototype.expand=function(){var t,n,e,r,i,o,l,a,u,s;for(r=[],u=this.children,i=0,l=u.length;l>i;i++)if(e=u[i],null!=e.expand?e=e.expand():null!=e.copy&&(e=e.copy()),e instanceof f)for(s=e.children,o=0,a=s.length;a>o;o++)n=s[o],r.push(n);else r.push(e);return t=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,r,function(){}),t.sort(),t},f.prototype.sort=function(){var t,n,e,r;for(r=this.children,n=0,e=r.length;e>n;n++)t=r[n],"function"==typeof t.sort&&t.sort();return this.children.sort(s)},f.prototype.equals=function(t,n){var e,r,i,o,l;if(!(t instanceof f))return!1;if(t.children.length!==this.children.length)return!1;for(l=this.children,r=i=0,o=l.length;o>i;r=++i)if(e=l[r],null!=e.equals){if(!e.equals(t.children[r],n))return!1}else if(e!==t.children[r])return!1;return!0},f.prototype.simplify=function(t){var n,r,i,o,l,a,s,h,c,p,d,g,y,m,w,b,v,M,T,S,x,A,L,V,k,C,N,q,E,_,j;for(n=u("operators/Mul"),null==t&&(t={get:function(t){return[t]}}),m=[],E=this.children,v=0,x=E.length;x>v;v++)i=E[v],null!=i.simplify?i=i.simplify(t):null!=i.copy&&(i=i.copy()),m.push(i);for(p=[],o=null,s=0;s<m.length;){if(y=m[s],y instanceof f){for(m.splice(s,1)[0],_=y.children,M=0,A=_.length;A>M;M++)r=_[M],m.push(r);s-=1}else if(y instanceof e.Constant)o=null!=o?o.add(y):y.copy();else if(y instanceof n){for(l=null,w=null,j=y.children,T=0,L=j.length;L>T;T++)i=j[T],i instanceof e.Constant?l=null!=l?l.multiply(i):i.copy():null!=w?w.children.push(i):w=new n(i);if(1===w.children.length&&(w=w.children[0]),null!=l&&null==w)o=null!=o?o.add(l):l.copy();else{for(null==l&&(l=new e.Constant("1")),a=!1,h=S=0,V=p.length;V>S;h=++S)c=p[h],null!=c[0].equals?c[0].equals(w,t)&&(p[h][1]=new f(c[1],l),p[h][1]=p[h][1].simplify(t),a=!0):c[0]===w&&(p[h][1]=new f(c[1],l),p[h][1]=p[h][1].simplify(t),a=!0);a||p.push([w,l])}}else{for(a=!1,h=N=0,k=p.length;k>N;h=++N)c=p[h],null!=c[0].equals?c[0].equals(y,t)&&(p[h][1]=new f(c[1],new e.Constant("1")),p[h][1]=p[h][1].simplify(t),a=!0):c[0]===y&&(p[h][1]=new f(c[1],new e.Constant("1")),p[h][1]=p[h][1].simplify(t),a=!0);a||p.push([y,new e.Constant("1")])}s+=1}for(d=null,q=0,C=p.length;C>q;q++)c=p[q],null!=c[0].children&&1===c[0].children.length&&(c[0]=c[0].children[0]),1!==("function"==typeof(b=c[1]).evaluate?b.evaluate():void 0)?(g=new n(c[0],c[1]),g=g.simplify(t)):g=c[0],null!=d?d.children.push(g):d=new f(g);return null==d?o:(null!=o&&0!==o.evaluate()&&d.children.push(o),d.sort(),1!==d.children.length?d:d.children[0])},f.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},f.prototype.solve=function(t,n){var r,o,a,s,h,c,p,d,g,y,m,w,b,v,M,T,S,x,A,L,V,k,C,N,q,E,_,j,O,P,I,U,H,D,X,B,F,R,z,$,W,Z,G,Q,J,K,Y,tn,nn,en,rn,on,ln,an,un,sn,hn,cn,pn,fn,dn,gn,yn,mn;for(null==n&&(n=null),r=u("operators/Mul"),o=u("operators/Pow"),w=this.expandAndSimplify(n),null==n&&(n={get:function(t){return[t]}}),B=[],F=[],W=null,Z=0,K=n.length;K>Z;Z++)if(m=n[Z],R=this.getVariableUnits(m),null!=R){W=R;break}if(w instanceof e.Terminal){if(w instanceof e.Variable&&(w.label===t||(an=w.label,i.call(n.get(t),an)>=0)))return[new e.Constant("0")];throw new l(w.toString(),t)}if(!(w instanceof f))return w.solve(t,n);for(un=w.children,G=0,Y=un.length;Y>G;G++)if(X=un[G],null!=X.copy&&(X=X.copy()),X instanceof o)X.children.left instanceof e.Variable&&(X.children.left.label===t||(hn=X.children.left.label,i.call(n.get(t),hn)>=0))?B.push(X):F.push(X);else if(X instanceof r){for(c=!1,cn=X.children,Q=0,tn=cn.length;tn>Q;Q++){if(H=cn[Q],H instanceof e.Variable&&(H.label===t||(pn=H.label,i.call(n.get(t),pn)>=0))){B.push(X),c=!0;break}if(H instanceof o&&H.children.left instanceof e.Variable&&(H.children.left.label===t||(fn=H.children.left.label,i.call(n.get(t),fn)>=0))){B.push(X),c=!0;break}}c||F.push(X)}else X instanceof e.Variable&&(X.label===t||(dn=X.label,i.call(n.get(t),dn)>=0))?B.push(X):F.push(X);if(0===B.length)throw new l(w.toString(),t);for(b=[],M=[],L=[],k=[],J=0,nn=B.length;nn>J;J++)if(X=B[J],X instanceof e.Variable)b.push(new e.Constant("1"));else if(X instanceof o){if(!(X.children.right instanceof e.Constant))throw new l(w.toString(),t);if(P=X.children.right.evaluate(),!(X.children.left instanceof e.Variable&&(X.children.left.label===t||(gn=X.children.left.label,i.call(n.get(t),gn)>=0))))throw new l(w.toString(),t," (this shouldn't happen)");if(1===P)b.push(new e.Constant("1"));else if(2===P)M.push(new e.Constant("1"));else if(-1===P)L.push(new e.Constant("1"));else{if(-2!==P)throw new l(w.toString(),t," (not supported)");k.push(new e.Constant("1"))}}else if(X instanceof r){for(D=[],I=!1,x=!1,A=!1,yn=X.children,on=0,en=yn.length;en>on;on++)if(H=yn[on],H instanceof e.Variable&&(H.label===t||(mn=H.label,i.call(n.get(t),mn)>=0)));else if(H instanceof o){if(!(H.children.right instanceof e.Constant))throw new l(w.toString(),t);if(P=H.children.right.evaluate(),H.children.left instanceof e.Variable&&(H.children.left.label===t||(sn=H.children.left.label,i.call(n.get(t),sn)>=0)))if(1===P);else if(2===P)I=!0;else if(-1===P)x=!0;else{if(-2!==P)throw new l(w.toString(),t," (not supported)");A=!0}else D.push(H)}else D.push(H);S=D.length>0?function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(r,D,function(){}):new e.Constant("1"),I?M.push(S):x?L.push(S):A?k.push(S):b.push(S)}for(N=[],ln=0,rn=F.length;rn>ln;ln++)X=F[ln],_=new r("-1",null!=X.copy?X.copy():X),_=_.simplify(n),N.push(_);if(0!==N.length&&(q=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,N,function(){})),0!==F.length&&(O=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,F,function(){})),0!==b.length&&(v=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,b,function(){})),0!==M.length&&(T=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,M,function(){})),0!==L.length&&(V=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,L,function(){})),0!==k.length&&(C=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,k,function(){})),0===N.length&&(q=new e.Constant("0")),0===M.length){if(0===b.length){if(0===L.length){if(0===k.length)throw new l(w.toString(),t);return p=new r(new o(C,"1/2"),new o(q,"-1/2")),s=new r(-1,p.copy()),s=s.expandAndSimplify(n),h=p.expandAndSimplify(n),("function"==typeof s.equals?s.equals(h):void 0)?[s]:[s,h]}return 0===k.length?(p=new r(V,new o(q,"-1")),[p.expandAndSimplify(n)]):(E=new f(new r(O,new o(new e.Variable(t,W),2)),new r(V,new e.Variable(t,W)),C),E.solve(t,n))}if(0===L.length){if(0===k.length)return p=new r(q,new o(v,"-1")),[p.expandAndSimplify(n)];throw new l(w.toString(),t," (not supported)")}throw new l(w.toString(),t," (not supported)")
}if(0===b.length){if(0===L.length){if(0===k.length)return p=new o(new r(q,new o(T,"-1")),"1/2"),s=new r("-1",p.copy()),s=s.expandAndSimplify(n),h=p.expandAndSimplify(n),("function"==typeof s.equals?s.equals(h):void 0)?[s]:[s,h];throw new l(w.toString(),t," (not supported)")}throw new l(w.toString(),t," (not supported)")}if(L.length>0||k.length>0)throw new l(w.toString(),t," (not supported)");return null!=O?(a=T,d=v,g=O,y=new f(new o(d,"2"),new r("-4",a,g)),U=new o(y,"1/2"),z=new r(new f(new r("-1",d),U),new o(new r("2",a),"-1")),$=new r("-1",new f(d,U),new o(new r("2",a),"-1")),z=z.expandAndSimplify(n),$=$.expandAndSimplify(n),null!=z.equals&&z.equals($)?[z]:[z,$]):(j=new o(T,"-1"),_=new r("-1",v,j),_=_.simplify(n),[0,_])},f.prototype.getAllVariables=function(){var t,n,r,i,o,l,a,u,s,h;for(o={},h=this.children,l=0,u=h.length;u>l;l++)if(t=h[l],t instanceof e.Variable)o[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),a=0,s=n.length;s>a;a++)i=n[a],o[i]=!0;r=[];for(i in o)r.push(i);return r},f.prototype.replaceVariables=function(t){var n,r,i,o,l,a;for(r=[],a=this.children,i=o=0,l=a.length;l>o;i=++o)n=a[i],n instanceof e.Variable&&n.label in t?(r.push(n.copy()),r[i].label=t[n.label]):null!=n.replaceVariables?r.push(n.replaceVariables(t)):r.push(n.copy());return function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,r,function(){})},f.prototype.sub=function(n,r,i){var o,l,a,u,s,h,c,p,d,g,y,m;null==i&&(i=null);for(h in n)n[h]instanceof e.Terminal||n[h]instanceof t.BasicNode||(n[h]=new e.Constant(n[h]));for(null==i&&(i={get:function(t){return[t]}}),l=[],m=this.children,p=0,g=m.length;g>p;p++)if(o=m[p],o instanceof e.Variable){for(c=i.get(o.label),s=!1,d=0,y=c.length;y>d;d++)if(a=c[d],a in n){l.push(n[a].copy()),s=!0;break}s||l.push(o.copy())}else null!=o.sub?l.push(o.sub(n,r,i)):l.push(o.copy());return u=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,l,function(){}),u=u.expandAndSimplify(i)},f.prototype.substituteExpression=function(t,n,r,o){var l,a,u,s,h,c,d,g,y,m,w,b,v,M,T,S,x;for(null==r&&(r=null),null==o&&(o=!1),g=o?t.solve(n,r):[t],null==r&&(r={get:function(t){return[t]}}),y=r.get(n),d=[],m=0,v=g.length;v>m;m++){for(h=g[m],s=[],S=this.children,w=0,M=S.length;M>w;w++)l=S[w],l instanceof e.Variable&&(l.label===n||(x=l.label,i.call(y,x)>=0))?s.push([h.copy()]):null!=l.substituteExpression?s.push(l.substituteExpression(h,n,r)):s.push([l.copy()]);u=p(s)}for(b=0,T=u.length;T>b;b++)a=u[b],c=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,a,function(){}),d.push(c.expandAndSimplify(r));return d},f.prototype.toMathML=function(t,n,e,r){var i,l,a,u,s;return null==n&&(n=!1),null==e&&(e="0"),null==r&&(r=!1),s=o.getMathMLInfo(t,n,e),a=s[0],u=s[1],l=s[2],r?i="</math></div>":(l="",i=""),l+"<mrow>"+this.children.map(function(e){return e.toMathML(t,n)}).join("<mo>+</mo>")+"</mrow>"+i},f.prototype.toHTML=function(t,n,e,r){var i,l,a,u,s;return null==n&&(n=!1),null==e&&(e="0"),null==r&&(r=!1),s=o.getHTMLInfo(t,n,e),a=s[0],u=s[1],l=s[2],r?i="</div>":(l="",i=""),l+this.children.map(function(t){return t.toHTML()}).join("+")+i},f.prototype.toDrawingNode=function(){var t;return t=h.Add,t.makeWithBrackets.apply(t,this.children.map(function(t){return t.toDrawingNode()}))},f.prototype.differentiate=function(t){var n,e;return e=this.children.map(function(n){return n.differentiate(t)}),n=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,e,function(){}),n.expandAndSimplify()},f}(t.RoseNode)})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].slice,i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators/Mul",["nodes","terminals","generateInfo","AlgebraError","parseArgs","require","compare","prettyRender"],function(t,e,o,l,a,u,s,h){var c,p;return p=function(t){var n,e,r,i,o,l,a,u,s;if(1===t.length)return function(){var e,r,i,o;for(i=t[0],o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(n);return o}();for(r=[],u=t[0],i=0,l=u.length;l>i;i++)for(n=u[i],s=p(t.slice(1)),o=0,a=s.length;a>o;o++)e=s[o],r.push([n].concat(e));return r},c=function(c){function f(){var t;if(t=1<=arguments.length?r.call(arguments,0):[],t.length<1)throw new Error("Mul nodes must have at least one child.");this.cmp=-2,t=a.apply(null,t),f.__super__.constructor.call(this,"*",t)}return n(f,c),f.prototype.copy=function(){var t,n;return t=function(){var t,e,r,i;for(r=this.children,i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(null!=n.copy?n.copy():n);return i}.call(this),function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,t,function(){})},f.prototype.simplifyConstants=function(){var t,n,r,i,o,l;for(n=new e.Constant("1"),r=null,l=this.children,i=0,o=l.length;o>i;i++)t=l[i],t instanceof e.Constant?n=n.multiply(t):null!=r?r.children.push(t):r=new f(t);return null==r?n:1===n.evaluate()?r:new f(n,r)},f.prototype.compareSameType=function(t){var n,e,r,i,o,l,a;for(i=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,a=this.children,r=o=0,l=a.length;l>o;r=++o){if(e=a[r],null==t.children[r])return 1;if(n=s(this.children[r],t.children[r]),0!==n)return n}return i},f.prototype.getVariableUnits=function(t,n){var r,o,l,a,u,s,h;for(l=null!=n?n.get(t):[t],s=this.children,a=0,u=s.length;u>a;a++){if(r=s[a],r instanceof e.Variable&&(h=r.label,i.call(l,h)>=0))return r.units;if(o=r.getVariableUnits(t,n),null!=o)return o}return null},f.expandMulAdd=function(t,n){var e,r,i,o,l,a,s,h,c,p,d,g;for(e=u("operators/Add"),a=[],d=n.children,s=0,c=d.length;c>s;s++){if(i=d[s],null!=i.copy&&(i=i.copy()),i instanceof f)for(l=t.copy(),g=i.children,h=0,p=g.length;p>h;h++)r=g[h],l.children.push(r);else i instanceof e?l=f.expandMulAdd(t,i):1===t.children.length?(l=t.copy(),l.children.push(i.copy())):l=new f(t.copy(),i.copy());a.push(l)}return o=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(e,a,function(){}),o=o.expand()},f.prototype.equals=function(t,n){var e,r,i,o,l;if(!(t instanceof f))return!1;if(t.children.length!==this.children.length)return!1;for(l=this.children,r=i=0,o=l.length;o>i;r=++i)if(e=l[r],null!=e.equals){if(!e.equals(t.children[r],n))return!1}else if(e!==t.children[r])return!1;return!0},f.prototype.expand=function(){var t,n,e,r,i,o,l,a,s,h,c,p,d,g,y;for(t=u("operators/Add"),i=[],d=this.children,l=0,h=d.length;h>l;l++)n=d[l],null!=n.expand?n=n.expand():null!=n.copy&&(n=n.copy()),i.push(n);for(;i.length>1;)if(i[0]instanceof f)if(i[1]instanceof t)i[0]=f.expandMulAdd(i[0],i.splice(1,1)[0]);else if(i[1]instanceof f)for(g=i.splice(1,1)[0].children,a=0,c=g.length;c>a;a++)n=g[a],i[0].children.push(n);else i[0].children.push(i.splice(1,1)[0]);else if(i[0]instanceof t)if(i[1]instanceof t){for(r=[],y=i[0].children,s=0,p=y.length;p>s;s++)n=y[s],e=new f(n,i[1]),e=e.expand(),r.push(e);i.splice(1,1),i[0]=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(t,r,function(){}),i[0]=i[0].expand()}else i[0]=i[1]instanceof f?f.expandMulAdd(i.splice(1,1)[0],i[0]):new f(i[0],i.splice(1,1)[0]);else i[0]=new f(i[0]);return"function"==typeof(o=i[0]).sort&&o.sort(),i[0]},f.prototype.simplify=function(t){var n,r,i,o,l,a,s,h,c,p,d,g,y,m,w,b,v,M,T,S,x,A,L,V,k,C,N,q,E,_,j,O,P,I,U,H,D;for(n=u("operators/Add"),r=u("operators/Pow"),null==t&&(t={get:function(t){return[t]}}),v=[],j=this.children,T=0,L=j.length;L>T;T++)l=j[T],null!=l.simplify?l=l.simplify(t):null!=l.copy&&(l=l.copy()),v.push(l);for(d=[],a=null,h=0;h<v.length;){if(b=v[h],b instanceof f){for(l=v.splice(h,1)[0],O=l.children,S=0,V=O.length;V>S;S++)o=O[S],v.push(o);h-=1}else if(b instanceof e.Constant)a=null!=a?a.multiply(b):b.copy();else if(b instanceof r){for(i=b.children.left,w=b.children.right,s=!1,c=x=0,k=d.length;k>x;c=++x)p=d[c],null!=p[0].equals?p[0].equals(i,t)&&(d[c][1]=new n(p[1],w),d[c][1]=d[c][1].simplify(t),1===(null!=(P=d[c][1].children)?P.length:void 0)&&(d[c][1]=d[c][1].children[0]),s=!0):p[0]===i&&(d[c][1]=new n(p[1],w),d[c][1]=d[c][1].simplify(t),1===(null!=(I=d[c][1].children)?I.length:void 0)&&(d[c][1]=d[c][1].children[0]),s=!0);s||d.push([i,w])}else{for(s=!1,c=A=0,C=d.length;C>A;c=++A)p=d[c],null!=p[0].equals?p[0].equals(b,t)&&(d[c][1]=new n(p[1],new e.Constant("1")),d[c][1]=d[c][1].simplify(t),1===(null!=(U=d[c][1].children)?U.length:void 0)&&(d[c][1]=d[c][1].children[0]),s=!0):p[0]===b&&(d[c][1]=new n(p[1],new e.Constant("1")),d[c][1]=d[c][1].simplify(t),1===(null!=(H=d[c][1].children)?H.length:void 0)&&(d[c][1]=d[c][1].children[0]),s=!0);s||d.push([b,new e.Constant("1")])}h+=1}if(0===(null!=a?"function"==typeof a.evaluate?a.evaluate():void 0:void 0))return new e.Constant("0");for(g=null,E=0,N=d.length;N>E;E++)p=d[E],1!==("function"==typeof(M=p[1]).evaluate?M.evaluate():void 0)?(y=new r(p[0],p[1]),y=y.simplify(t)):y=p[0],null!=g?g.children.push(y):g=new f(y);if(null==g)return a;for(null!=a&&1!==a.evaluate()&&g.children.push(a),g.sort(),m=!0,D=g.children,_=0,q=D.length;q>_;_++)if(l=D[_],!(l instanceof e.Constant)){m=!1;break}return m?g.simplifyConstants():1!==g.children.length?g:g.children[0]},f.prototype.sort=function(){var t,n,e,r;for(r=this.children,n=0,e=r.length;e>n;n++)t=r[n],"function"==typeof t.sort&&t.sort();return this.children.sort(s)},f.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},f.prototype.solve=function(t,n){var r,o,a,s,h,c,p,d,g;if(null==n&&(n=null),r=u("operators/Pow"),s=this.expandAndSimplify(n),null==n&&(n={get:function(t){return[t]}}),s instanceof e.Terminal){if(s instanceof e.Variable&&(s.label===t||(p=s.label,i.call(n.get(t),p)>=0)))return[new e.Constant("0")];throw new l(s.toString(),t)}if(!(s instanceof f))return s.solve(t,n);for(d=s.children,h=0,c=d.length;c>h;h++){if(o=d[h],o instanceof e.Variable&&(o.label===t||(g=o.label,i.call(n.get(t),g)>=0)))return[new e.Constant("0")];if(o instanceof r)try{return o.solve(t,n)}catch(y){if(a=y,a instanceof l)continue;throw a}}throw new l(s.toString(),t)},f.prototype.getAllVariables=function(){var t,n,r,i,o,l,a,u,s,h;for(o={},h=this.children,l=0,u=h.length;u>l;l++)if(t=h[l],t instanceof e.Variable)o[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),a=0,s=n.length;s>a;a++)i=n[a],o[i]=!0;r=[];for(i in o)r.push(i);return r},f.prototype.replaceVariables=function(t){var n,r,i,o,l,a;for(r=[],a=this.children,i=o=0,l=a.length;l>o;i=++o)n=a[i],n instanceof e.Variable&&n.label in t?(r.push(n.copy()),r[i].label=t[n.label]):null!=n.replaceVariables?r.push(n.replaceVariables(t)):r.push(n.copy());return function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,r,function(){})},f.prototype.sub=function(n,r,i){var o,l,a,u,s,h,c,p,d,g,y,m;null==i&&(i=null);for(h in n)n[h]instanceof e.Terminal||n[h]instanceof t.BasicNode||(n[h]=new e.Constant(n[h]));for(null==i&&(i={get:function(t){return[t]}}),l=[],m=this.children,p=0,g=m.length;g>p;p++)if(o=m[p],o instanceof e.Variable){for(c=i.get(o.label),s=!1,d=0,y=c.length;y>d;d++)if(a=c[d],a in n){l.push(n[a].copy()),s=!0;break}s||l.push(o.copy())}else null!=o.sub?l.push(o.sub(n,r,i)):l.push(o.copy());return u=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,l,function(){}),u=u.expandAndSimplify(i)},f.prototype.substituteExpression=function(t,n,r,o){var l,a,u,s,h,c,d,g,y,m,w,b,v,M,T,S,x;for(null==r&&(r=null),null==o&&(o=!1),g=o?t.solve(n,r):[t],null==r&&(r={get:function(t){return[t]}}),y=r.get(n),d=[],m=0,v=g.length;v>m;m++){for(h=g[m],s=[],S=this.children,w=0,M=S.length;M>w;w++)l=S[w],l instanceof e.Variable&&(l.label===n||(x=l.label,i.call(y,x)>=0))?s.push([h.copy()]):null!=l.substituteExpression?s.push(l.substituteExpression(h,n,r)):s.push([l.copy()]);for(console.log("childrenExpressions",s),u=p(s),console.log("childrenArray",u),b=0,T=u.length;T>b;b++)a=u[b],c=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,a,function(){}),d.push(c.expandAndSimplify(r))}return console.log(d),d},f.prototype.toMathML=function(t,n,r,i){var l,a,s,h,c,p,f,d,g,y,m,w,b,v;if(null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),l=u("operators/Add"),a=u("operators/Pow"),v=o.getMathMLInfo(t,n,r),g=v[0],y=v[1],f=v[2],i?h="</math></div>":(f="",h=""),c=function(){var t,n,e,r;for(e=this.children,r=[],t=0,n=e.length;n>t;t++)s=e[t],s instanceof a&&null!=s.children.right.evaluate&&s.children.right.evaluate()<0&&r.push(new a(s,"-1").simplify());return r}.call(this),w=function(){var t,n,e,r;for(e=this.children,r=[],t=0,n=e.length;n>t;t++)s=e[t],s instanceof a&&null!=s.children.right.evaluate&&s.children.right.evaluate()<0||r.push(s);return r}.call(this),b=w.filter(function(t){return!(t instanceof e.Constant&&-1===("function"==typeof t.evaluate?t.evaluate():void 0))}),p=c.filter(function(t){return!(t instanceof e.Constant&&-1===("function"==typeof t.evaluate?t.evaluate():void 0))}),m=c.length-p.length+w.length-b.length,c.length>0&&w.length>0)return f+function(){var t,n;for(n=[],d=t=0;m>=0?m>t:t>m;d=m>=0?++t:--t)n.push("<mo>-</mo>");return n}().join("")+"<mfrac><mrow>"+b.map(function(e){return e instanceof l?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow><mrow>"+p.map(function(e){return e instanceof l?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow></mfrac>"+h;if(c.length>0)return f+function(){var t,n;for(n=[],d=t=0;m>=0?m>t:t>m;d=m>=0?++t:--t)n.push("<mo>-</mo>");return n}().join("")+"<mfrac><mn>1</mn><mrow>"+p.map(function(e){return e instanceof l?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow></mfrac>"+h;if(w.length>0)return f+function(){var t,n;for(n=[],d=t=0;m>=0?m>t:t>m;d=m>=0?++t:--t)n.push("<mo>-</mo>");return n}().join("")+"<mrow>"+b.map(function(e){return e instanceof l?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow>"+h;throw new Error("No terms in Mul node.")},f.prototype.toHTML=function(t,n,e,r){var i,l,a,s,h,c;return null==n&&(n=!1),null==e&&(e="0"),null==r&&(r=!1),i=u("operators/Add"),c=o.getHTMLInfo(t,n,e),s=c[0],h=c[1],a=c[2],r?l="</div>":(a="",l=""),a+this.children.map(function(t){return t instanceof i?"("+t.toHTML()+")":t.toHTML()}).join("&middot;")+l},f.prototype.toDrawingNode=function(){var t,n,r,i,o,l,a,s,c,p,f;for(t=u("operators/Pow"),e=u("terminals"),l=[],n=[],c=this.children,a=0,s=c.length;s>a;a++)r=c[a],r instanceof t?(o=r.children.right,o instanceof e.Constant?(o.denominator<0&&(o.denominator*=-1,o.numerator*=-1),o.numerator<0?1!==o.denominator?n.push(new t(r.children.left,new e.Constant(o.numerator,-o.denominator)).toDrawingNode()):n.push(r.children.left.toDrawingNode()):l.push(r.toDrawingNode())):l.push(r.toDrawingNode())):r instanceof e.Constant?(1!==r.numerator&&l.unshift(new h.Number(r.numerator)),1!==r.denominator&&n.unshift(new h.Number(r.denominator))):l.push(r.toDrawingNode());return 1===n.length?i=n[0]:n.length>1&&(i=(p=h.Mul).makeWithBrackets.apply(p,n)),1===l.length?l=l[0]:l.length>1&&(l=(f=h.Mul).makeWithBrackets.apply(f,l)),0===n.length?l:0===l.length?new h.Fraction(new h.Number(1),i):new h.Fraction(l,i)},f.prototype.differentiate=function(t){var n,e,r;if(n=u("operators/Add"),0===this.children.length)throw new Error("I'm pretty sure you need children in your Mul node");return 1===this.children.length?this.children[0].differentiate(t).expandAndSimplify():(e=this.children[0],r=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(f,this.children.slice(1),function(){}),new n(new f(e,r.differentiate(t)),new f(r,e.differentiate(t))).expandAndSimplify())},f}(t.RoseNode)})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].slice,i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators/Pow",["nodes","terminals","generateInfo","AlgebraError","parseArgs","require","compare","prettyRender"],function(t,e,o,l,a,u,s,h){var c;return c=function(c){function p(){var t,n,e,i;if(n=arguments[0],e=arguments[1],t=3<=arguments.length?r.call(arguments,2):[],null==n||null==e)throw new Error("Pow nodes must have two children.");if(t.length>0)throw new Error("Pow nodes must have two children.");this.cmp=-3,i=a(n,e),n=i[0],e=i[1],p.__super__.constructor.call(this,"**",n,e)}return n(p,c),p.prototype.copy=function(){return new p(null!=this.children.left.copy?this.children.left.copy():this.children.left,null!=this.children.right.copy?this.children.right.copy():this.children.right)},p.prototype.sort=function(){var t,n;return"function"==typeof(t=this.children.left).sort&&t.sort(),"function"==typeof(n=this.children.right).sort?n.sort():void 0},p.prototype.equals=function(t,n){if(!(t instanceof p))return!1;if(null!=this.children.left.equals){if(!this.children.left.equals(t.children.left,n))return!1}else if(this.children.left!==t.children.left)return!1;if(null!=this.children.right.equals){if(!this.children.right.equals(t.children.right,n))return!1}else if(this.children.right!==t.children.right)return!1;return!0},p.prototype.compareSameType=function(t){var n;return n=s(this.children.left,t.children.left),0!==n?n:s(this.children.right,t.children.right)},p.prototype.getVariableUnits=function(t,n){var r,o,l,a,u;return l=null!=n?n.get(t):{get:function(t){return[t]}},this.children.left instanceof e.Variable&&(a=this.children.left.label,i.call(l,a)>=0)?this.children.left.units:(r=this.children.left.getVariableUnits(t,n),null!=r?r:this.children.right instanceof e.Variable&&(u=this.children.right.label,i.call(l,u)>=0)?this.children.right.units:(o=this.children.right.getVariableUnits(t,n),null!=o?o:null))},p.prototype.expand=function(){var t,n,r,i,o,l,a,s,h,c,f,d,g,y,m;if(n=u("operators/Mul"),t=u("operators/Add"),a=null!=this.children.left.expand?this.children.left.expand():null!=this.children.left.copy?this.children.left.copy():this.children.left,c=null!=this.children.right.expand?this.children.right.expand():null!=this.children.right.copy?this.children.right.copy():this.children.right,null!=a.children){if(a instanceof p)a.children.right=new n(a.children.right,c),a.expand();else if(a instanceof n)for(y=a.children,l=f=0,g=y.length;g>f;l=++f)r=y[l],h=new p(r,c),h=h.expand(),a.children[l]=h;else if(a instanceof t)if(c instanceof e.Constant&&0===c.evaluate()%1&&c.evaluate()>0){for(i=[],o=d=1,m=c.evaluate();m>=1?m>=d:d>=m;o=m>=1?++d:--d)i.push(a);s=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(n,i,function(){}),s=s.expand(),a=s}else a=new p(a,c);return a}return new p(a,c)},p.prototype.simplify=function(t){var n,r,i,o,l;return n=u("operators/Mul"),null==t&&(t={get:function(t){return[t]}}),r=null!=this.children.left.simplify?this.children.left.simplify(t):null!=this.children.left.copy?this.children.left.copy():this.children.left,l=null!=this.children.right.simplify?this.children.right.simplify(t):null!=this.children.right.copy?this.children.right.copy():this.children.right,1===("function"==typeof l.evaluate?l.evaluate():void 0)?r:1===("function"==typeof r.evaluate?r.evaluate():void 0)?r:0===("function"==typeof l.evaluate?l.evaluate():void 0)?new e.Constant("1"):l instanceof e.Constant&&r instanceof e.Constant?new e.Constant(Math.pow(r.evaluate(),l.evaluate())):r instanceof p?(o=new n(r.children.right,l),i=new p(r.children.left,o),i=i.simplify(t)):new p(r,l)},p.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},p.prototype.solve=function(t,n){var r,o,a,s,h,c,f,d,g,y,m;if(r=u("operators/Mul"),null==n&&(n={get:function(t){return[t]}}),a=this.expandAndSimplify(n),a instanceof e.Terminal){if(a instanceof e.Variable&&(a.label===t||(y=a.label,i.call(n.get(t),y)>=0)))return[new e.Constant("0")];throw new l(a.toString(),t)}if(a instanceof p){if(a.children.left instanceof e.Variable){if(a.children.left.label===t||(m=a.children.left.label,i.call(n.get(t),m)>=0))return[new e.Constant("0")];throw new l(a.toString(),t)}if(a.children.left instanceof e.Terminal)throw new l(a.toString(),t);try{f=a.children.left.solve(t,n)}catch(w){throw o=w}if(null!=a.children.right.evaluate&&0===a.children.right.evaluate()%2){for(h=[],d=0,g=f.length;g>d;d++)c=f[d],s=new r(-1,c).simplify(n),null!=s.equals?(s.equals(c)||h.push(s),h.push(c)):(s!==c&&h.push(s),h.push(c));return h}return f}return a.solve(t,n)},p.prototype.sub=function(n,r,i){var o,l,a,u,s,h,c,f,d,g,y;null==i&&(i=null);for(h in n)n[h]instanceof e.Terminal||n[h]instanceof t.BasicNode||(n[h]=new e.Constant(n[h]));if(null==i&&(i={get:function(t){return[t]}}),l=null,u=null,this.children.left instanceof e.Variable){for(c=i.get(this.children.left.label),s=!1,f=0,g=c.length;g>f;f++)if(o=c[f],o in n){l=n[o].copy(),s=!0;break}s||(l=this.children.left.copy())}else l=null!=this.children.left.sub?this.children.left.sub(n,r):this.children.left.copy();if(this.children.right instanceof e.Variable){for(c=i.get(this.children.right.label),s=!1,d=0,y=c.length;y>d;d++)if(o=c[d],o in n){u=n[o].copy(),s=!0;break}s||(u=this.children.right.copy())}else u=null!=this.children.right.sub?this.children.right.sub(n,r):this.children.right.copy();return a=new p(l,u),a=a.expandAndSimplify(i)},p.prototype.getAllVariables=function(){var t,n,r,i,o,l,a,u,s;if(o={},this.children.left instanceof e.Variable)o[this.children.left.label]=!0;else if(null!=this.children.left.getAllVariables)for(t=this.children.left.getAllVariables(),l=0,u=t.length;u>l;l++)i=t[l],o[i]=!0;if(this.children.right instanceof e.Variable)o[this.children.right.label]=!0;else if(null!=this.children.right.getAllVariables)for(r=this.children.right.getAllVariables(),a=0,s=r.length;s>a;a++)i=r[a],o[i]=!0;n=[];for(i in o)n.push(i);return n},p.prototype.replaceVariables=function(t){var n,r;return n=this.children.left.copy(),r=this.children.right.copy(),n instanceof e.Variable&&n.label in t?n.label=t[n.label]:null!=n.replaceVariables&&(n=n.replaceVariables(t)),r instanceof e.Variable&&r.label in t?r.label=t[r.label]:null!=r.replaceVariables&&(r=r.replaceVariables(t)),new p(n,r)},p.prototype.substituteExpression=function(t,n,r,o){var l,a,u,s,h,c,f,d,g,y,m,w,b,v,M,T,S;for(null==r&&(r=null),null==o&&(o=!1),d=o?t.solve(n,r):[t],null==r&&(r={get:function(t){return[t]}}),g=r.get(n),c=[],y=0,b=d.length;b>y;y++)for(l=d[y],s=[this.children.left.copy()],f=[this.children.right.copy()],this.children.left instanceof e.Variable&&(this.children.left.label===n||(T=this.children.left.label,i.call(g,T)>=0))?s=[l.copy()]:this.children.left instanceof e.Terminal||(s=this.children.left.substituteExpression(l,n,r)),this.children.right instanceof e.Variable&&(this.children.right.label===n||(S=this.children.right.label,i.call(g,S)>=0))?f=[l.copy()]:this.children.right instanceof e.Terminal||(f=this.children.right.substituteExpression(l,n,r)),m=0,v=s.length;v>m;m++)for(a=s[m],w=0,M=f.length;M>w;w++)u=f[w],h=new p(a,u),h=h.expandAndSimplify(r),c.push(h);return c},p.prototype.toMathML=function(t,n,e,r){var i,l,a,s,h,c,p,f,d,g,y,m,w;return null==n&&(n=!1),null==e&&(e="0"),null==r&&(r=!1),l=u("operators/Mul"),i=u("operators/Add"),w=o.getMathMLInfo(t,n,e),c=w[0],p=w[1],s=w[2],r?a="</math></div>":(s="",a=""),1===("function"==typeof(d=this.children.right).evaluate?d.evaluate():void 0)?s+this.children.left.toMathML(t,n)+a:0===("function"==typeof(g=this.children.right).evaluate?g.evaluate():void 0)?s+"<mn>1</mn>"+a:(("function"==typeof(y=this.children.right).evaluate?y.evaluate():void 0)<0?(f=this.children.right.copy(),f=new l("-1",f),f=f.expandAndSimplify()):f=this.children.right.copy(),h=this.children.left instanceof i||this.children.left instanceof l?"<mfenced>"+this.children.left.toMathML(t,n)+"</mfenced>":""+this.children.left.toMathML(t,n),1!==("function"==typeof f.evaluate?f.evaluate():void 0)&&(h="<msup>"+h+f.toMathML(t,n)+"</msup>"),("function"==typeof(m=this.children.right).evaluate?m.evaluate():void 0)<0&&(h="<mfrac><mn>1</mn>"+h+"</mfrac>"),s+h+a)},p.prototype.toHTML=function(t,n,r,i){var l,a,u,s,h,c,p,f,d,g;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),g=o.getHTMLInfo(t,n,r),h=g[0],c=g[1],a=g[2],i?l="</div>":(a="",l=""),1===("function"==typeof(f=this.children.right).evaluate?f.evaluate():void 0)?a+this.children.left.toHTML()+l:0===("function"==typeof(d=this.children.right).evaluate?d.evaluate():void 0)?a+"1"+l:(s=this.children.left instanceof e.Terminal?this.children.left.toHTML():"("+this.children.left.toHTML()+")",p=this.children.right instanceof e.Terminal?this.children.right.toHTML():"("+this.children.right.toHTML()+")",u=""+s+" ** "+p,a+u+l)},p.prototype.toDrawingNode=function(){var t,n,r,i;return i=null!=h?h.Surd:void 0,r=h.Pow,t=h.Fraction,n=h.Number,this.children.right instanceof e.Constant&&1===this.children.right.numerator?this.children.right.denominator>0?new i(this.children.left.toDrawingNode(),this.children.right.denominator):new t(new n(1),new i(this.children.left.toDrawingNode(),-this.children.right.denominator)):new r(this.children.left.toDrawingNode(),this.children.right.toDrawingNode())},p.prototype.differentiate=function(t){var n,e,r,o;if(n=u("operators/Add"),r=u("operators/Mul"),e=u("terminals").Constant,i.call(this.children.right.getAllVariables,t)>=0)throw new Error("I can't differentiate with a variable on the top of a power");return 0===("function"==typeof(o=this.children.right).evaluate?o.evaluate():void 0)?new e(0):new r(new p(this.children.left,new n(this.children.right,new e(-1))),this.children.left.differentiate(t),this.children.right).expandAndSimplify()},p}(t.BinaryNode)})}.call(this),function(){e("operators",["operators/Add","operators/Mul","operators/Pow"],function(t,n,e){return{Add:t,Mul:n,Pow:e}})}.call(this),function(){var t=[].slice,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("Equation",["terminals","nodes","operators","parse"],function(e,r,i,o){var l;return l=function(){function l(){var n,i;switch(n=1<=arguments.length?t.call(arguments,0):[],n.length){case 1:if(n[0]instanceof String||"string"==typeof n[0])switch(i=n[0].split("="),i.length){case 1:this.left=new e.Constant("0"),this.right=o.stringToExpression(i[0]),this.right=this.right.simplify();break;case 2:this.left=o.stringToTerminal(i[0]),this.right=o.stringToExpression(i[1]),this.right=this.right.simplify();break;default:throw new Error("Too many '=' signs.")}else{if(!(n[0]instanceof e.Terminal||n[0]instanceof r.BasicNode))throw new Error("Argument "+n[0]+" must be a String, Terminal, or Node.");this.left=new e.Constant("0"),this.right=n[0].copy()}break;case 2:if(n[0]instanceof String||"string"==typeof n[0])this.left=o.stringToTerminal(n[0]);else{if(!(n[0]instanceof e.Terminal||n[0]instanceof r.BasicNode))throw new Error("Argument "+n[0]+" must be a String, Terminal, or Node.");this.left=n[0].copy()}if(n[1]instanceof String||"string"==typeof n[1])this.right=o.stringToExpression(n[1]),this.right=this.right.simplify();else{if(!(n[1]instanceof e.Terminal||n[1]instanceof r.BasicNode))throw new Error("Argument "+n[1]+" must be a String, Terminal, or Node.");this.right=n[1].copy()}break;default:throw new Error("Too many arguments.")}}return l.prototype.solve=function(t,n){var e,r;return null==n&&(n=null),e=new i.Add(this.right,new i.Mul("-1",this.left)),r=e.solve(t,n),r.map(function(n){return new l(t,n)})},l.prototype.replaceVariables=function(t){var n,e;return n=this.left.replaceVariables(t),e=this.right.replaceVariables(t),new l(n,e)},l.prototype.getAllVariables=function(){var t,e,r,i,o;for(t=this.left.getAllVariables(),e=this.right.getAllVariables(),i=0,o=t.length;o>i;i++)r=t[i],n.call(e,r)<0&&e.unshift(r);return e},l.prototype.sub=function(t,n,e){return new l(this.left,this.right.sub(t,n,e))},l.prototype.substituteExpression=function(t,n,e,r){var o,a,u,s,h,c,p,f,d,g;for(null==r&&(r=!1),t instanceof l&&(t=new i.Add(t.right,new i.Mul("-1",t.left))),null==e&&(e={get:function(t){return[t]}}),h=e.get(n),s=r?t.solve(n,e):[t],a=[],c=0,f=s.length;f>c;c++)for(u=s[c],g=this.right.substituteExpression(u,n,e),p=0,d=g.length;d>p;p++)o=g[p],a.push(new l(this.left,o.expandAndSimplify(e)));return a},l.prototype.expandAndSimplify=function(t){var n,e;return n=this.left.expandAndSimplify(t),e=this.right.expandAndSimplify(t),new l(n,e)},l.prototype.simplify=function(t){var n,e;return n=this.left.simplify(t),e=this.right.simplify(t),new l(n,e)},l.prototype.expand=function(t){var n,e;return n=this.left.expand(t),e=this.right.expand(t),new l(n,e)},l.prototype.getVariableUnits=function(t,n){return null==n&&(n={get:function(t){return[t]}}),this.left.label===t?this.left.units:this.right.getVariableUnits(t,n)},l.prototype.equals=function(t){return t instanceof l?t.left.equals(this.left)&&t.right.equals(this.right):!1},l.prototype.toMathML=function(t,n,e,r){return null==n&&(n=!1),null==e&&(e=null),null==r&&(r=!1),this.right.toMathML(t,n,this.left,r)},l.prototype.toHTML=function(t,n,e,r){return null==n&&(n=!1),null==e&&(e=null),null==r&&(r=!1),this.right.toHTML(t,n,this.left,r)},l.prototype.toLaTeX=function(){return""+this.left.toLaTeX()+" = "+this.right.toLaTeX()},l.prototype.toString=function(){return""+this.left+" = "+this.right},l}()})}.call(this),function(){e("uncertainties",["nodes","terminals","operators","require"],function(t,n,e){return t.BasicNode.prototype.getUncertainty=function(){var t,r,i,o,l,a,u,s,h,c,p;for(i=e.Mul,o=e.Pow,t=e.Add,l=n.Uncertainty,r=n.Constant,h=this.getAllVariables(),a=[],c=0,p=h.length;p>c;c++)s=h[c],u=new i(new n.Uncertainty(s),this.differentiate(s)),a.push(new o(u,2));return new o(function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(t,a,function(){}),new n.Constant(1,2)).expandAndSimplify()}})}.call(this),function(){n.config({baseUrl:"./"}),e("coffeequate",["Equation","operators","terminals","parse","uncertainties","prettyRender"],function(t,n,e,r,i,o){return{Equation:t,tree:{operators:n,terminals:e},parse:r,prettyRender:{DrawingNode:o.DrawingNode,Add:o.Add,Mul:o.Mul,Power:o.Power,Bracket:o.Bracket,Number:o.Number,Variable:o.Variable,Fraction:o.Fraction}}})}.call(this),n(["coffeequate"]),n("coffeequate")});