/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,n){"function"==typeof define&&define.amd?define(n):t.libGlobalName=n()}(this,function(){var t,n,e;return function(r){function i(t,n){return b.call(t,n)}function l(t,n){var e,r,i,l,o,s,a,u,h,c,p=n&&n.split("/"),f=v.map,d=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(n){for(p=p.slice(0,p.length-1),t=p.concat(t.split("/")),u=0;u<t.length;u+=1)if(c=t[u],"."===c)t.splice(u,1),u-=1;else if(".."===c){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||d)&&f){for(e=t.split("/"),u=e.length;u>0;u-=1){if(r=e.slice(0,u).join("/"),p)for(h=p.length;h>0;h-=1)if(i=f[p.slice(0,h).join("/")],i&&(i=i[r])){l=i,o=u;break}if(l)break;!s&&d&&d[r]&&(s=d[r],a=u)}!l&&s&&(l=s,o=a),l&&(e.splice(0,o,l),t=e.join("/"))}return t}function o(t,n){return function(){return f.apply(r,M.call(arguments,0).concat([t,n]))}}function s(t){return function(n){return l(n,t)}}function a(t){return function(n){y[t]=n}}function u(t){if(i(m,t)){var n=m[t];delete m[t],w[t]=!0,p.apply(r,n)}if(!i(y,t)&&!i(w,t))throw new Error("No "+t);return y[t]}function h(t){var n,e=t?t.indexOf("!"):-1;return e>-1&&(n=t.substring(0,e),t=t.substring(e+1,t.length)),[n,t]}function c(t){return function(){return v&&v.config&&v.config[t]||{}}}var p,f,d,g,y={},m={},v={},w={},b=Object.prototype.hasOwnProperty,M=[].slice;d=function(t,n){var e,r=h(t),i=r[0];return t=r[1],i&&(i=l(i,n),e=u(i)),i?t=e&&e.normalize?e.normalize(t,s(n)):l(t,n):(t=l(t,n),r=h(t),i=r[0],t=r[1],i&&(e=u(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:e}},g={require:function(t){return o(t)},exports:function(t){var n=y[t];return"undefined"!=typeof n?n:y[t]={}},module:function(t){return{id:t,uri:"",exports:y[t],config:c(t)}}},p=function(t,n,e,l){var s,h,c,p,f,v,b=[];if(l=l||t,"function"==typeof e){for(n=!n.length&&e.length?["require","exports","module"]:n,f=0;f<n.length;f+=1)if(p=d(n[f],l),h=p.f,"require"===h)b[f]=g.require(t);else if("exports"===h)b[f]=g.exports(t),v=!0;else if("module"===h)s=b[f]=g.module(t);else if(i(y,h)||i(m,h)||i(w,h))b[f]=u(h);else{if(!p.p)throw new Error(t+" missing "+h);p.p.load(p.n,o(l,!0),a(h),{}),b[f]=y[h]}c=e.apply(y[t],b),t&&(s&&s.exports!==r&&s.exports!==y[t]?y[t]=s.exports:c===r&&v||(y[t]=c))}else t&&(y[t]=e)},t=n=f=function(t,n,e,i,l){return"string"==typeof t?g[t]?g[t](n):u(d(t,n).f):(t.splice||(v=t,n.splice?(t=n,n=e,e=null):t=r),n=n||function(){},"function"==typeof e&&(e=i,i=l),i?p(r,t,n,e):setTimeout(function(){p(r,t,n,e)},4),f)},f.config=function(t){return v=t,v.deps&&f(v.deps,v.callback),f},t._defined=y,e=function(t,n,e){n.splice||(e=n,n=[]),i(y,t)||i(m,t)||(m[t]=[t,n,e])},e.amd={jQuery:!0}}(),e("lib/almond",function(){}),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};e("parse",["require"],function(t){var e,r,i,l,o,s,a,u;return i=function(t){function e(t,n){this.input=t,this.type=n}return n(e,t),e.prototype.toString=function(){return"Could not parse '"+this.input+"' as "+this.type},e}(Error),a=/^@*[a-zA-Zα-ω][a-zA-Zα-ω_\-\d]*$/,e=/^-?\d+(\.\d+)?$/,l=/^-?\d+(\.\d+)?\/\d+(\.\d+)?$/,o=/^\\@*[a-zA-Zα-ω][a-zA-Zα-ω_\-\d]*$/,r=/^[^:]*::\{[^:+]*\}$/,u=function(n){var h,c,p;if(/\^/.test(n))throw new Error("Unexpected carat (^). Coffeequate uses ** for exponentiation");if(r.test(n))return h=n.split("::"),c=u(h[0]),c.units=new s(h[1].slice(1,h[1].length-1)),c;if(n=n.trim(),p=t("terminals"),e.test(n)||l.test(n))return new p.Constant(n);if(a.test(n))return new p.Variable(n);if(o.test(n))return new p.SymbolicConstant(n.slice(1));throw new i(n,"terminal")},s=function(){function n(e){return this.tokens=n.tokenise(e).reverse(),this.upto=0,this.operators=t("operators"),this.parseAddition()}return n.tokenise=function(t){return t.split(/(\*\*|[+*()\-:]|\s)/).filter(function(t){return!/^\s*$/.test(t)})},n.prototype.getToken=function(){return this.tokens[this.upto]},n.prototype.parseAddition=function(){var t,n;return n=this.parseMultiplication(),"+"!==this.getToken()?n:(this.upto+=1,t=this.parseAddition(),new this.operators.Add(t,n))},n.prototype.parseMultiplication=function(){var t,n;if(n=this.parsePower(),this.getToken()&&a.test(this.getToken()))throw new i(this.getToken(),"multiplication");return"*"!==this.getToken()?n:(this.upto+=1,t=this.parseMultiplication(),new this.operators.Mul(t,n))},n.prototype.parsePower=function(){var t,n;return t=this.parseBracket(),"**"!==this.getToken()?t:(this.upto+=1,n=this.parsePower(),new this.operators.Pow(n,t))},n.prototype.parseBracket=function(){var t,n;if(")"===this.getToken()){if(this.upto+=1,t=this.parseAddition(),"("!==this.getToken())throw new Error("ParseError: Expected '(' but found '"+this.getToken()+"' at position "+(""+(this.tokens.length-this.upto)+"/"+this.tokens.length+" in token stream '"+this.tokens.reverse().join(" ")+"'"));return this.upto+=1,"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,t)):t}return n=this.parseTerm(),"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,n)):n},n.prototype.parseTerm=function(){var t,n;if(n=[],"}"===this.getToken()[this.getToken().length-1]){for(;":"!==this.getToken()[0];)n.push(this.getToken()),this.upto+=1;n.push(this.getToken()),this.upto+=1,n.push(this.getToken()),this.upto+=1,n.push(this.getToken()),t=u(n.reverse().join(""))}else t=u(this.getToken());return this.upto+=1,t},n}(),{ParseError:i,stringToExpression:function(t){return new s(t)},constant:function(t){if("string"==typeof t||t instanceof String){if(""===t)throw new i("","constant");if(t=t.split("/"),1===t.length)return[parseFloat(t[0]),1];if(2===t.length)return[parseFloat(t[0]),parseFloat(t[1])];throw new i(t.join("/"),"constant")}if("number"==typeof t||t instanceof Number)return[t,1];throw new i(t,"constant")},stringToTerminal:u}})}.call(this),function(){e("generateInfo",[],function(){return{getMathMLInfo:function(t,n,e){var r,i,l,o;return null==e&&(e="0"),i=n?"expression":"equation",l=""+i+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),o=null!=t?'id="'+l+'"':"",r="<div "+o+' class="'+i+'"><math xmlns="http://www.w3.org/1998/Math/MathML">'+(null!=e?(isFinite(e)?"<mn>"+e+"</mn>":null!=e.toMathML?""+e.toMathML(t,n):"<mi>"+e+"</mi>")+"<mo>=</mo>":""),[i,l,r]},getHTMLInfo:function(t,n,e){var r,i,l,o;return null==e&&(e="0"),i=n?"expression":"equation",l=""+i+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),o=null!=t?'id="'+l+'"':"",r="<div "+o+' class="'+i+'">'+(null!=e?(null!=e.toHTML?""+e.toHTML(t,n):""+e)+"=":""),[i,l,r]}}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("terminals",["parse","generateInfo"],function(t,e){var i,l,o,s;return o=function(){function t(t){this.label=t}return t.prototype.evaluate=function(){},t.prototype.copy=function(){return new t(this.label)},t.prototype.toString=function(){return this.label},t}(),i=function(r){function i(n,e){var r,i;this.denominator=null!=e?e:null,this.cmp=-6,null!=this.denominator?(r=t.constant(n),this.numerator=r[0],e=r[1],this.denominator*=e):(i=t.constant(n),this.numerator=i[0],this.denominator=i[1])}return n(i,r),i.prototype.evaluate=function(){return this.numerator/this.denominator},i.prototype.copy=function(){return new i(this.numerator,this.denominator)},i.prototype.compareSameType=function(t){return this.evaluate()<t.evaluate()?-1:this.evaluate()===t.evaluate()?0:1},i.prototype.multiply=function(t){return new i(this.numerator*t.numerator,this.denominator*t.denominator)},i.prototype.add=function(t){return new i(t.denominator*this.numerator+this.denominator*t.numerator,this.denominator*t.denominator)},i.prototype.equals=function(t){return t instanceof i?this.evaluate()===t.evaluate():!1},i.prototype.replaceVariables=function(){return this.copy()},i.prototype.getAllVariables=function(){return[]},i.prototype.sub=function(){return this.copy()},i.prototype.simplify=function(){return this.copy()},i.prototype.expand=function(){return this.copy()},i.prototype.expandAndSimplify=function(){return this.copy()},i.prototype.substituteExpression=function(){return[this.copy()]},i.prototype.getVariableUnits=function(){return null},i.prototype.toMathML=function(t,n,r,i){var l,o,s,a,u;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),i?(u=e.getMathMLInfo(t,n,r),s=u[0],a=u[1],o=u[2],l="</math></div>"):(o="",l=""),1===this.denominator?o+('<mn class="constant">'+this.numerator+"</mn>")+l:o+('<mfrac class="constant"><mrow><mn>'+this.numerator+"</mn></mrow><mrow><mn>"+this.denominator+"</mn></mrow></mfrac>")+l},i.prototype.toHTML=function(t,n,r,i){var l,o,s,a,u;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),u=e.getHTMLInfo(t,n,r),s=u[0],a=u[1],o=u[2],i?l="</div>":(o="",l=""),1===this.denominator?o+(""+this.numerator)+l:o+("("+this.numerator+"/"+this.denominator+")")+l},i.prototype.toLaTeX=function(){return 1===this.denominator?""+this.numerator:"\\frac{"+this.numerator+"}{"+this.denominator+"}"},i.prototype.toString=function(){return 1!==this.denominator?""+this.numerator+"/"+this.denominator:""+this.numerator},i.prototype.differentiate=function(){return new i(0)},i}(o),l=function(t){function r(t,n,e){this.label=t,this.value=null!=n?n:null,this.units=null!=e?e:null,this.cmp=-5}return n(r,t),r.prototype.copy=function(){return new r(this.label,this.value,this.units)},r.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},r.prototype.evaluate=function(){return this.value},r.prototype.equals=function(t){return t instanceof r?this.label===t.label&&this.value===t.value:!1},r.prototype.replaceVariables=function(){return this.copy()},r.prototype.getAllVariables=function(){return[]},r.prototype.sub=function(){return this.copy()},r.prototype.simplify=function(){return this.copy()},r.prototype.expand=function(){return this.copy()},r.prototype.expandAndSimplify=function(){return this.copy()},r.prototype.substituteExpression=function(){return[this.copy()]},r.prototype.getVariableUnits=function(){return null},r.prototype.toHTML=function(t,n,r,i){var l,o,s,a,u;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),i?(u=e.getHTMLInfo(t,n,r),s=u[0],a=u[1],o=u[2],l="</div>"):(o="",l=""),o+'<span class="constant symbolic-constant">'+this.toString()+"</span>"+l},r.prototype.toMathML=function(t,n,r,i){var l,o,s,a,u;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),i?(u=e.getMathMLInfo(t,n,r),s=u[0],a=u[1],o=u[2],l="</math></div>"):(o="",l=""),""+o+'<mn class="constant symbolic-constant">'+this.label+"</mn>"+l},r.prototype.toLaTeX=function(){return"\\text{"+this.toString()+"}"},r.prototype.differentiate=function(){return new i(0)},r}(o),s=function(t){function l(t,n){this.label=t,this.units=null!=n?n:null,this.cmp=-4}return n(l,t),l.prototype.copy=function(){return new l(this.label,this.units)},l.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},l.prototype.equals=function(t,n){var e;return null==n&&(n=null),t instanceof l?null!=n?(e=this.label,r.call(n.get(t.label),e)>=0):t.label===this.label:!1},l.prototype.replaceVariables=function(t){return this.label in t?this.label=t[this.label]:void 0},l.prototype.getAllVariables=function(){return[this.label]},l.prototype.sub=function(t){var n;return this.label in t?(n=t[this.label],null!=n.copy?n.copy():new i(n)):this.copy()},l.prototype.substituteExpression=function(t,n,e,i){var l,o,s,a;return null==e&&(e=null),null==i&&(i=!1),null==e&&(e={get:function(t){return[t]}}),s=e.get(n),o=i?t.solve(n):[t],this.label===n||(a=this.label,r.call(s,a)>=0)?function(){var t,n,e;for(e=[],t=0,n=o.length;n>t;t++)l=o[t],e.push(l.copy());return e}():[this.copy()]},l.prototype.getVariableUnits=function(t,n){var e;if(null!=n){if(e=this.label,r.call(n.get(t),e)>=0)return this.units}else if(this.label===t)return this.units;return null},l.prototype.simplify=function(){return this.copy()},l.prototype.expand=function(){return this.copy()},l.prototype.expandAndSimplify=function(){return this.copy()},l.prototype.toMathML=function(t,n,r,i){var l,o,s,a,u,h,c,p,f,d,g,y;for(null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),i?(y=e.getMathMLInfo(t,n,r),d=y[0],g=y[1],u=y[2],a="</div>"):(u="",a=""),p=this.label.split("-"),c=p[0],f=null!=p[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",l=0;"@"===c[0];)l+=1,c=c.slice(1);return s='<mover accent="true">',o="<mrow><mo>"+function(){var t,n;for(n=[],h=t=0;l>=0?l>t:t>l;h=l>=0?++t:--t)n.push(".");return n}().join("")+"</mo></mrow></mover>",c.length>1?u+s+'<msub class="variable"'+f+"><mi>"+c[0]+"</mi><mi>"+c.slice(1)+"</mi></msub>"+o+a:u+s+'<mi class="variable"'+f+">"+c+"</mi>"+o+a},l.prototype.toHTML=function(t,n,r,i){var l,o,s,a,u,h,c,p;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),i?(p=e.getHTMLInfo(t,n,r),h=p[0],c=p[1],o=p[2],l="</div>"):(o="",l=""),a=this.label.split("-"),s=a[0],u=null!=a[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",o+'<span class="variable"'+u+">"+s+"</span>"+l},l.prototype.toLaTeX=function(){var t;return t=this.label.replace("-","_"),t.length>1&&(t=t[0]+"_{"+t.slice(1)+"}"),t},l.prototype.differentiate=function(t){return t===this.label?new i(1):new i(0)},l}(o),{Terminal:o,Variable:s,Constant:i,SymbolicConstant:l}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};e("nodes",[],function(){var t;return t=function(){function t(t){this.label=t}return t.prototype.getChildren=function(){return[]},t}(),{BasicNode:t,RoseNode:function(t){function e(t,n){this.children=null!=n?n:null,null==this.children&&(this.children=[]),e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.getChildren=function(){return this.children},e.prototype.toLisp=function(){var t;return console.log(this.children),t=this.children.map(function(t){return t.toLisp?t.toLisp():t}),"("+this.label+(this.children?" ":"")+t.join(" ")+")"},e.prototype.toString=function(){return"("+this.children.join(" "+this.label+" ")+")"},e}(t),BinaryNode:function(t){function e(t,n,e){this.label=t,this.children={left:n,right:e}}return n(e,t),e.prototype.getChildren=function(){return[this.children.left,this.children.right]},e.prototype.toLisp=function(){var t;return t=function(t){return t.toLisp?t.toLisp():t},"("+this.label+" "+t(this.children.left)+" "+t(this.children.right)+")"},e.prototype.toString=function(){return"("+this.children.left+" "+this.label+" "+this.children.right+")"},e}(t)}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};e("AlgebraError",[],function(){var t;return t=function(t){function e(t,n,r){null==r&&(r=null),e.__super__.constructor.call(this,"Unsolvable: "+t+" for "+n+(r?";"+r:""))}return n(e,t),e}(Error)})}.call(this),function(){var t=[].slice;e("parseArgs",["nodes","parse","terminals"],function(n,e,r){var i;return i=function(){var i,l,o,s,a;for(l=1<=arguments.length?t.call(arguments,0):[],o=[],s=0,a=l.length;a>s;s++)if(i=l[s],"string"==typeof i||i instanceof String)o.push(e.stringToTerminal(i));else if("number"==typeof i||i instanceof Number)o.push(new r.Constant(i));else{if(!(i instanceof r.Terminal||i instanceof n.BasicNode||null!=i.isTerminal))throw new Error("Invalid argument "+i+", ("+typeof i+"), ("+i.toString()+")");o.push(i)}return o}})}.call(this),function(){e("compare",[],function(){var t;return t=function(t,n){return null!=t.cmp&&null!=n.cmp?t.cmp===n.cmp?t.compareSameType(n):(t.cmp-n.cmp)/Math.abs(t.cmp-n.cmp):0}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].slice,i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators/Add",["nodes","terminals","generateInfo","AlgebraError","parseArgs","require","compare"],function(t,e,l,o,s,a,u){var h,c;return c=function(t){var n,e,r,i,l,o,s,a,u;if(1===t.length)return function(){var e,r,i,l;for(i=t[0],l=[],e=0,r=i.length;r>e;e++)n=i[e],l.push(n);return l}();for(r=[],a=t[0],i=0,o=a.length;o>i;i++)for(n=a[i],u=c(t.slice(1)),l=0,s=u.length;s>l;l++)e=u[l],r.push([n].concat(e));return r},h=function(h){function p(){var t;if(t=1<=arguments.length?r.call(arguments,0):[],t.length<1)throw new Error("Add nodes must have at least one child.");this.cmp=-1,t=s.apply(null,t),p.__super__.constructor.call(this,"+",t)}return n(p,h),p.prototype.copy=function(){var t,n;return t=function(){var t,e,r,i;for(r=this.children,i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(null!=n.copy?n.copy():n);return i}.call(this),function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,t,function(){})},p.prototype.compareSameType=function(t){var n,e,r,i,l,o,s;for(i=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,s=this.children,r=l=0,o=s.length;o>l;r=++l){if(e=s[r],null==t.children[r])return 1;if(n=u(this.children[r],t.children[r]),0!==n)return n}return i},p.prototype.getVariableUnits=function(t,n){var r,l,o,s,a,u,h;for(o=null!=n?n.get(t):[t],u=this.children,s=0,a=u.length;a>s;s++){if(r=u[s],r instanceof e.Variable&&(h=r.label,i.call(o,h)>=0))return r.units;if(l=r.getVariableUnits(t,n),null!=l)return l}return null},p.prototype.expand=function(){var t,n,e,r,i,l,o,s,a,u;for(r=[],a=this.children,i=0,o=a.length;o>i;i++)if(e=a[i],null!=e.expand?e=e.expand():null!=e.copy&&(e=e.copy()),e instanceof p)for(u=e.children,l=0,s=u.length;s>l;l++)n=u[l],r.push(n);else r.push(e);return t=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,r,function(){}),t.sort(),t},p.prototype.sort=function(){var t,n,e,r;for(r=this.children,n=0,e=r.length;e>n;n++)t=r[n],"function"==typeof t.sort&&t.sort();return this.children.sort(u)},p.prototype.equals=function(t,n){var e,r,i,l,o;if(!(t instanceof p))return!1;if(t.children.length!==this.children.length)return!1;for(o=this.children,r=i=0,l=o.length;l>i;r=++i)if(e=o[r],null!=e.equals){if(!e.equals(t.children[r],n))return!1}else if(e!==t.children[r])return!1;return!0},p.prototype.simplify=function(t){var n,r,i,l,o,s,u,h,c,f,d,g,y,m,v,w,b,M,T,x,A,V,L,S,C,_,q,E,k,j,O;for(n=a("operators/Mul"),null==t&&(t={get:function(t){return[t]}}),m=[],k=this.children,b=0,A=k.length;A>b;b++)i=k[b],null!=i.simplify?i=i.simplify(t):null!=i.copy&&(i=i.copy()),m.push(i);for(f=[],l=null,u=0;u<m.length;){if(y=m[u],y instanceof p){for(m.splice(u,1)[0],j=y.children,M=0,V=j.length;V>M;M++)r=j[M],m.push(r);u-=1}else if(y instanceof e.Constant)l=null!=l?l.add(y):y.copy();else if(y instanceof n){for(o=null,v=null,O=y.children,T=0,L=O.length;L>T;T++)i=O[T],i instanceof e.Constant?o=null!=o?o.multiply(i):i.copy():null!=v?v.children.push(i):v=new n(i);if(1===v.children.length&&(v=v.children[0]),null!=o&&null==v)l=null!=l?l.add(o):o.copy();else{for(null==o&&(o=new e.Constant("1")),s=!1,h=x=0,S=f.length;S>x;h=++x)c=f[h],null!=c[0].equals?c[0].equals(v,t)&&(f[h][1]=new p(c[1],o),f[h][1]=f[h][1].simplify(t),s=!0):c[0]===v&&(f[h][1]=new p(c[1],o),f[h][1]=f[h][1].simplify(t),s=!0);s||f.push([v,o])}}else{for(s=!1,h=q=0,C=f.length;C>q;h=++q)c=f[h],null!=c[0].equals?c[0].equals(y,t)&&(f[h][1]=new p(c[1],new e.Constant("1")),f[h][1]=f[h][1].simplify(t),s=!0):c[0]===y&&(f[h][1]=new p(c[1],new e.Constant("1")),f[h][1]=f[h][1].simplify(t),s=!0);s||f.push([y,new e.Constant("1")])}u+=1}for(d=null,E=0,_=f.length;_>E;E++)c=f[E],null!=c[0].children&&1===c[0].children.length&&(c[0]=c[0].children[0]),1!==("function"==typeof(w=c[1]).evaluate?w.evaluate():void 0)?(g=new n(c[0],c[1]),g=g.simplify(t)):g=c[0],null!=d?d.children.push(g):d=new p(g);return null==d?l:(null!=l&&0!==l.evaluate()&&d.children.push(l),d.sort(),1!==d.children.length?d:d.children[0])},p.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},p.prototype.solve=function(t,n){var r,l,s,u,h,c,f,d,g,y,m,v,w,b,M,T,x,A,V,L,S,C,_,q,E,k,j,O,H,P,I,N,X,U,B,z,$,F,Z,R,G,Q,D,J,K,W,Y,tn,nn,en,rn,ln,on,sn,an,un,hn,cn,pn,fn,dn,gn,yn,mn;for(null==n&&(n=null),r=a("operators/Mul"),l=a("operators/Pow"),v=this.expandAndSimplify(n),null==n&&(n={get:function(t){return[t]}}),z=[],$=[],G=null,Q=0,W=n.length;W>Q;Q++)if(m=n[Q],F=this.getVariableUnits(m),null!=F){G=F;break}if(v instanceof e.Terminal){if(v instanceof e.Variable&&(v.label===t||(sn=v.label,i.call(n.get(t),sn)>=0)))return[new e.Constant("0")];throw new o(v.toString(),t)}if(!(v instanceof p))return v.solve(t,n);for(an=v.children,D=0,Y=an.length;Y>D;D++)if(B=an[D],null!=B.copy&&(B=B.copy()),B instanceof l)B.children.left instanceof e.Variable&&(B.children.left.label===t||(hn=B.children.left.label,i.call(n.get(t),hn)>=0))?z.push(B):$.push(B);else if(B instanceof r){for(c=!1,cn=B.children,J=0,tn=cn.length;tn>J;J++){if(X=cn[J],X instanceof e.Variable&&(X.label===t||(pn=X.label,i.call(n.get(t),pn)>=0))){z.push(B),c=!0;break}if(X instanceof l&&X.children.left instanceof e.Variable&&(X.children.left.label===t||(fn=X.children.left.label,i.call(n.get(t),fn)>=0))){z.push(B),c=!0;break}}c||$.push(B)}else B instanceof e.Variable&&(B.label===t||(dn=B.label,i.call(n.get(t),dn)>=0))?z.push(B):$.push(B);if(0===z.length)throw new o(v.toString(),t);for(w=[],M=[],L=[],C=[],K=0,nn=z.length;nn>K;K++)if(B=z[K],B instanceof e.Variable)w.push(new e.Constant("1"));else if(B instanceof l){if(!(B.children.right instanceof e.Constant))throw new o(v.toString(),t);if(P=B.children.right.evaluate(),!(B.children.left instanceof e.Variable&&(B.children.left.label===t||(gn=B.children.left.label,i.call(n.get(t),gn)>=0))))throw new o(v.toString(),t," (this shouldn't happen)");if(1===P)w.push(new e.Constant("1"));else if(2===P)M.push(new e.Constant("1"));else if(-1===P)L.push(new e.Constant("1"));else{if(-2!==P)throw new o(v.toString(),t," (not supported)");C.push(new e.Constant("1"))}}else if(B instanceof r){for(U=[],I=!1,A=!1,V=!1,yn=B.children,ln=0,en=yn.length;en>ln;ln++)if(X=yn[ln],X instanceof e.Variable&&(X.label===t||(mn=X.label,i.call(n.get(t),mn)>=0)));else if(X instanceof l){if(!(X.children.right instanceof e.Constant))throw new o(v.toString(),t);if(P=X.children.right.evaluate(),X.children.left instanceof e.Variable&&(X.children.left.label===t||(un=X.children.left.label,i.call(n.get(t),un)>=0)))if(1===P);else if(2===P)I=!0;else if(-1===P)A=!0;else{if(-2!==P)throw new o(v.toString(),t," (not supported)");V=!0}else U.push(X)}else U.push(X);x=U.length>0?function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(r,U,function(){}):new e.Constant("1"),I?M.push(x):A?L.push(x):V?C.push(x):w.push(x)}for(q=[],on=0,rn=$.length;rn>on;on++)B=$[on],j=new r("-1",null!=B.copy?B.copy():B),j=j.simplify(n),q.push(j);if(0!==q.length&&(E=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,q,function(){})),0!==$.length&&(H=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,$,function(){})),0!==w.length&&(b=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,w,function(){})),0!==M.length&&(T=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,M,function(){})),0!==L.length&&(S=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,L,function(){})),0!==C.length&&(_=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,C,function(){})),0===q.length&&(E=new e.Constant("0")),0===M.length){if(0===w.length){if(0===L.length){if(0===C.length)throw new o(v.toString(),t);return f=new r(new l(_,"1/2"),new l(E,"-1/2")),u=new r(-1,f.copy()),u=u.expandAndSimplify(n),h=f.expandAndSimplify(n),("function"==typeof u.equals?u.equals(h):void 0)?[u]:[u,h]}return 0===C.length?(f=new r(S,new l(E,"-1")),[f.expandAndSimplify(n)]):(k=new p(new r(H,new l(new e.Variable(t,G),2)),new r(S,new e.Variable(t,G)),_),k.solve(t,n))}if(0===L.length){if(0===C.length)return f=new r(E,new l(b,"-1")),[f.expandAndSimplify(n)];throw new o(v.toString(),t," (not supported)")}throw new o(v.toString(),t," (not supported)")}if(0===w.length){if(0===L.length){if(0===C.length)return f=new l(new r(E,new l(T,"-1")),"1/2"),u=new r("-1",f.copy()),u=u.expandAndSimplify(n),h=f.expandAndSimplify(n),("function"==typeof u.equals?u.equals(h):void 0)?[u]:[u,h];throw new o(v.toString(),t," (not supported)")}throw new o(v.toString(),t," (not supported)")}if(L.length>0||C.length>0)throw new o(v.toString(),t," (not supported)");return null!=H?(s=T,d=b,g=H,y=new p(new l(d,"2"),new r("-4",s,g)),N=new l(y,"1/2"),Z=new r(new p(new r("-1",d),N),new l(new r("2",s),"-1")),R=new r("-1",new p(d,N),new l(new r("2",s),"-1")),Z=Z.expandAndSimplify(n),R=R.expandAndSimplify(n),null!=Z.equals&&Z.equals(R)?[Z]:[Z,R]):(O=new l(T,"-1"),j=new r("-1",b,O),j=j.simplify(n),[0,j])},p.prototype.getAllVariables=function(){var t,n,r,i,l,o,s,a,u,h;for(l={},h=this.children,o=0,a=h.length;a>o;o++)if(t=h[o],t instanceof e.Variable)l[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),s=0,u=n.length;u>s;s++)i=n[s],l[i]=!0;r=[];for(i in l)r.push(i);return r},p.prototype.replaceVariables=function(t){var n,r,i,l,o,s;for(o=this.children,s=[],r=i=0,l=o.length;l>i;r=++i)n=o[r],n instanceof e.Variable&&n.label in t?s.push(this.children[r].label=t[n.label]):null!=n.replaceVariables?s.push(n.replaceVariables(t)):s.push(void 0);return s},p.prototype.sub=function(n,r){var i,l,o,s,a,u,h,c,f,d,g,y;null==r&&(r=null);for(u in n)n[u]instanceof e.Terminal||n[u]instanceof t.BasicNode||(n[u]=new e.Constant(n[u]));for(null==r&&(r={get:function(t){return[t]}}),l=[],y=this.children,c=0,d=y.length;d>c;c++)if(i=y[c],i instanceof e.Variable){for(h=r.get(i.label),a=!1,f=0,g=h.length;g>f;f++)if(o=h[f],o in n){l.push(n[o].copy()),a=!0;break}a||l.push(i.copy())}else null!=i.sub?l.push(i.sub(n,r)):l.push(i.copy());return s=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,l,function(){}),s=s.expandAndSimplify(r)},p.prototype.substituteExpression=function(t,n,r,l){var o,s,a,u,h,f,d,g,y,m,v,w,b,M,T,x,A;for(null==r&&(r=null),null==l&&(l=!1),g=l?t.solve(n,r):[t],null==r&&(r={get:function(t){return[t]}}),y=r.get(n),d=[],m=0,b=g.length;b>m;m++){for(h=g[m],u=[],x=this.children,v=0,M=x.length;M>v;v++)o=x[v],o instanceof e.Variable&&(o.label===n||(A=o.label,i.call(y,A)>=0))?u.push([h.copy()]):null!=o.substituteExpression?u.push(o.substituteExpression(h,n,r)):u.push([o.copy()]);a=c(u)}for(w=0,T=a.length;T>w;w++)s=a[w],f=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,s,function(){}),d.push(f.expandAndSimplify(r));return d},p.prototype.toMathML=function(t,n,e,r){var i,o,s,a,u;return null==n&&(n=!1),null==e&&(e="0"),null==r&&(r=!1),u=l.getMathMLInfo(t,n,e),s=u[0],a=u[1],o=u[2],r?i="</math></div>":(o="",i=""),o+"<mrow>"+this.children.map(function(e){return e.toMathML(t,n)}).join("<mo>+</mo>")+"</mrow>"+i},p.prototype.toHTML=function(t,n,e,r){var i,o,s,a,u;return null==n&&(n=!1),null==e&&(e="0"),null==r&&(r=!1),u=l.getHTMLInfo(t,n,e),s=u[0],a=u[1],o=u[2],r?i="</div>":(o="",i=""),o+this.children.map(function(t){return t.toHTML()}).join("+")+i},p.prototype.toLaTeX=function(){return this.children.map(function(t){return t.toLaTeX()}).join(" + ")},p.prototype.differentiate=function(t){var n,e;return console.log(this.children),e=this.children.map(function(n){return n.differentiate(t)}),console.log(e),n=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,e,function(){}),n.expandAndSimplify()},p}(t.RoseNode)})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].slice,i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators/Mul",["nodes","terminals","generateInfo","AlgebraError","parseArgs","require","compare"],function(t,e,l,o,s,a,u){var h,c;return c=function(t){var n,e,r,i,l,o,s,a,u;if(1===t.length)return function(){var e,r,i,l;for(i=t[0],l=[],e=0,r=i.length;r>e;e++)n=i[e],l.push(n);return l}();for(r=[],a=t[0],i=0,o=a.length;o>i;i++)for(n=a[i],u=c(t.slice(1)),l=0,s=u.length;s>l;l++)e=u[l],r.push([n].concat(e));return r},h=function(h){function p(){var t;if(t=1<=arguments.length?r.call(arguments,0):[],t.length<1)throw new Error("Mul nodes must have at least one child.");this.cmp=-2,t=s.apply(null,t),p.__super__.constructor.call(this,"*",t)}return n(p,h),p.prototype.copy=function(){var t,n;return t=function(){var t,e,r,i;for(r=this.children,i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(null!=n.copy?n.copy():n);return i}.call(this),function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,t,function(){})},p.prototype.simplifyConstants=function(){var t,n,r,i,l,o;for(n=new e.Constant("1"),r=null,o=this.children,i=0,l=o.length;l>i;i++)t=o[i],t instanceof e.Constant?n=n.multiply(t):null!=r?r.children.push(t):r=new p(t);return null==r?n:1===n.evaluate()?r:new p(n,r)},p.prototype.compareSameType=function(t){var n,e,r,i,l,o,s;for(i=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,s=this.children,r=l=0,o=s.length;o>l;r=++l){if(e=s[r],null==t.children[r])return 1;if(n=u(this.children[r],t.children[r]),0!==n)return n}return i},p.prototype.getVariableUnits=function(t,n){var r,l,o,s,a,u,h;for(o=null!=n?n.get(t):[t],u=this.children,s=0,a=u.length;a>s;s++){if(r=u[s],r instanceof e.Variable&&(h=r.label,i.call(o,h)>=0))return r.units;if(l=r.getVariableUnits(t,n),null!=l)return l}return null},p.expandMulAdd=function(t,n){var e,r,i,l,o,s,u,h,c,f,d,g;for(e=a("operators/Add"),s=[],d=n.children,u=0,c=d.length;c>u;u++){if(i=d[u],null!=i.copy&&(i=i.copy()),i instanceof p)for(o=t.copy(),g=i.children,h=0,f=g.length;f>h;h++)r=g[h],o.children.push(r);else i instanceof e?o=p.expandMulAdd(t,i):1===t.children.length?(o=t.copy(),o.children.push(i.copy())):o=new p(t.copy(),i.copy());s.push(o)}return l=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(e,s,function(){}),l=l.expand()},p.prototype.equals=function(t,n){var e,r,i,l,o;if(!(t instanceof p))return!1;if(t.children.length!==this.children.length)return!1;for(o=this.children,r=i=0,l=o.length;l>i;r=++i)if(e=o[r],null!=e.equals){if(!e.equals(t.children[r],n))return!1}else if(e!==t.children[r])return!1;return!0},p.prototype.expand=function(){var t,n,e,r,i,l,o,s,u,h,c,f,d,g,y;for(t=a("operators/Add"),i=[],d=this.children,o=0,h=d.length;h>o;o++)n=d[o],null!=n.expand?n=n.expand():null!=n.copy&&(n=n.copy()),i.push(n);for(;i.length>1;)if(i[0]instanceof p)if(i[1]instanceof t)i[0]=p.expandMulAdd(i[0],i.splice(1,1)[0]);else if(i[1]instanceof p)for(g=i.splice(1,1)[0].children,s=0,c=g.length;c>s;s++)n=g[s],i[0].children.push(n);else i[0].children.push(i.splice(1,1)[0]);else if(i[0]instanceof t)if(i[1]instanceof t){for(r=[],y=i[0].children,u=0,f=y.length;f>u;u++)n=y[u],e=new p(n,i[1]),e=e.expand(),r.push(e);i.splice(1,1),i[0]=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(t,r,function(){}),i[0]=i[0].expand()}else i[0]=i[1]instanceof p?p.expandMulAdd(i.splice(1,1)[0],i[0]):new p(i[0],i.splice(1,1)[0]);else i[0]=new p(i[0]);return"function"==typeof(l=i[0]).sort&&l.sort(),i[0]
},p.prototype.simplify=function(t){var n,r,i,l,o,s,u,h,c,f,d,g,y,m,v,w,b,M,T,x,A,V,L,S,C,_,q,E,k,j,O,H,P,I,N,X,U;for(n=a("operators/Add"),r=a("operators/Pow"),null==t&&(t={get:function(t){return[t]}}),b=[],O=this.children,T=0,L=O.length;L>T;T++)o=O[T],null!=o.simplify?o=o.simplify(t):null!=o.copy&&(o=o.copy()),b.push(o);for(d=[],s=null,h=0;h<b.length;){if(w=b[h],w instanceof p){for(o=b.splice(h,1)[0],H=o.children,x=0,S=H.length;S>x;x++)l=H[x],b.push(l);h-=1}else if(w instanceof e.Constant)s=null!=s?s.multiply(w):w.copy();else if(w instanceof r){for(i=w.children.left,v=w.children.right,u=!1,c=A=0,C=d.length;C>A;c=++A)f=d[c],null!=f[0].equals?f[0].equals(i,t)&&(d[c][1]=new n(f[1],v),d[c][1]=d[c][1].simplify(t),1===(null!=(P=d[c][1].children)?P.length:void 0)&&(d[c][1]=d[c][1].children[0]),u=!0):f[0]===i&&(d[c][1]=new n(f[1],v),d[c][1]=d[c][1].simplify(t),1===(null!=(I=d[c][1].children)?I.length:void 0)&&(d[c][1]=d[c][1].children[0]),u=!0);u||d.push([i,v])}else{for(u=!1,c=V=0,_=d.length;_>V;c=++V)f=d[c],null!=f[0].equals?f[0].equals(w,t)&&(d[c][1]=new n(f[1],new e.Constant("1")),d[c][1]=d[c][1].simplify(t),1===(null!=(N=d[c][1].children)?N.length:void 0)&&(d[c][1]=d[c][1].children[0]),u=!0):f[0]===w&&(d[c][1]=new n(f[1],new e.Constant("1")),d[c][1]=d[c][1].simplify(t),1===(null!=(X=d[c][1].children)?X.length:void 0)&&(d[c][1]=d[c][1].children[0]),u=!0);u||d.push([w,new e.Constant("1")])}h+=1}if(0===(null!=s?"function"==typeof s.evaluate?s.evaluate():void 0:void 0))return new e.Constant("0");for(g=null,k=0,q=d.length;q>k;k++)f=d[k],1!==("function"==typeof(M=f[1]).evaluate?M.evaluate():void 0)?(y=new r(f[0],f[1]),y=y.simplify(t)):y=f[0],null!=g?g.children.push(y):g=new p(y);if(null==g)return s;for(null!=s&&1!==s.evaluate()&&g.children.push(s),g.sort(),m=!0,U=g.children,j=0,E=U.length;E>j;j++)if(o=U[j],!(o instanceof e.Constant)){m=!1;break}return m?g.simplifyConstants():1!==g.children.length?g:g.children[0]},p.prototype.sort=function(){var t,n,e,r;for(r=this.children,n=0,e=r.length;e>n;n++)t=r[n],"function"==typeof t.sort&&t.sort();return this.children.sort(u)},p.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},p.prototype.solve=function(t,n){var r,l,s,u,h,c,f,d,g;if(null==n&&(n=null),r=a("operators/Pow"),u=this.expandAndSimplify(n),null==n&&(n={get:function(t){return[t]}}),u instanceof e.Terminal){if(u instanceof e.Variable&&(u.label===t||(f=u.label,i.call(n.get(t),f)>=0)))return[new e.Constant("0")];throw new o(u.toString(),t)}if(!(u instanceof p))return u.solve(t,n);for(d=u.children,h=0,c=d.length;c>h;h++){if(l=d[h],l instanceof e.Variable&&(l.label===t||(g=l.label,i.call(n.get(t),g)>=0)))return[new e.Constant("0")];if(l instanceof r)try{return l.solve(t,n)}catch(y){if(s=y,s instanceof o)continue;throw s}}throw new o(u.toString(),t)},p.prototype.getAllVariables=function(){var t,n,r,i,l,o,s,a,u,h;for(l={},h=this.children,o=0,a=h.length;a>o;o++)if(t=h[o],t instanceof e.Variable)l[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),s=0,u=n.length;u>s;s++)i=n[s],l[i]=!0;r=[];for(i in l)r.push(i);return r},p.prototype.replaceVariables=function(t){var n,r,i,l,o,s;for(o=this.children,s=[],r=i=0,l=o.length;l>i;r=++i)n=o[r],n instanceof e.Variable&&n.label in t?s.push(this.children[r].label=t[n.label]):null!=n.replaceVariables?s.push(n.replaceVariables(t)):s.push(void 0);return s},p.prototype.sub=function(n,r){var i,l,o,s,a,u,h,c,f,d,g,y;null==r&&(r=null);for(u in n)n[u]instanceof e.Terminal||n[u]instanceof t.BasicNode||(n[u]=new e.Constant(n[u]));for(null==r&&(r={get:function(t){return[t]}}),l=[],y=this.children,c=0,d=y.length;d>c;c++)if(i=y[c],i instanceof e.Variable){for(h=r.get(i.label),a=!1,f=0,g=h.length;g>f;f++)if(o=h[f],o in n){l.push(n[o].copy()),a=!0;break}a||l.push(i.copy())}else null!=i.sub?l.push(i.sub(n,r)):l.push(i.copy());return s=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,l,function(){}),s=s.expandAndSimplify(r)},p.prototype.substituteExpression=function(t,n,r,l){var o,s,a,u,h,f,d,g,y,m,v,w,b,M,T,x,A;for(null==r&&(r=null),null==l&&(l=!1),g=l?t.solve(n,r):[t],null==r&&(r={get:function(t){return[t]}}),y=r.get(n),d=[],m=0,b=g.length;b>m;m++){for(h=g[m],u=[],x=this.children,v=0,M=x.length;M>v;v++)o=x[v],o instanceof e.Variable&&(o.label===n||(A=o.label,i.call(y,A)>=0))?u.push([h.copy()]):null!=o.substituteExpression?u.push(o.substituteExpression(h,n,r)):u.push([o.copy()]);for(console.log("childrenExpressions",u),a=c(u),console.log("childrenArray",a),w=0,T=a.length;T>w;w++)s=a[w],f=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,s,function(){}),d.push(f.expandAndSimplify(r))}return console.log(d),d},p.prototype.toMathML=function(t,n,r,i){var o,s,u,h,c,p,f,d,g,y,m,v,w,b;if(null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),o=a("operators/Add"),s=a("operators/Pow"),b=l.getMathMLInfo(t,n,r),g=b[0],y=b[1],f=b[2],i?h="</math></div>":(f="",h=""),c=function(){var t,n,e,r;for(e=this.children,r=[],t=0,n=e.length;n>t;t++)u=e[t],u instanceof s&&null!=u.children.right.evaluate&&u.children.right.evaluate()<0&&r.push(new s(u,"-1").simplify());return r}.call(this),v=function(){var t,n,e,r;for(e=this.children,r=[],t=0,n=e.length;n>t;t++)u=e[t],u instanceof s&&null!=u.children.right.evaluate&&u.children.right.evaluate()<0||r.push(u);return r}.call(this),w=v.filter(function(t){return!(t instanceof e.Constant&&-1===("function"==typeof t.evaluate?t.evaluate():void 0))}),p=c.filter(function(t){return!(t instanceof e.Constant&&-1===("function"==typeof t.evaluate?t.evaluate():void 0))}),m=c.length-p.length+v.length-w.length,c.length>0&&v.length>0)return f+function(){var t,n;for(n=[],d=t=0;m>=0?m>t:t>m;d=m>=0?++t:--t)n.push("<mo>-</mo>");return n}().join("")+"<mfrac><mrow>"+w.map(function(e){return e instanceof o?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow><mrow>"+p.map(function(e){return e instanceof o?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow></mfrac>"+h;if(c.length>0)return f+function(){var t,n;for(n=[],d=t=0;m>=0?m>t:t>m;d=m>=0?++t:--t)n.push("<mo>-</mo>");return n}().join("")+"<mfrac><mn>1</mn><mrow>"+p.map(function(e){return e instanceof o?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow></mfrac>"+h;if(v.length>0)return f+function(){var t,n;for(n=[],d=t=0;m>=0?m>t:t>m;d=m>=0?++t:--t)n.push("<mo>-</mo>");return n}().join("")+"<mrow>"+w.map(function(e){return e instanceof o?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow>"+h;throw new Error("No terms in Mul node.")},p.prototype.toHTML=function(t,n,e,r){var i,o,s,u,h,c;return null==n&&(n=!1),null==e&&(e="0"),null==r&&(r=!1),i=a("operators/Add"),c=l.getHTMLInfo(t,n,e),u=c[0],h=c[1],s=c[2],r?o="</div>":(s="",o=""),s+this.children.map(function(t){return t instanceof i?"("+t.toHTML()+")":t.toHTML()}).join("&middot;")+o},p.prototype.toLaTeX=function(){var t;return t=a("operators/Add"),this.children.map(function(n){return n instanceof t?"\\left("+n.toLaTeX()+"\\right)":n.toLaTeX()}).join(" \\cdot ")},p.prototype.differentiate=function(t){var n,e,r;if(n=a("operators/Add"),0===this.children.length)throw new Error("I'm pretty sure you need children in your Mul node");return 1===this.children.length?this.children[0].differentiate(t).expandAndSimplify():(e=this.children[0],r=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(p,this.children.slice(1),function(){}),new n(new p(e,r.differentiate(t)),new p(r,e.differentiate(t))).expandAndSimplify())},p}(t.RoseNode)})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].slice,i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators/Pow",["nodes","terminals","generateInfo","AlgebraError","parseArgs","require","compare"],function(t,e,l,o,s,a,u){var h;return h=function(h){function c(){var t,n,e,i;if(n=arguments[0],e=arguments[1],t=3<=arguments.length?r.call(arguments,2):[],null==n||null==e)throw new Error("Pow nodes must have two children.");if(t.length>0)throw new Error("Pow nodes must have two children.");this.cmp=-3,i=s(n,e),n=i[0],e=i[1],c.__super__.constructor.call(this,"**",n,e)}return n(c,h),c.prototype.copy=function(){return new c(null!=this.children.left.copy?this.children.left.copy():this.children.left,null!=this.children.right.copy?this.children.right.copy():this.children.right)},c.prototype.sort=function(){var t,n;return"function"==typeof(t=this.children.left).sort&&t.sort(),"function"==typeof(n=this.children.right).sort?n.sort():void 0},c.prototype.equals=function(t,n){if(!(t instanceof c))return!1;if(null!=this.children.left.equals){if(!this.children.left.equals(t.children.left,n))return!1}else if(this.children.left!==t.children.left)return!1;if(null!=this.children.right.equals){if(!this.children.right.equals(t.children.right,n))return!1}else if(this.children.right!==t.children.right)return!1;return!0},c.prototype.compareSameType=function(t){var n;return n=u(this.children.left,t.children.left),0!==n?n:u(this.children.right,t.children.right)},c.prototype.getVariableUnits=function(t,n){var r,l,o,s,a;return o=null!=n?n.get(t):{get:function(t){return[t]}},this.children.left instanceof e.Variable&&(s=this.children.left.label,i.call(o,s)>=0)?this.children.left.units:(r=this.children.left.getVariableUnits(t,n),null!=r?r:this.children.right instanceof e.Variable&&(a=this.children.right.label,i.call(o,a)>=0)?this.children.right.units:(l=this.children.right.getVariableUnits(t,n),null!=l?l:null))},c.prototype.expand=function(){var t,n,r,i,l,o,s,u,h,p,f,d,g,y,m;if(n=a("operators/Mul"),t=a("operators/Add"),s=null!=this.children.left.expand?this.children.left.expand():null!=this.children.left.copy?this.children.left.copy():this.children.left,p=null!=this.children.right.expand?this.children.right.expand():null!=this.children.right.copy?this.children.right.copy():this.children.right,null!=s.children){if(s instanceof c)s.children.right=new n(s.children.right,p),s.expand();else if(s instanceof n)for(y=s.children,o=f=0,g=y.length;g>f;o=++f)r=y[o],h=new c(r,p),h=h.expand(),s.children[o]=h;else if(s instanceof t)if(p instanceof e.Constant&&0===p.evaluate()%1&&p.evaluate()>0){for(i=[],l=d=1,m=p.evaluate();m>=1?m>=d:d>=m;l=m>=1?++d:--d)i.push(s);u=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(n,i,function(){}),u=u.expand(),s=u}else s=new c(s,p);return s}return new c(s,p)},c.prototype.simplify=function(t){var n,r,i,l,o;return n=a("operators/Mul"),null==t&&(t={get:function(t){return[t]}}),r=null!=this.children.left.simplify?this.children.left.simplify(t):null!=this.children.left.copy?this.children.left.copy():this.children.left,o=null!=this.children.right.simplify?this.children.right.simplify(t):null!=this.children.right.copy?this.children.right.copy():this.children.right,1===("function"==typeof o.evaluate?o.evaluate():void 0)?r:1===("function"==typeof r.evaluate?r.evaluate():void 0)?r:0===("function"==typeof o.evaluate?o.evaluate():void 0)?new e.Constant("1"):o instanceof e.Constant&&r instanceof e.Constant?new e.Constant(Math.pow(r.evaluate(),o.evaluate())):r instanceof c?(l=new n(r.children.right,o),i=new c(r.children.left,l),i=i.simplify(t)):new c(r,o)},c.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},c.prototype.solve=function(t,n){var r,l,s,u,h,p,f,d,g,y,m;if(r=a("operators/Mul"),null==n&&(n={get:function(t){return[t]}}),s=this.expandAndSimplify(n),s instanceof e.Terminal){if(s instanceof e.Variable&&(s.label===t||(y=s.label,i.call(n.get(t),y)>=0)))return[new e.Constant("0")];throw new o(s.toString(),t)}if(s instanceof c){if(s.children.left instanceof e.Variable){if(s.children.left.label===t||(m=s.children.left.label,i.call(n.get(t),m)>=0))return[new e.Constant("0")];throw new o(s.toString(),t)}if(s.children.left instanceof e.Terminal)throw new o(s.toString(),t);try{f=s.children.left.solve(t,n)}catch(v){throw l=v}if(null!=s.children.right.evaluate&&0===s.children.right.evaluate()%2){for(h=[],d=0,g=f.length;g>d;d++)p=f[d],u=new r(-1,p).simplify(n),null!=u.equals?(u.equals(p)||h.push(u),h.push(p)):(u!==p&&h.push(u),h.push(p));return h}return f}return s.solve(t,n)},c.prototype.sub=function(n,r){var i,l,o,s,a,u,h,p,f,d,g;null==r&&(r=null);for(u in n)n[u]instanceof e.Terminal||n[u]instanceof t.BasicNode||(n[u]=new e.Constant(n[u]));if(null==r&&(r={get:function(t){return[t]}}),l=null,s=null,this.children.left instanceof e.Variable){for(h=r.get(this.children.left.label),a=!1,p=0,d=h.length;d>p;p++)if(i=h[p],i in n){l=n[i].copy(),a=!0;break}a||(l=this.children.left.copy())}else l=null!=this.children.left.sub?this.children.left.sub(n):this.children.left.copy();if(this.children.right instanceof e.Variable){for(h=r.get(this.children.right.label),a=!1,f=0,g=h.length;g>f;f++)if(i=h[f],i in n){s=n[i].copy(),a=!0;break}a||(s=this.children.right.copy())}else s=null!=this.children.right.sub?this.children.right.sub(n):this.children.right.copy();return o=new c(l,s),o=o.expandAndSimplify(r)},c.prototype.getAllVariables=function(){var t,n,r,i,l,o,s,a,u;if(l={},this.children.left instanceof e.Variable)l[this.children.left.label]=!0;else if(null!=this.children.left.getAllVariables)for(t=this.children.left.getAllVariables(),o=0,a=t.length;a>o;o++)i=t[o],l[i]=!0;if(this.children.right instanceof e.Variable)l[this.children.right.label]=!0;else if(null!=this.children.right.getAllVariables)for(r=this.children.right.getAllVariables(),s=0,u=r.length;u>s;s++)i=r[s],l[i]=!0;n=[];for(i in l)n.push(i);return n},c.prototype.replaceVariables=function(t){return this.children.left instanceof e.Variable&&this.children.left.label in t?this.children.left.label=t[this.children.left.label]:null!=this.children.left.replaceVariables&&this.children.left.replaceVariables(t),this.children.right instanceof e.Variable&&this.children.right.label in t?this.children.right.label=t[this.children.right.label]:null!=this.children.right.replaceVariables?this.children.right.replaceVariables(t):void 0},c.prototype.substituteExpression=function(t,n,r,l){var o,s,a,u,h,p,f,d,g,y,m,v,w,b,M,T,x;for(null==r&&(r=null),null==l&&(l=!1),d=l?t.solve(n,r):[t],null==r&&(r={get:function(t){return[t]}}),g=r.get(n),p=[],y=0,w=d.length;w>y;y++)for(o=d[y],u=[this.children.left.copy()],f=[this.children.right.copy()],this.children.left instanceof e.Variable&&(this.children.left.label===n||(T=this.children.left.label,i.call(g,T)>=0))?u=[o.copy()]:this.children.left instanceof e.Terminal||(u=this.children.left.substituteExpression(o,n,r)),this.children.right instanceof e.Variable&&(this.children.right.label===n||(x=this.children.right.label,i.call(g,x)>=0))?f=[o.copy()]:this.children.right instanceof e.Terminal||(f=this.children.right.substituteExpression(o,n,r)),m=0,b=u.length;b>m;m++)for(s=u[m],v=0,M=f.length;M>v;v++)a=f[v],h=new c(s,a),h=h.expandAndSimplify(r),p.push(h);return p},c.prototype.toMathML=function(t,n,e,r){var i,o,s,u,h,c,p,f,d,g,y,m,v;return null==n&&(n=!1),null==e&&(e="0"),null==r&&(r=!1),o=a("operators/Mul"),i=a("operators/Add"),v=l.getMathMLInfo(t,n,e),c=v[0],p=v[1],u=v[2],r?s="</math></div>":(u="",s=""),1===("function"==typeof(d=this.children.right).evaluate?d.evaluate():void 0)?u+this.children.left.toMathML(t,n)+s:0===("function"==typeof(g=this.children.right).evaluate?g.evaluate():void 0)?u+"<mn>1</mn>"+s:(("function"==typeof(y=this.children.right).evaluate?y.evaluate():void 0)<0?(f=this.children.right.copy(),f=new o("-1",f),f=f.expandAndSimplify()):f=this.children.right.copy(),h=this.children.left instanceof i||this.children.left instanceof o?"<mfenced>"+this.children.left.toMathML(t,n)+"</mfenced>":""+this.children.left.toMathML(t,n),1!==("function"==typeof f.evaluate?f.evaluate():void 0)&&(h="<msup>"+h+f.toMathML(t,n)+"</msup>"),("function"==typeof(m=this.children.right).evaluate?m.evaluate():void 0)<0&&(h="<mfrac><mn>1</mn>"+h+"</mfrac>"),u+h+s)},c.prototype.toHTML=function(t,n,r,i){var o,s,a,u,h,c,p,f,d,g;return null==n&&(n=!1),null==r&&(r="0"),null==i&&(i=!1),g=l.getHTMLInfo(t,n,r),h=g[0],c=g[1],s=g[2],i?o="</div>":(s="",o=""),1===("function"==typeof(f=this.children.right).evaluate?f.evaluate():void 0)?s+this.children.left.toHTML()+o:0===("function"==typeof(d=this.children.right).evaluate?d.evaluate():void 0)?s+"1"+o:(u=this.children.left instanceof e.Terminal?this.children.left.toHTML():"("+this.children.left.toHTML()+")",p=this.children.right instanceof e.Terminal?this.children.right.toHTML():"("+this.children.right.toHTML()+")",a=""+u+" ** "+p,s+a+o)},c.prototype.toLaTeX=function(){var t,n,e,r,i,l,o;return n=a("operators/Mul"),t=a("operators/Add"),1===("function"==typeof(i=this.children.right).evaluate?i.evaluate():void 0)?this.children.left.toLaTeX():0===("function"==typeof(l=this.children.right).evaluate?l.evaluate():void 0)?"1":(e=this.children.left instanceof t||this.children.left instanceof n?"\\left("+this.children.left.toLaTeX()+"\\right)^{"+this.children.right.toLaTeX()+"}":""+this.children.left.toLaTeX()+"^{"+this.children.right.toLaTeX()+"}",("function"==typeof(o=this.children.right).evaluate?o.evaluate():void 0)<0&&(r=this.children.right.copy(),r=new n("-1",r),r=r.simplify(),e="\\frac{1}{"+e+"}"),e)},c.prototype.differentiate=function(t){var n,e,r,l;if(n=a("operators/Add"),r=a("operators/Mul"),e=a("terminals").Constant,i.call(this.children.right.getAllVariables,t)>=0)throw new Error("I can't differentiate with a variable on the top of a power");return 0===("function"==typeof(l=this.children.right).evaluate?l.evaluate():void 0)?new e(0):new r(new c(this.children.left,new n(this.children.right,new e(-1))),this.children.left.differentiate(t),this.children.right).expandAndSimplify()},c}(t.BinaryNode)})}.call(this),function(){e("operators",["operators/Add","operators/Mul","operators/Pow"],function(t,n,e){return{Add:t,Mul:n,Pow:e}})}.call(this),function(){var t=[].slice,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("Equation",["terminals","nodes","operators","parse"],function(e,r,i,l){var o;return o=function(){function o(){var n,i;switch(n=1<=arguments.length?t.call(arguments,0):[],n.length){case 1:if(n[0]instanceof String||"string"==typeof n[0])switch(i=n[0].split("="),i.length){case 1:this.left=new e.Constant("0"),this.right=l.stringToExpression(i[0]),this.right=this.right.simplify();break;case 2:this.left=l.stringToTerminal(i[0]),this.right=l.stringToExpression(i[1]),this.right=this.right.simplify();break;default:throw new Error("Too many '=' signs.")}else{if(!(n[0]instanceof e.Terminal||n[0]instanceof r.BasicNode))throw new Error("Argument "+n[0]+" must be a String, Terminal, or Node.");this.left=new e.Constant("0"),this.right=n[0].copy()}break;case 2:if(n[0]instanceof String||"string"==typeof n[0])this.left=l.stringToTerminal(n[0]);else{if(!(n[0]instanceof e.Terminal||n[0]instanceof r.BasicNode))throw new Error("Argument "+n[0]+" must be a String, Terminal, or Node.");this.left=n[0].copy()}if(n[1]instanceof String||"string"==typeof n[1])this.right=l.stringToExpression(n[1]),this.right=this.right.simplify();else{if(!(n[1]instanceof e.Terminal||n[1]instanceof r.BasicNode))throw new Error("Argument "+n[1]+" must be a String, Terminal, or Node.");this.right=n[1].copy()}break;default:throw new Error("Too many arguments.")}}return o.prototype.solve=function(t,n){var e,r;return null==n&&(n=null),e=new i.Add(this.right,new i.Mul("-1",this.left)),r=e.solve(t,n),r.map(function(n){return new o(t,n)})},o.prototype.replaceVariables=function(t){return this.left.replaceVariables(t),this.right.replaceVariables(t)},o.prototype.getAllVariables=function(){var t,e,r,i,l;for(t=this.left.getAllVariables(),e=this.right.getAllVariables(),i=0,l=t.length;l>i;i++)r=t[i],n.call(e,r)<0&&e.unshift(r);return e},o.prototype.sub=function(t,n){return new o(this.left,this.right.sub(t,n))},o.prototype.substituteExpression=function(t,n,e,r){var l,s,a,u,h,c,p,f,d,g;for(null==r&&(r=!1),t instanceof o&&(t=new i.Add(t.right,new i.Mul("-1",t.left))),null==e&&(e={get:function(t){return[t]}}),h=e.get(n),u=r?t.solve(n,e):[t],s=[],c=0,f=u.length;f>c;c++)for(a=u[c],g=this.right.substituteExpression(a,n,e),p=0,d=g.length;d>p;p++)l=g[p],s.push(new o(this.left,l.expandAndSimplify(e)));return s},o.prototype.expandAndSimplify=function(t){var n,e;return n=this.left.expandAndSimplify(t),e=this.right.expandAndSimplify(t),new o(n,e)},o.prototype.simplify=function(t){var n,e;return n=this.left.simplify(t),e=this.right.simplify(t),new o(n,e)},o.prototype.expand=function(t){var n,e;return n=this.left.expand(t),e=this.right.expand(t),new o(n,e)},o.prototype.getVariableUnits=function(t,n){return null==n&&(n={get:function(t){return[t]}}),this.left.label===t?this.left.units:this.right.getVariableUnits(t,n)},o.prototype.toMathML=function(t,n,e,r){return null==n&&(n=!1),null==e&&(e=null),null==r&&(r=!1),this.right.toMathML(t,n,this.left,r)},o.prototype.toHTML=function(t,n,e,r){return null==n&&(n=!1),null==e&&(e=null),null==r&&(r=!1),this.right.toHTML(t,n,this.left,r)},o.prototype.toLaTeX=function(){return""+this.left.toLaTeX()+" = "+this.right.toLaTeX()},o.prototype.toString=function(){return""+this.left+" = "+this.right},o}()})}.call(this),function(){n.config({baseUrl:"./"}),e("coffeequate",["Equation","operators","terminals","parse"],function(t,n,e,r){return{Equation:t,tree:{operators:n,terminals:e},parse:r}})}.call(this),n(["coffeequate"]),n("coffeequate")});